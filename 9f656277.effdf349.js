(window.webpackJsonp=window.webpackJsonp||[]).push([[54],{125:function(e,t,a){"use strict";a.r(t),a.d(t,"frontMatter",(function(){return i})),a.d(t,"metadata",(function(){return b})),a.d(t,"toc",(function(){return o})),a.d(t,"default",(function(){return s}));var n=a(3),r=a(7),l=(a(0),a(167)),i={slug:"installation/prerequisites",title:"Prerequisites"},b={unversionedId:"inst-prerequisites",id:"inst-prerequisites",isDocsHomePage:!1,title:"Prerequisites",description:"1. Working k8s cluster(s)",source:"@site/docs/inst-prerequisites.md",slug:"/installation/prerequisites",permalink:"/docs/installation/prerequisites",editUrl:"https://github.com/redkubes/redkubes/tree/master/docs/inst-prerequisites.md",version:"current",sidebar:"mainSidebar",previous:{title:"Installation Overview",permalink:"/docs/installation/"},next:{title:"Install with Chart",permalink:"/docs/installation/chart/"}},o=[{value:"1. Working k8s cluster(s)",id:"1-working-k8s-clusters",children:[]},{value:"2. DNS zone",id:"2-dns-zone",children:[{value:"Azure",id:"azure",children:[]},{value:"Google",id:"google",children:[]},{value:"AWS",id:"aws",children:[]}]},{value:"3. IDP",id:"3-idp",children:[]},{value:"4. Kubectl running",id:"4-kubectl-running",children:[]},{value:"5. Docker running",id:"5-docker-running",children:[]},{value:"6. KMS credentials to manage keys for encryption (optional)",id:"6-kms-credentials-to-manage-keys-for-encryption-optional",children:[]},{value:"7. Pull secret for the API (optional)",id:"7-pull-secret-for-the-api-optional",children:[]}],c={toc:o};function s(e){var t=e.components,a=Object(r.a)(e,["components"]);return Object(l.b)("wrapper",Object(n.a)({},c,a,{components:t,mdxType:"MDXLayout"}),Object(l.b)("h2",{id:"1-working-k8s-clusters"},"1. Working k8s cluster(s)"),Object(l.b)("p",null,"Otomi needs a working kubernetes cluster to deploy on. It supports two versions down from 1.19, so at a minimum 1.17 is required. If you don't have access with kubectl to your cluster, you may have to pull the credentials from the cloud first:"),Object(l.b)("ul",null,Object(l.b)("li",{parentName:"ul"},"Azure: ",Object(l.b)("inlineCode",{parentName:"li"},"az aks get-credentials --resource-group $RG --name $CLUSTER_NAME --admin")),Object(l.b)("li",{parentName:"ul"},"AWS: ",Object(l.b)("inlineCode",{parentName:"li"},"aws eks update-kubeconfig --name $CLUSTER_NAME")),Object(l.b)("li",{parentName:"ul"},"Google: ",Object(l.b)("inlineCode",{parentName:"li"},"gcloud container clusters get-credentials $CLUSTER_NAME --region europe-west4 --project xxx"))),Object(l.b)("p",null,"If you are not logged in with the correct credentials then re-login first:"),Object(l.b)("ul",null,Object(l.b)("li",{parentName:"ul"},"Azure: ",Object(l.b)("inlineCode",{parentName:"li"},"az login")),Object(l.b)("li",{parentName:"ul"},"AWS: ",Object(l.b)("inlineCode",{parentName:"li"},"aws login eks")),Object(l.b)("li",{parentName:"ul"},"Google: ",Object(l.b)("inlineCode",{parentName:"li"},"gcloud auth login"))),Object(l.b)("p",null,"Otomi installs a complete suite of Kubernetes add-ons and applications. This requires resources. Otomi (minimal setup) requires at least:"),Object(l.b)("ul",null,Object(l.b)("li",{parentName:"ul"},"4 vCPU"),Object(l.b)("li",{parentName:"ul"},"8 GiB"),Object(l.b)("li",{parentName:"ul"},"100 GiB storage"),Object(l.b)("li",{parentName:"ul"},"Calico network policies")),Object(l.b)("p",null,"We recommend the following setup:"),Object(l.b)("table",null,Object(l.b)("thead",{parentName:"table"},Object(l.b)("tr",{parentName:"thead"},Object(l.b)("th",Object(n.a)({parentName:"tr"},{align:null}),"Provider"),Object(l.b)("th",Object(n.a)({parentName:"tr"},{align:null}),"Instance Type worker nodes"),Object(l.b)("th",Object(n.a)({parentName:"tr"},{align:null}),"Min Node count"),Object(l.b)("th",Object(n.a)({parentName:"tr"},{align:null}),"Auto Scaling enabled"))),Object(l.b)("tbody",{parentName:"table"},Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"Azure (AKS)"),Object(l.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"Standard_DS3_v2"),Object(l.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"3"),Object(l.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"Yes")),Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"AWS (EKS / kOPS)"),Object(l.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"c5.xlarge"),Object(l.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"3"),Object(l.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"Yes")),Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"GCP (GKE / kOPS)"),Object(l.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"n1-standard-4"),Object(l.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"3"),Object(l.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"Yes")))),Object(l.b)("h2",{id:"2-dns-zone"},"2. DNS zone"),Object(l.b)("p",null,"Otomi requires credentials that allow to manage a DNS zone from one of the following providers: aws/azure/google."),Object(l.b)("h3",{id:"azure"},"Azure"),Object(l.b)("ol",null,Object(l.b)("li",{parentName:"ol"},Object(l.b)("a",Object(n.a)({parentName:"li"},{href:"https://github.com/kubernetes-sigs/external-dns/blob/master/docs/tutorials/azure.md#creating-an-azure-dns-zone"}),"Create a DNS zone")),Object(l.b)("li",{parentName:"ol"},Object(l.b)("a",Object(n.a)({parentName:"li"},{href:"https://github.com/kubernetes-sigs/external-dns/blob/master/docs/tutorials/azure.md#permissions-to-modify-dns-zone"}),"Set permissions to modify the DNS zone"))),Object(l.b)("h3",{id:"google"},"Google"),Object(l.b)("p",null,"Create a DNS zone which will contain the managed DNS records."),Object(l.b)("pre",null,Object(l.b)("code",Object(n.a)({parentName:"pre"},{className:"language-console"}),'$ gcloud dns managed-zones create "otomi-dns-test-yourdomain-com" \\\n    --dns-name "otomi-dns-test.yourdomain.com." \\\n    --description "Automatically managed zone by otomi"\n')),Object(l.b)("h3",{id:"aws"},"AWS"),Object(l.b)("ol",null,Object(l.b)("li",{parentName:"ol"},Object(l.b)("a",Object(n.a)({parentName:"li"},{href:"https://github.com/kubernetes-sigs/external-dns/blob/master/docs/tutorials/aws.md#iam-policy"}),"Create an IAM policy")),Object(l.b)("li",{parentName:"ol"},Object(l.b)("a",Object(n.a)({parentName:"li"},{href:"https://github.com/kubernetes-sigs/external-dns/blob/master/docs/tutorials/aws.md#create-iam-role"}),"Create an IAM role"))),Object(l.b)("h2",{id:"3-idp"},"3. IDP"),Object(l.b)("div",{className:"admonition admonition-note alert alert--secondary"},Object(l.b)("div",Object(n.a)({parentName:"div"},{className:"admonition-heading"}),Object(l.b)("h5",{parentName:"div"},Object(l.b)("span",Object(n.a)({parentName:"h5"},{className:"admonition-icon"}),Object(l.b)("svg",Object(n.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(l.b)("path",Object(n.a)({parentName:"svg"},{fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"})))),"ATTENTION: The new Otomi Chart install now only supports Azure AD as IDP!")),Object(l.b)("div",Object(n.a)({parentName:"div"},{className:"admonition-content"}),Object(l.b)("p",{parentName:"div"},"We will soon come with an update where local accounts in KeyCloak can be used."))),Object(l.b)("p",null,"The authentication of user brokered Keycloak identities through Azure AD requires a service principal with some Azure AD API permissions. An app registration needs to be created with the following API permissions:"),Object(l.b)("table",null,Object(l.b)("thead",{parentName:"table"},Object(l.b)("tr",{parentName:"thead"},Object(l.b)("th",Object(n.a)({parentName:"tr"},{align:null}),"API / Permission name"),Object(l.b)("th",Object(n.a)({parentName:"tr"},{align:null}),"Type"),Object(l.b)("th",Object(n.a)({parentName:"tr"},{align:null}),"Description"))),Object(l.b)("tbody",{parentName:"table"},Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"Microsoft Graph / email"),Object(l.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"Delegated"),Object(l.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"View users' email address")),Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"Microsoft Graph / openid"),Object(l.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"Delegated"),Object(l.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"Sign users in")),Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"Microsoft Graph / profile"),Object(l.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"Delegated"),Object(l.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"View users' basic profile")),Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"Microsoft Graph / User.Read"),Object(l.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"Delegated"),Object(l.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"Sign in and read user profile")))),Object(l.b)("p",null,"And the following token configurations:"),Object(l.b)("table",null,Object(l.b)("thead",{parentName:"table"},Object(l.b)("tr",{parentName:"thead"},Object(l.b)("th",Object(n.a)({parentName:"tr"},{align:null}),"Claim"),Object(l.b)("th",Object(n.a)({parentName:"tr"},{align:null}),"Description"),Object(l.b)("th",Object(n.a)({parentName:"tr"},{align:null}),"Token type"),Object(l.b)("th",Object(n.a)({parentName:"tr"},{align:null}),"Optional settings"))),Object(l.b)("tbody",{parentName:"table"},Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"family_name"),Object(l.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"Provides the last name, surename, or family name"),Object(l.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"ID"),Object(l.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"-")),Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"given_name"),Object(l.b)("td",Object(n.a)({parentName:"tr"},{align:null}),'Provides the first or "give" name of the user'),Object(l.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"ID"),Object(l.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"-")),Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"groups"),Object(l.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"Optional formatting for group claims"),Object(l.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"ID, Access, SAML"),Object(l.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"Default")),Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"upn"),Object(l.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"An identifier for the user that can be used ..."),Object(l.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"ID"),Object(l.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"Default")))),Object(l.b)("p",null,"Note that the group type should be set to \u2018security groups\u2019."),Object(l.b)("p",null,"At the \u2018Authentication\u2019 tab you should be able to set the following callback URL\u2019s and enable that both \u201cAccess tokens\u201d and \u201cID tokens\u201d are issued and public client flows are allowed:"),Object(l.b)("ul",null,Object(l.b)("li",{parentName:"ul"},Object(l.b)("inlineCode",{parentName:"li"},"https://keycloak.<dns-zone-name>/realms/master/broker/<idp alias>/endpoint")),Object(l.b)("li",{parentName:"ul"},Object(l.b)("inlineCode",{parentName:"li"},"https://keycloak.<dns-zone-name>"))),Object(l.b)("h2",{id:"4-kubectl-running"},"4. Kubectl running"),Object(l.b)("p",null,"To be able to target different kube contexts, kubectl needs to be installed."),Object(l.b)("h2",{id:"5-docker-running"},"5. Docker running"),Object(l.b)("p",null,"Otomi runs everything from containers, so please start docker if you haven't already."),Object(l.b)("h2",{id:"6-kms-credentials-to-manage-keys-for-encryption-optional"},"6. KMS credentials to manage keys for encryption (optional)"),Object(l.b)("p",null,"If you would like the secrets in the values repo to be encrypted, you will have to setup an account with your Key Management Service (KMS) provider. It is needed by ",Object(l.b)("a",Object(n.a)({parentName:"p"},{href:"https://github.com/mozilla/sops"}),"sops"),", the tool used for encryption by Otomi. Please read up on how to work with sops."),Object(l.b)("h2",{id:"7-pull-secret-for-the-api-optional"},"7. Pull secret for the API (optional)"),Object(l.b)("p",null,"Otomi CE does not offer developer self-service (to use Otomi as an Internal Developer Platform), but can only be configured by an admin."),Object(l.b)("div",{className:"admonition admonition-info alert alert--info"},Object(l.b)("div",Object(n.a)({parentName:"div"},{className:"admonition-heading"}),Object(l.b)("h5",{parentName:"div"},Object(l.b)("span",Object(n.a)({parentName:"h5"},{className:"admonition-icon"}),Object(l.b)("svg",Object(n.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(l.b)("path",Object(n.a)({parentName:"svg"},{fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"})))),"Otomi Enterprise Edition license needed")),Object(l.b)("div",Object(n.a)({parentName:"div"},{className:"admonition-content"}),Object(l.b)("p",{parentName:"div"},"If you have a license for Otomi EE you can run the api, unlocking self service features."))),Object(l.b)("p",null,"When you have a license to use the api you will have a pull secret. Please keep it handy for the ",Object(l.b)("a",Object(n.a)({parentName:"p"},{href:"/docs/installation/chart"}),"Chart")," or ",Object(l.b)("a",Object(n.a)({parentName:"p"},{href:"/docs/installation/cli"}),"CLI")," install."))}s.isMDXComponent=!0},167:function(e,t,a){"use strict";a.d(t,"a",(function(){return u})),a.d(t,"b",(function(){return m}));var n=a(0),r=a.n(n);function l(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function b(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){l(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function o(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},l=Object.keys(e);for(n=0;n<l.length;n++)a=l[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(n=0;n<l.length;n++)a=l[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var c=r.a.createContext({}),s=function(e){var t=r.a.useContext(c),a=t;return e&&(a="function"==typeof e?e(t):b(b({},t),e)),a},u=function(e){var t=s(e.components);return r.a.createElement(c.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return r.a.createElement(r.a.Fragment,{},t)}},d=r.a.forwardRef((function(e,t){var a=e.components,n=e.mdxType,l=e.originalType,i=e.parentName,c=o(e,["components","mdxType","originalType","parentName"]),u=s(a),d=n,m=u["".concat(i,".").concat(d)]||u[d]||p[d]||l;return a?r.a.createElement(m,b(b({ref:t},c),{},{components:a})):r.a.createElement(m,b({ref:t},c))}));function m(e,t){var a=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var l=a.length,i=new Array(l);i[0]=d;var b={};for(var o in t)hasOwnProperty.call(t,o)&&(b[o]=t[o]);b.originalType=e,b.mdxType="string"==typeof e?e:n,i[1]=b;for(var c=2;c<l;c++)i[c]=a[c];return r.a.createElement.apply(null,i)}return r.a.createElement.apply(null,a)}d.displayName="MDXCreateElement"}}]);