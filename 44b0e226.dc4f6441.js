(window.webpackJsonp=window.webpackJsonp||[]).push([[35],{105:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return l})),n.d(t,"metadata",(function(){return r})),n.d(t,"toc",(function(){return c})),n.d(t,"default",(function(){return b}));var a=n(3),o=n(7),i=(n(0),n(189)),l={slug:"installation/post-install/",title:"Post installation steps"},r={unversionedId:"post-install",id:"post-install",isDocsHomePage:!1,title:"Post installation steps",description:"After Otomi is installed, a couple of post install configuration steps are required. Follow the instructions below:",source:"@site/docs/post-install.md",slug:"/installation/post-install/",permalink:"/docs/installation/post-install/",editUrl:"https://github.com/redkubes/redkubes.github.io/tree/master/docs/post-install.md",version:"current",sidebar:"mainSidebar",previous:{title:"Install from chart",permalink:"/docs/installation/chart"},next:{title:"Overview",permalink:"/docs/console/"}},c=[{value:"When Otomi is installed without optional configuration",id:"when-otomi-is-installed-without-optional-configuration",children:[{value:"Get the log output of the installer job",id:"get-the-log-output-of-the-installer-job",children:[]},{value:"Create a user in Keycloak",id:"create-a-user-in-keycloak",children:[]},{value:"Sign in to the console",id:"sign-in-to-the-console",children:[]},{value:"Add the auto generated CA to your keychain (optional)",id:"add-the-auto-generated-ca-to-your-keychain-optional",children:[]},{value:"Activate Drone",id:"activate-drone",children:[]}]},{value:"When Otomi is installed with optional configuration",id:"when-otomi-is-installed-with-optional-configuration",children:[{value:"Sign in to the console",id:"sign-in-to-the-console-1",children:[]}]}],s={toc:c};function b(e){var t=e.components,l=Object(o.a)(e,["components"]);return Object(i.b)("wrapper",Object(a.a)({},s,l,{components:t,mdxType:"MDXLayout"}),Object(i.b)("p",null,"After Otomi is installed, a couple of post install configuration steps are required. Follow the instructions below:"),Object(i.b)("h2",{id:"when-otomi-is-installed-without-optional-configuration"},"When Otomi is installed without optional configuration"),Object(i.b)("p",null,"Follow these instructions when Otomi is installed without DNS and without bringing your own IDP (like Azure AD):"),Object(i.b)("h3",{id:"get-the-log-output-of-the-installer-job"},"Get the log output of the installer job"),Object(i.b)("p",null,"When Otomi is installed without optional configuration, first get the Keycloak URL and the auto generated password for the Keycloak ",Object(i.b)("inlineCode",{parentName:"p"},"admin")," user provided at the end of the logs of the Otomi installer job:"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"kubectl logs jobs/otomi -n default\n")),Object(i.b)("p",null,"When ",Object(i.b)("inlineCode",{parentName:"p"},"otomi:adminPassword")," was filled in the values.yaml, then use that password to sign in into Keycloak."),Object(i.b)("h3",{id:"create-a-user-in-keycloak"},"Create a user in Keycloak"),Object(i.b)("ol",null,Object(i.b)("li",{parentName:"ol"},"Go to Keycloak admin console using the following url: ",Object(i.b)("inlineCode",{parentName:"li"},"keycloak.<your-ip.nip.io>")),Object(i.b)("li",{parentName:"ol"},"Click on ",Object(i.b)("inlineCode",{parentName:"li"},"Administration Console")),Object(i.b)("li",{parentName:"ol"},"Login with username: ",Object(i.b)("inlineCode",{parentName:"li"},"admin")," and the provided password"),Object(i.b)("li",{parentName:"ol"},"Select the ",Object(i.b)("inlineCode",{parentName:"li"},"Otomi")," realm"),Object(i.b)("li",{parentName:"ol"},"Click on ",Object(i.b)("inlineCode",{parentName:"li"},"Users")," then ",Object(i.b)("inlineCode",{parentName:"li"},"Add user")," "),Object(i.b)("li",{parentName:"ol"},"Fill in a user name in the Username field"),Object(i.b)("li",{parentName:"ol"},"Fill in your email address in the Email field"),Object(i.b)("li",{parentName:"ol"},"Select the ",Object(i.b)("inlineCode",{parentName:"li"},"otomi-admin")," group"),Object(i.b)("li",{parentName:"ol"},"Click on ",Object(i.b)("inlineCode",{parentName:"li"},"Save")),Object(i.b)("li",{parentName:"ol"},"Click on the ",Object(i.b)("inlineCode",{parentName:"li"},"Credentials")," tab and then fill in a password for this user in the ",Object(i.b)("inlineCode",{parentName:"li"},"Password")," and ",Object(i.b)("inlineCode",{parentName:"li"},"Password Confirmation")," fields"),Object(i.b)("li",{parentName:"ol"},"Click on ",Object(i.b)("inlineCode",{parentName:"li"},"Set Password"))),Object(i.b)("div",{className:"admonition admonition-info alert alert--info"},Object(i.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-heading"}),Object(i.b)("h5",{parentName:"div"},Object(i.b)("span",Object(a.a)({parentName:"h5"},{className:"admonition-icon"}),Object(i.b)("svg",Object(a.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(i.b)("path",Object(a.a)({parentName:"svg"},{fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"})))),"info")),Object(i.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-content"}),Object(i.b)("p",{parentName:"div"},"When a password for the Keycloak admin is not provided in the values.yaml (but automatically generated), it is advised to first change the password the password."))),Object(i.b)("h3",{id:"sign-in-to-the-console"},"Sign in to the console"),Object(i.b)("p",null,"Open the Otomi console (using the URL provided in the installer logs), and sign in with the new user."),Object(i.b)("p",null,"After you have successfully logged in, you will see the Otomi Admin Dashboard. Click ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"/docs/console"}),"here")," to learn more about using Otomi Console."),Object(i.b)("p",null,Object(i.b)("img",{alt:"console-lading-page",src:n(255).default})),Object(i.b)("p",null,Object(i.b)("img",{alt:"console-apps",src:n(200).default})),Object(i.b)("h3",{id:"add-the-auto-generated-ca-to-your-keychain-optional"},"Add the auto generated CA to your keychain (optional)"),Object(i.b)("p",null,"When Otomi is installed without DNS and with an auto generated CA, add the CA to you keychain:"),Object(i.b)("ol",null,Object(i.b)("li",{parentName:"ol"},"In the left pane of the console, click on ",Object(i.b)("inlineCode",{parentName:"li"},"download CA")),Object(i.b)("li",{parentName:"ol"},"Add the CA to your keychain:")),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"sudo security add-trusted-cert -d -r trustRoot -k /Library/Keychains/System.keychain ~/Downloads/ca.crt\n")),Object(i.b)("h3",{id:"activate-drone"},"Activate Drone"),Object(i.b)("p",null,Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"https://gitea.io/en-us/"}),"Gitea")," and ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"https://www.drone.io/"}),"Drone")," are an integral part of how Otomi cluster configurations are stored and updated. "),Object(i.b)("ol",null,Object(i.b)("li",{parentName:"ol"},"Click on the ",Object(i.b)("strong",{parentName:"li"},"Gitea")," app (under Platform/Otomi Apps) in the console. "),Object(i.b)("li",{parentName:"ol"},"In the top right, click on ",Object(i.b)("inlineCode",{parentName:"li"},"Sign In")),Object(i.b)("li",{parentName:"ol"},"Sign in using ",Object(i.b)("inlineCode",{parentName:"li"},"OpenID")),Object(i.b)("li",{parentName:"ol"},"Use the pre-filled values for the ",Object(i.b)("inlineCode",{parentName:"li"},"Username")," and ",Object(i.b)("inlineCode",{parentName:"li"},"Email Address")," and click ",Object(i.b)("inlineCode",{parentName:"li"},"Complete Account"))),Object(i.b)("p",null,"It could take a couple of minutes before the values repository becomes visible. The ",Object(i.b)("inlineCode",{parentName:"p"},"otomi/values")," repository holds the otomi cluster configuration and is updated whenever new changes occur through the console."),Object(i.b)("p",null,Object(i.b)("img",{alt:"gitea-values",src:n(256).default})),Object(i.b)("p",null,"Now head back to the console to activate Drone."),Object(i.b)("ol",null,Object(i.b)("li",{parentName:"ol"},"Click on the Drone app and it should open a new tab as shown below")),Object(i.b)("p",null,Object(i.b)("img",{alt:"drone-landing",src:n(257).default})),Object(i.b)("ol",{start:2},Object(i.b)("li",{parentName:"ol"},"Select ",Object(i.b)("inlineCode",{parentName:"li"},"Activate"),", and then ",Object(i.b)("inlineCode",{parentName:"li"},"ACTIVATE REPOSITORY"))),Object(i.b)("p",null,Object(i.b)("img",{alt:"drone-activate",src:n(258).default})),Object(i.b)("ol",{start:3},Object(i.b)("li",{parentName:"ol"},"Save the changes and you are good to go.")),Object(i.b)("p",null,Object(i.b)("img",{alt:"drone-save",src:n(259).default})),Object(i.b)("p",null,"Now the final step is to create a Team. See the ",Object(i.b)("strong",{parentName:"p"},Object(i.b)("a",Object(a.a)({parentName:"strong"},{href:"/docs/console/teams"}),"Teams"))," page for more information."),Object(i.b)("h2",{id:"when-otomi-is-installed-with-optional-configuration"},"When Otomi is installed with optional configuration"),Object(i.b)("h3",{id:"sign-in-to-the-console-1"},"Sign in to the console"),Object(i.b)("p",null,"If Otomi is configured with OIDC (using Azure AD as an IDP), click on the right button (redkubes-azure in the example below). "),Object(i.b)("p",null,Object(i.b)("img",{alt:"console-login",src:n(260).default})),Object(i.b)("p",null,"When OIDC is configured, an Active Directory user needs to be a member of the otomi-admin group. Now follow the same steps as described above to activate Drone."))}b.isMDXComponent=!0},189:function(e,t,n){"use strict";n.d(t,"a",(function(){return d})),n.d(t,"b",(function(){return m}));var a=n(0),o=n.n(a);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var s=o.a.createContext({}),b=function(e){var t=o.a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},d=function(e){var t=b(e.components);return o.a.createElement(s.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return o.a.createElement(o.a.Fragment,{},t)}},u=o.a.forwardRef((function(e,t){var n=e.components,a=e.mdxType,i=e.originalType,l=e.parentName,s=c(e,["components","mdxType","originalType","parentName"]),d=b(n),u=a,m=d["".concat(l,".").concat(u)]||d[u]||p[u]||i;return n?o.a.createElement(m,r(r({ref:t},s),{},{components:n})):o.a.createElement(m,r({ref:t},s))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=n.length,l=new Array(i);l[0]=u;var r={};for(var c in t)hasOwnProperty.call(t,c)&&(r[c]=t[c]);r.originalType=e,r.mdxType="string"==typeof e?e:a,l[1]=r;for(var s=2;s<i;s++)l[s]=n[s];return o.a.createElement.apply(null,l)}return o.a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},200:function(e,t,n){"use strict";n.r(t),t.default=n.p+"assets/images/console-apps-eed3320fa1754480a623287e0bbe2365.png"},255:function(e,t,n){"use strict";n.r(t),t.default=n.p+"assets/images/console-landing-page-515451f2df816a4eb939656ab5302b06.png"},256:function(e,t,n){"use strict";n.r(t),t.default=n.p+"assets/images/gitea-values-b745166845de7fcba345726a846a143b.png"},257:function(e,t,n){"use strict";n.r(t),t.default=n.p+"assets/images/drone-landing-ec436af98acc3e7ebf02819bd04df0d2.png"},258:function(e,t,n){"use strict";n.r(t),t.default=n.p+"assets/images/drone-activate-d0cdfcda638a52092ce04000db3ba07e.png"},259:function(e,t,n){"use strict";n.r(t),t.default=n.p+"assets/images/drone-save-2f6f70cf0b764de14c0b811f6cd12c44.png"},260:function(e,t,n){"use strict";n.r(t),t.default=n.p+"assets/images/console-login-674f187bd93d1c7535335041aa140840.png"}}]);