(window.webpackJsonp=window.webpackJsonp||[]).push([[35],{105:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return r})),n.d(t,"metadata",(function(){return l})),n.d(t,"toc",(function(){return s})),n.d(t,"default",(function(){return d}));var a=n(3),i=n(7),o=(n(0),n(189)),r={slug:"installation/post-install/",title:"Post installation steps"},l={unversionedId:"post-install",id:"post-install",isDocsHomePage:!1,title:"Post installation steps",description:"After Otomi is installed, a couple of post install configuration steps are required. Follow the instructions below:",source:"@site/docs/post-install.md",slug:"/installation/post-install/",permalink:"/docs/installation/post-install/",editUrl:"https://github.com/redkubes/redkubes.github.io/tree/master/docs/post-install.md",version:"current",sidebar:"mainSidebar",previous:{title:"Install from chart",permalink:"/docs/installation/chart"},next:{title:"Overview",permalink:"/docs/console/"}},s=[{value:"When Otomi is installed with minimal values",id:"when-otomi-is-installed-with-minimal-values",children:[{value:"Get the log output of the installer job",id:"get-the-log-output-of-the-installer-job",children:[]},{value:"Create a user in Keycloak",id:"create-a-user-in-keycloak",children:[]},{value:"Activate Drone",id:"activate-drone",children:[]}]},{value:"When Otomi is installed with optional configuration",id:"when-otomi-is-installed-with-optional-configuration",children:[{value:"Sign in to the console",id:"sign-in-to-the-console-1",children:[]}]}],c={toc:s};function d(e){var t=e.components,r=Object(i.a)(e,["components"]);return Object(o.b)("wrapper",Object(a.a)({},c,r,{components:t,mdxType:"MDXLayout"}),Object(o.b)("p",null,"After Otomi is installed, a couple of post install configuration steps are required. Follow the instructions below:"),Object(o.b)("h2",{id:"when-otomi-is-installed-with-minimal-values"},"When Otomi is installed with minimal values"),Object(o.b)("p",null,"Follow these instructions when Otomi is installed without DNS (",Object(o.b)("inlineCode",{parentName:"p"},"otomi.hasExternalDNS=false"),") and without a 3rd party IDP (",Object(o.b)("inlineCode",{parentName:"p"},"otomi.hasExternalIDP=false"),")."),Object(o.b)("h3",{id:"get-the-log-output-of-the-installer-job"},"Get the log output of the installer job"),Object(o.b)("p",null,"When Otomi is installed with minimal values, passwords and public URLs (based on nip.io) are automatically generated and Keycloak is configured as an Identity Provider (IDP), in which one has to define Otomi users. The public URL of Otomi Console, the public URL of Keycloak and the admin credentials can be retrieved from the installer log. The installer job runs in the default namespace. In case the installer failed in the first run, the installer will automatically restart. Make sure to get the logs of the installer job with status ",Object(o.b)("inlineCode",{parentName:"p"},"Completed"),"."),Object(o.b)("h3",{id:"create-a-user-in-keycloak"},"Create a user in Keycloak"),Object(o.b)("ol",null,Object(o.b)("li",{parentName:"ol"},"Navigate to Keycloak app (using the URL provided in the installer log)"),Object(o.b)("li",{parentName:"ol"},'Click on "Administration Console"'),Object(o.b)("li",{parentName:"ol"},"Login with admin credentials (using admin and password provided in the installer log)"),Object(o.b)("li",{parentName:"ol"},'Select the "Otomi" realm'),Object(o.b)("li",{parentName:"ol"},'Click on "Users" then "Add user"'),Object(o.b)("li",{parentName:"ol"},'Fill in a user name in the "Username" field'),Object(o.b)("li",{parentName:"ol"},'Fill in your email address in the "Email" field'),Object(o.b)("li",{parentName:"ol"},'Select the "otomi-admin" group'),Object(o.b)("li",{parentName:"ol"},'Click on "Save"'),Object(o.b)("li",{parentName:"ol"},'Choose the "Credentials" tab and then fill in a password for this user'),Object(o.b)("li",{parentName:"ol"},'Click on "Set Password"')),Object(o.b)("div",{className:"admonition admonition-info alert alert--info"},Object(o.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-heading"}),Object(o.b)("h5",{parentName:"div"},Object(o.b)("span",Object(a.a)({parentName:"h5"},{className:"admonition-icon"}),Object(o.b)("svg",Object(a.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(o.b)("path",Object(a.a)({parentName:"svg"},{fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"})))),"When a password for the Keycloak admin is not provided in the values.yaml (but automatically generated), it is advised to first change the password. :::")),Object(o.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-content"}),Object(o.b)("h3",Object(a.a)({parentName:"div"},{id:"sign-in-to-the-console"}),"Sign in to the console"),Object(o.b)("p",{parentName:"div"},"Open the Otomi console (using the URL provided in the installer logs), and sign in with the new user."),Object(o.b)("p",{parentName:"div"},"After you have successfully logged in, you will see the Otomi Admin Dashboard. Click ",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"/docs/console"}),"here")," to learn more about using Otomi Console."),Object(o.b)("p",{parentName:"div"},Object(o.b)("img",{alt:"console-lading-page",src:n(256).default})),Object(o.b)("h3",Object(a.a)({parentName:"div"},{id:"add-the-auto-generated-ca-to-your-keychain"}),"Add the auto generated CA to your keychain"),Object(o.b)("ol",{parentName:"div"},Object(o.b)("li",{parentName:"ol"},'In the left pane of the console, click on "Download CA"'),Object(o.b)("li",{parentName:"ol"},"Add the CA to your keychain:")),Object(o.b)("pre",{parentName:"div"},Object(o.b)("code",Object(a.a)({parentName:"pre"},{}),"sudo security add-trusted-cert -d -r trustRoot -k /Library/Keychains/System.keychain ~/Downloads/ca.crt\n")))),Object(o.b)("h3",{id:"activate-drone"},"Activate Drone"),Object(o.b)("p",null,Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"https://www.drone.io/"}),"Drone")," is an integral part of how Otomi cluster configuration is stored and updated."),Object(o.b)("ol",null,Object(o.b)("li",{parentName:"ol"},"Click on the ",Object(o.b)("strong",{parentName:"li"},"Drone")," app (under Platform/Otomi Apps) in the console.")),Object(o.b)("div",{className:"admonition admonition-info alert alert--info"},Object(o.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-heading"}),Object(o.b)("h5",{parentName:"div"},Object(o.b)("span",Object(a.a)({parentName:"h5"},{className:"admonition-icon"}),Object(o.b)("svg",Object(a.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(o.b)("path",Object(a.a)({parentName:"svg"},{fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"})))),"When you see this message: 'Jwks doesn't have key to match kid or alg from Jwt' Drone is not yet ready. Please wait for a couple of minutes and try again. :::")),Object(o.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-content"}),Object(o.b)("ol",Object(a.a)({parentName:"div"},{start:2}),Object(o.b)("li",{parentName:"ol"},"Sign in")),Object(o.b)("p",{parentName:"div"},'Gitea provides an oauth2 app connection for Drone to work with it\'s git values. It will popup when drone is accessed the first time. You can sign in with "OpenID Connect", which registers the login as a new user, or with the Gitea admin credentials (username: "otomi-admin", password: ',Object(o.b)("inlineCode",{parentName:"p"},"$otomi.adminPassword"),'). A job runs every 3 minutes promoting users with "admin" role to become co-owner of the otomi-values repo. When logging in with the admin user no waiting is necessary.'))),Object(o.b)("ol",{start:3},Object(o.b)("li",{parentName:"ol"},"Use the pre-filled values for the ",Object(o.b)("inlineCode",{parentName:"li"},"Username")," and ",Object(o.b)("inlineCode",{parentName:"li"},"Email Address")," and click ",Object(o.b)("inlineCode",{parentName:"li"},"Complete Account")),Object(o.b)("li",{parentName:"ol"},"Select ",Object(o.b)("inlineCode",{parentName:"li"},"Activate"))),Object(o.b)("p",null,Object(o.b)("img",{alt:"drone-landing",src:n(257).default})),Object(o.b)("ol",{start:5},Object(o.b)("li",{parentName:"ol"},"Click on ",Object(o.b)("inlineCode",{parentName:"li"},"ACTIVATE REPOSITORY"))),Object(o.b)("p",null,Object(o.b)("img",{alt:"drone-activate",src:n(258).default})),Object(o.b)("ol",{start:6},Object(o.b)("li",{parentName:"ol"},"Save the changes and you are good to go.")),Object(o.b)("p",null,Object(o.b)("img",{alt:"drone-save",src:n(259).default})),Object(o.b)("p",null,"Now the final step is to create a team. See the ",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"/docs/console/teams"}),"Teams")," page for more information."),Object(o.b)("h2",{id:"when-otomi-is-installed-with-optional-configuration"},"When Otomi is installed with optional configuration"),Object(o.b)("h3",{id:"sign-in-to-the-console-1"},"Sign in to the console"),Object(o.b)("p",null,"If Otomi is configured with ",Object(o.b)("inlineCode",{parentName:"p"},"hasExternalIDP=true")," and ",Object(o.b)("inlineCode",{parentName:"p"},"oidc"),' settings have been provided for an external IDP, click on the right button ("redkubes-azure" in the example below).'),Object(o.b)("p",null,Object(o.b)("img",{alt:"console-login",src:n(260).default})),Object(o.b)("p",null,'When OIDC is configured, an external IDP user needs to be a member of the "otomi-admin" group. Now follow the same steps as described above to activate Drone.'))}d.isMDXComponent=!0},189:function(e,t,n){"use strict";n.d(t,"a",(function(){return b})),n.d(t,"b",(function(){return u}));var a=n(0),i=n.n(a);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var c=i.a.createContext({}),d=function(e){var t=i.a.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},b=function(e){var t=d(e.components);return i.a.createElement(c.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return i.a.createElement(i.a.Fragment,{},t)}},m=i.a.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,r=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),b=d(n),m=a,u=b["".concat(r,".").concat(m)]||b[m]||p[m]||o;return n?i.a.createElement(u,l(l({ref:t},c),{},{components:n})):i.a.createElement(u,l({ref:t},c))}));function u(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,r=new Array(o);r[0]=m;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:a,r[1]=l;for(var c=2;c<o;c++)r[c]=n[c];return i.a.createElement.apply(null,r)}return i.a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},256:function(e,t,n){"use strict";n.r(t),t.default=n.p+"assets/images/console-landing-page-515451f2df816a4eb939656ab5302b06.png"},257:function(e,t,n){"use strict";n.r(t),t.default=n.p+"assets/images/drone-landing-ec436af98acc3e7ebf02819bd04df0d2.png"},258:function(e,t,n){"use strict";n.r(t),t.default=n.p+"assets/images/drone-activate-d0cdfcda638a52092ce04000db3ba07e.png"},259:function(e,t,n){"use strict";n.r(t),t.default=n.p+"assets/images/drone-save-2f6f70cf0b764de14c0b811f6cd12c44.png"},260:function(e,t,n){"use strict";n.r(t),t.default=n.p+"assets/images/console-login-674f187bd93d1c7535335041aa140840.png"}}]);