(window.webpackJsonp=window.webpackJsonp||[]).push([[36],{107:function(e,t,a){"use strict";a.r(t),a.d(t,"frontMatter",(function(){return r})),a.d(t,"metadata",(function(){return i})),a.d(t,"toc",(function(){return c})),a.d(t,"default",(function(){return p}));var n=a(3),o=a(7),l=(a(0),a(167)),r={slug:"ce/teams",title:"Configuring Teams in CE mode",sidebar_label:"Teams"},i={unversionedId:"ce-configure-teams",id:"ce-configure-teams",isDocsHomePage:!1,title:"Configuring Teams in CE mode",description:"When you are running Otomi in CE mode or doing local development, you will operate on values directly and have to apply them manually. Before you can start creating Services, Jobs and Secrets, you first need to create a Team. Follow these steps to create a team after deploying Otomi CE:",source:"@site/docs/ce-configure-teams.md",slug:"/ce/teams",permalink:"/docs/ce/teams",editUrl:"https://github.com/redkubes/redkubes/tree/master/docs/ce-configure-teams.md",version:"current",sidebar_label:"Teams",sidebar:"mainSidebar",previous:{title:"Team Apps",permalink:"/docs/ce/team-apps"},next:{title:"Configuring Services in CE mode",permalink:"/docs/ce/services"}},c=[{value:"Install Otomi CLI (optional)",id:"install-otomi-cli-optional",children:[]},{value:"Pull the values",id:"pull-the-values",children:[]},{value:"Bootstap the values (optional)",id:"bootstap-the-values-optional",children:[]},{value:"Adding a new team to the values",id:"adding-a-new-team-to-the-values",children:[{value:"1. Modify the teams.yaml",id:"1-modify-the-teamsyaml",children:[]}]},{value:"validate changes (optional)",id:"validate-changes-optional",children:[]},{value:"Deploy changes",id:"deploy-changes",children:[]},{value:"Automation",id:"automation",children:[]}],s={toc:c};function p(e){var t=e.components,a=Object(o.a)(e,["components"]);return Object(l.b)("wrapper",Object(n.a)({},s,a,{components:t,mdxType:"MDXLayout"}),Object(l.b)("p",null,"When you are running Otomi in CE mode or doing local development, you will operate on values directly and have to apply them manually. Before you can start creating Services, Jobs and Secrets, you first need to create a Team. Follow these steps to create a team after deploying Otomi CE:"),Object(l.b)("h2",{id:"install-otomi-cli-optional"},"Install Otomi CLI (optional)"),Object(l.b)("p",null,"If you haven't deployed Otomi with the CLI, install the Otomi CLI first. See ",Object(l.b)("a",Object(n.a)({parentName:"p"},{href:"/docs/cli"}),"here")," to install Otomi CLI."),Object(l.b)("h2",{id:"pull-the-values"},"Pull the values"),Object(l.b)("p",null,"Clone the ",Object(l.b)("inlineCode",{parentName:"p"},"otomi/values")," repository from ",Object(l.b)("inlineCode",{parentName:"p"},"gitea.<your.domain>/otomi/values")," (if not already done) to work with the values locally."),Object(l.b)("pre",null,Object(l.b)("code",Object(n.a)({parentName:"pre"},{className:"language-bash"}),"git clone https://gitea.<your.domain>/otomi/values.git\n")),Object(l.b)("h2",{id:"bootstap-the-values-optional"},"Bootstap the values (optional)"),Object(l.b)("p",null,"Bootstap the local values:"),Object(l.b)("pre",null,Object(l.b)("code",Object(n.a)({parentName:"pre"},{className:"language-bash"}),"otomi bootstap\n")),Object(l.b)("p",null,"Bootstrap will do the following:"),Object(l.b)("ul",null,Object(l.b)("li",{parentName:"ul"},"Add a ",Object(l.b)("inlineCode",{parentName:"li"},".vscode")," folder with Otomi extentions for autocompletion"),Object(l.b)("li",{parentName:"ul"},"Add the ",Object(l.b)("inlineCode",{parentName:"li"},"values-schema.yaml")," for values validation"),Object(l.b)("li",{parentName:"ul"},"Decrypt the secrets files")),Object(l.b)("p",null,"Create a ",Object(l.b)("inlineCode",{parentName:"p"},".env")," file in the ",Object(l.b)("inlineCode",{parentName:"p"},"env")," folder and add the following line:"),Object(l.b)("pre",null,Object(l.b)("code",Object(n.a)({parentName:"pre"},{className:"language-bash"}),'export K8S_CONTEXT="<the-context-of-your-k8s-cluster>"\n')),Object(l.b)("h2",{id:"adding-a-new-team-to-the-values"},"Adding a new team to the values"),Object(l.b)("p",null,"In the following steps we are going to create a team with the name 'demo':"),Object(l.b)("h3",{id:"1-modify-the-teamsyaml"},"1. Modify the teams.yaml"),Object(l.b)("p",null,"Add the team to the ",Object(l.b)("inlineCode",{parentName:"p"},"values/env/teams.yaml"),":"),Object(l.b)("pre",null,Object(l.b)("code",Object(n.a)({parentName:"pre"},{className:"language-yaml"}),"teamConfig:\n  teams:\n    demo:\n      id: demo\n")),Object(l.b)("p",null,"Add the team to the ",Object(l.b)("inlineCode",{parentName:"p"},"secrets.teams.yaml"),":"),Object(l.b)("pre",null,Object(l.b)("code",Object(n.a)({parentName:"pre"},{className:"language-yaml"}),"teamConfig:\n  teams:\n    demo:\n      password: somesecretvalue\n")),Object(l.b)("p",null,"Add the following 3 files to the ",Object(l.b)("inlineCode",{parentName:"p"},"/env/teams")," folder:"),Object(l.b)("ol",null,Object(l.b)("li",{parentName:"ol"},Object(l.b)("inlineCode",{parentName:"li"},"external-secrets.demo.yaml")),Object(l.b)("li",{parentName:"ol"},Object(l.b)("inlineCode",{parentName:"li"},"jobs.demo.yaml")),Object(l.b)("li",{parentName:"ol"},Object(l.b)("inlineCode",{parentName:"li"},"services.demo.yaml"))),Object(l.b)("p",null,"Each file should contain:"),Object(l.b)("pre",null,Object(l.b)("code",Object(n.a)({parentName:"pre"},{className:"language-yaml"}),"{}\n")),Object(l.b)("h2",{id:"validate-changes-optional"},"validate changes (optional)"),Object(l.b)("p",null,"Now validate the new values based on the Otomi values schema:"),Object(l.b)("pre",null,Object(l.b)("code",Object(n.a)({parentName:"pre"},{className:"language-bash"}),"otomi validate-values\n")),Object(l.b)("p",null,"Use ",Object(l.b)("inlineCode",{parentName:"p"},"-v")," to get more output (or ",Object(l.b)("inlineCode",{parentName:"p"},"-vvv")," to get even more output). See ",Object(l.b)("a",Object(n.a)({parentName:"p"},{href:"/docs/cli/validate-values"}),"here")," for a full list of ",Object(l.b)("inlineCode",{parentName:"p"},"otomi validate")," command options. When successful, the output will show: ",Object(l.b)("inlineCode",{parentName:"p"},"otomi:validate-values:verbose Values validation SUCCESSFUL")),Object(l.b)("h2",{id:"deploy-changes"},"Deploy changes"),Object(l.b)("p",null,"Deploy the changes using Otomi CLI:"),Object(l.b)("pre",null,Object(l.b)("code",Object(n.a)({parentName:"pre"},{className:"language-bash"}),"otomi apply\n")),Object(l.b)("p",null,"Use ",Object(l.b)("inlineCode",{parentName:"p"},"-v")," to get more output (or ",Object(l.b)("inlineCode",{parentName:"p"},"-vvv")," to get even more output). See ",Object(l.b)("a",Object(n.a)({parentName:"p"},{href:"/docs/cli/apply"}),"here")," for a full list of ",Object(l.b)("inlineCode",{parentName:"p"},"otomi apply")," command options."),Object(l.b)("h2",{id:"automation"},"Automation"),Object(l.b)("p",null,"When you create a Team, a lot of configuration is done automatically for you behind the scenes:"),Object(l.b)("ul",null,Object(l.b)("li",{parentName:"ul"},"Teams are each given a project in Harbor, allowing team users to push and pull container images and create secrets for automation"),Object(l.b)("li",{parentName:"ul"},"Two ingress gateways are automatically configured per team: one for SSO traffic and one for public exposure"),Object(l.b)("li",{parentName:"ul"},"Nginx-ingress ingress resources are automatically generated for all integrated applications and for team services. There is also configuration exposed allowing admins to turn on special Nginx features like throttling or OWASP rule checking"),Object(l.b)("li",{parentName:"ul"},"All teams automatically get their own Prometheus, Alertmanager, and Grafana instance, allowing them to view only their own resources"),Object(l.b)("li",{parentName:"ul"},"Teams are each given a space in Vault where the team can create and manage their own secrets")))}p.isMDXComponent=!0},167:function(e,t,a){"use strict";a.d(t,"a",(function(){return u})),a.d(t,"b",(function(){return d}));var n=a(0),o=a.n(n);function l(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function r(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?r(Object(a),!0).forEach((function(t){l(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function c(e,t){if(null==e)return{};var a,n,o=function(e,t){if(null==e)return{};var a,n,o={},l=Object.keys(e);for(n=0;n<l.length;n++)a=l[n],t.indexOf(a)>=0||(o[a]=e[a]);return o}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(n=0;n<l.length;n++)a=l[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(o[a]=e[a])}return o}var s=o.a.createContext({}),p=function(e){var t=o.a.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},u=function(e){var t=p(e.components);return o.a.createElement(s.Provider,{value:t},e.children)},b={inlineCode:"code",wrapper:function(e){var t=e.children;return o.a.createElement(o.a.Fragment,{},t)}},m=o.a.forwardRef((function(e,t){var a=e.components,n=e.mdxType,l=e.originalType,r=e.parentName,s=c(e,["components","mdxType","originalType","parentName"]),u=p(a),m=n,d=u["".concat(r,".").concat(m)]||u[m]||b[m]||l;return a?o.a.createElement(d,i(i({ref:t},s),{},{components:a})):o.a.createElement(d,i({ref:t},s))}));function d(e,t){var a=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var l=a.length,r=new Array(l);r[0]=m;var i={};for(var c in t)hasOwnProperty.call(t,c)&&(i[c]=t[c]);i.originalType=e,i.mdxType="string"==typeof e?e:n,r[1]=i;for(var s=2;s<l;s++)r[s]=a[s];return o.a.createElement.apply(null,r)}return o.a.createElement.apply(null,a)}m.displayName="MDXCreateElement"}}]);