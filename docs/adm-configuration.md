---
id: configuration
title: Configuration & deployment
---

Assuming the setup steps are completed, you need to now configure the Otomi values repository. This repo is the source configuration for Otomi Container Platform. It contains drone pipeline configurations for each cluster, and each running drone will listen to updates of this repo. Any updated values might result in different cluster state resources, which will be applied by the Otomi image.

## 1. Configuration

Configuration can be done most easily through the Otomi UI. So if you have a license please refer to the [Administration Overview](administration-overview).

For manual configuration please open the [Otomi openapi docs](/otomi/docApi) for reference, and follow these steps:

1. Configure `env/clusters.yaml`
2. Add cloud config: `env/$CLOUD/default.yaml`
3. Add cluster configs `env/$CLOUD/$CLUSTER.(yaml|sh)`

## 2. Validation
Once these essential files are configured, validate the results:
```bash
# bootstrap all the aliases and functions
bin/bootstrap.sh
# now validate
drun bin/validate-repo.sh
```

When all is well you can move on to deployment:
```bash
drun bin/deploy.sh
```
This will show a list of actions and their output, generated by [helmfile](https://github.com/roboll/helmfile).
When all goes to plan you should commit the values. Encryption will happen automatically since you bootstrapped the repo, which installed the necessary git hooks.
In case you wish to encrypt manually:
```bash
drun bin/crypt.sh enc
```
All the `*.yaml` files will be automatically encrypted, and stay that way. Decryption will result in new files with a `.yaml.dec` extension. Any future manual configuration changes will have to be applied in these decrypted files.

## 3. Deployment

Now that you have the repo values configured, you can do the initial deployment:

```bash
# choose your CLOUD & CLUSTER and source the bootstrap tools
export CLOUD=azure && CLUSTER=dev && source bin/bootstrap.sh
# deploy from the Otomi image
drun
```

## 4. GitOps syncing

After initial deployment, to enable Continuous Deployment of this repo from within Drone (running in the cluster), for each cluster:

1. Login to Drone and activate the repo to sync with: https://drone.$CLUSTER_DOMAIN
2. Choose the drone pipeline file to use: `.env/(azure|google|aws)/.drone.($CLUSTER_N).yml` and press save.

Sync is now live, and every git change is applied by each cluster's Drone.

After these steps you will probably have many [development iterations](./development.md).