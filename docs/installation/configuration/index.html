<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.70">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Otomi Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Otomi Blog Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-KKV4ZVDEKQ"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-KKV4ZVDEKQ",{})</script>
<link rel="search" type="application/opensearchdescription+xml" title="Otomi" href="/opensearch.xml"><title data-react-helmet="true">Configuration | Otomi</title><meta data-react-helmet="true" property="og:image" content="https://otomi.io/img/otomi-logo.svg"><meta data-react-helmet="true" name="twitter:image" content="https://otomi.io/img/otomi-logo.svg"><meta data-react-helmet="true" name="twitter:image:alt" content="Image for Otomi"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Configuration | Otomi"><meta data-react-helmet="true" name="description" content="Assuming the setup steps are completed, you need to now configure the Otomi values repository. This repo is the source configuration for Otomi Container Platform. It contains drone pipeline configuration for listening to updates of these values targeting the cluster the drone instance is running on."><meta data-react-helmet="true" property="og:description" content="Assuming the setup steps are completed, you need to now configure the Otomi values repository. This repo is the source configuration for Otomi Container Platform. It contains drone pipeline configuration for listening to updates of these values targeting the cluster the drone instance is running on."><meta data-react-helmet="true" property="og:url" content="https://otomi.io/docs/installation/configuration"><link data-react-helmet="true" rel="shortcut icon" href="/img/otomi.ico"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link data-react-helmet="true" rel="canonical" href="https://otomi.io/docs/installation/configuration"><link rel="stylesheet" href="/styles.91a2fb7d.css">
<link rel="preload" href="/styles.3afc5b14.js" as="script">
<link rel="preload" href="/runtime~main.d4e759f8.js" as="script">
<link rel="preload" href="/main.6016d89e.js" as="script">
<link rel="preload" href="/1.d34b5c9c.js" as="script">
<link rel="preload" href="/2.d6929fd0.js" as="script">
<link rel="preload" href="/54.88da777f.js" as="script">
<link rel="preload" href="/57.3030cd8d.js" as="script">
<link rel="preload" href="/935f2afb.35fe72cd.js" as="script">
<link rel="preload" href="/17896441.fe331e03.js" as="script">
<link rel="preload" href="/4c6e2a2f.e428d575.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_11B0">Skip to main content</button></nav><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" target="_self" href="/"><img src="/img/otomi-logo.svg" alt="Site Logo" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/img/otomi-logo.svg" alt="Site Logo" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"></a><a class="navbar__item navbar__link" href="/about/">About</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/installation/">Docs</a><a class="navbar__item navbar__link" href="/docs/console/">Otomi Console</a><a class="navbar__item navbar__link" href="/docs/faq">FAQ</a><a class="navbar__item navbar__link" href="/community/support">Community</a><a class="navbar__item navbar__link" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/redkubes/otomi-core" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2N3Q"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_3NWk">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_3NWk">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><div class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></div></button></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" target="_self" href="/"><img src="/img/otomi-logo.svg" alt="Site Logo" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/img/otomi-logo.svg" alt="Site Logo" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/about/">About</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/docs/installation/">Docs</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/console/">Otomi Console</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/faq">FAQ</a></li><li class="menu__list-item"><a class="menu__link" href="/community/support">Community</a></li><li class="menu__list-item"><a class="menu__link" href="/blog">Blog</a></li><li class="menu__list-item"><a href="https://github.com/redkubes/otomi-core" target="_blank" rel="noopener noreferrer" class="menu__link header-github-link" aria-label="GitHub repository"></a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_vMrn"><div class="docSidebarContainer_3Ak5" role="complementary"><div class="sidebar_3gvy"><div class="menu menu--responsive thin-scrollbar menu_1yIk"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_1CUI" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Installation</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/installation/">Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/installation/prerequisites">Prerequisites</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/installation/setup">Setup</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/installation/configuration">Configuration</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/installation/deployment">Deployment</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Otomi Console</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/console/">Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/console/configuring-apps">Configuring apps</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/console/configuring-clusters">Configuring clusters</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/console/configuring-teams">Configuring teams</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/console/configuring-services">Configuring services</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/console/configuring-secrets">Configuring secrets</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/console/settings">Settings</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/console/deploy-changes">Deploy changes</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Known Issues</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/known-issues/">Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/known-issues/cli">Otomi CLI</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Apps</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/known-issues/harbor">Harbor</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/known-issues/loki">Loki</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Lifecycle Management</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/lifecycle-management/">Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/lifecycle-management/upgrades">Upgrades</a></li></ul></li></ul></div></div></div><main class="docMainContainer_2iGs"><div class="container padding-vert--lg docItemWrapper_1bxp"><div class="row"><div class="col docItemCol_U38p"><div class="docItemContainer_a7m4"><article><header><h1 class="docTitle_Oumm">Configuration</h1></header><div class="markdown"><p>Assuming the setup steps are completed, you need to now configure the Otomi values repository. This repo is the source configuration for Otomi Container Platform. It contains drone pipeline configuration for listening to updates of these values targeting the cluster the drone instance is running on.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="1-configuration"></a>1. Configuration<a class="hash-link" href="#1-configuration" title="Direct link to heading">#</a></h2><p>Configuration can be performed much easier through the Otomi Console. So if you have a license please refer to the <a href="/docs/console">Otomi Console</a> documentation.</p><p>Not all configuration is (yet) exposed through the console however, so please look at the values repo&#x27;s <code>env/*</code> files to edit the configuration files.</p><p>Important things to note:</p><ul><li>Every configuration file can have a <code>secrets.*.yaml</code> counterpart, but these are optional.</li><li>A json schema and vscode settings are imported by the bootrap (in <code>.vscode/*</code>), so you will have automatic linting and hinting for the configuration when vscode is used.</li><li>If <code>.sops.yaml</code> is correctly configured then automatic de-/en-cryption will also be performed when in vscode and editing a <code>secrets.*.yaml</code> file.</li></ul><p>Configuration that is currently managed by the console:</p><ol><li>Team settings: <code>env/teams.yaml</code></li><li>Team secrets: <code>env/teams/secrets.$TEAM.yaml</code></li><li>Team services: <code>env/teams/services.$TEAM.yaml</code></li></ol><p>Configuration not (yet) managed by the console:</p><ol><li>Cluster config: <code>env/cluster.yaml</code> and <code>env/.env</code></li><li>Otomi settings: <code>env/settings.yaml</code> and <code>env/secrets.settings.yaml</code></li><li>Charts config: <code>env/charts/$CHART.yaml</code> and <code>env/charts/secrets.$CHART.yaml</code></li></ol><p>Please follow the guidance of the yaml hinting, as it has all the descriptions and example values you need to operate on these files.</p><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>Otomi YAML hinting only works in vscode</h5></div><div class="admonition-content"><p>VSCode automatically loads the &#x27;.vscode/values-schema.yaml&#x27; schema provided. Please inspect it or wire it up manually when using another editor.</p></div></div><div class="admonition admonition-caution alert alert--warning"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>Make sure to have working dns management credentials</h5></div><div class="admonition-content"><p>The most important part to get the platform deployed is having correctly set credentials for dns management. Without it no domains nor ip addresses can be registered, and certificate validation will fail.</p></div></div><p>If you wish to be sure of your changes, you can always do a <code>git diff</code>. When you chose to use encryption and have correctly followed the corresponding instructions, then you should see a diff with the unencrypted values. That is, if you modified any ;)</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="2-validation"></a>2. Validation<a class="hash-link" href="#2-validation" title="Direct link to heading">#</a></h2><p>When you are done with the configuration you can validate the results:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-bash codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">otomi validate-values</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>If you have made an error in the format of the values this will be reported.</p><p>To check if all the output manifests are valid for the target cluster&#x27;s k8s version, <em>and</em> following best practices you can run another variation:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-bash codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">otomi validate-templates</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="3-configure-dependencies"></a>3. Configure Dependencies<a class="hash-link" href="#3-configure-dependencies" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="idp"></a>IDP<a class="hash-link" href="#idp" title="Direct link to heading">#</a></h3><p>In our demo files we refer to Azure AD as IDP for Keycloak, which is a common use case. It needs to know the valid callbacks to return control to Otomi&#x27;s oauth endpoints. The following callbacks needed to be in place (change $clusterDomain to proper one):</p><ul><li><a href="https://auth.$clusterDomain.oauth2/callback" target="_blank" rel="noopener noreferrer">https://auth.$clusterDomain.oauth2/callback</a></li><li><a href="https://keycloak.$clusterDomain/realms/master/broker/redkubes-azure/endpoint" target="_blank" rel="noopener noreferrer">https://keycloak.$clusterDomain/realms/master/broker/redkubes-azure/endpoint</a></li><li><a href="https://harbor.$clusterDomain/c/oidc/callback" target="_blank" rel="noopener noreferrer">https://harbor.$clusterDomain/c/oidc/callback</a></li><li><a href="https://keycloak.$clusterDomain" target="_blank" rel="noopener noreferrer">https://keycloak.$clusterDomain</a></li></ul><p>This will be the same for any IDP.</p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/redkubes/redkubes/tree/master/docs/inst-configuration.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2LL7"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/installation/setup"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Setup</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/installation/deployment"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Deployment Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_2xL- thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#1-configuration" class="table-of-contents__link">1. Configuration</a></li><li><a href="#2-validation" class="table-of-contents__link">2. Validation</a></li><li><a href="#3-configure-dependencies" class="table-of-contents__link">3. Configure Dependencies</a><ul><li><a href="#idp" class="table-of-contents__link">IDP</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Otomi</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/about/">Introduction</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/console/">Community Edition</a></li><li class="footer__item"><a href="https://redkubes.com/otomi-container-platform-product-sheet/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Product sheet</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://github.com/redkubes/redkubes/issues" target="_blank" rel="noopener noreferrer" class="footer__link-item">Feedback</a></li><li class="footer__item"><a href="https://gitter.im/redkubes/community" target="_blank" rel="noopener noreferrer" class="footer__link-item">Gitter</a></li><li class="footer__item"><a class="footer__link-item" href="/community/support">Help</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Red Kubes</h4><ul class="footer__items"><li class="footer__item"><a href="https://redkubes.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">Website</a></li><li class="footer__item"><a href="https://github.com/redkubes/" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li><li class="footer__item"><a href="https://www.linkedin.com/company/red-kubes/" target="_blank" rel="noopener noreferrer" class="footer__link-item">LinkedIN</a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><img class="footer__logo" alt="Otomi Open Source Logo" src="/img/otomi-logo-small.svg"></div><div class="footer__copyright">Copyright Â© 2021 Red Kubes. Built with <a href="https://v2.docusaurus.io/">Docusaurus</a></div></div></div></footer></div>
<script src="/styles.3afc5b14.js"></script>
<script src="/runtime~main.d4e759f8.js"></script>
<script src="/main.6016d89e.js"></script>
<script src="/1.d34b5c9c.js"></script>
<script src="/2.d6929fd0.js"></script>
<script src="/54.88da777f.js"></script>
<script src="/57.3030cd8d.js"></script>
<script src="/935f2afb.35fe72cd.js"></script>
<script src="/17896441.fe331e03.js"></script>
<script src="/4c6e2a2f.e428d575.js"></script>
</body>
</html>