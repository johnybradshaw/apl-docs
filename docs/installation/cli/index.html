<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.15">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Otomi RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Otomi Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-KKV4ZVDEKQ"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-KKV4ZVDEKQ",{})</script>
<link rel="search" type="application/opensearchdescription+xml" title="Otomi" href="/opensearch.xml"><title data-react-helmet="true">Install with CLI | Otomi</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:image" content="https://otomi.io/img/otomi-logo.svg"><meta data-react-helmet="true" name="twitter:image" content="https://otomi.io/img/otomi-logo.svg"><meta data-react-helmet="true" property="og:url" content="https://otomi.io/docs/installation/cli/"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Install with CLI | Otomi"><meta data-react-helmet="true" name="description" content="1. Initialize a values repo"><meta data-react-helmet="true" property="og:description" content="1. Initialize a values repo"><link data-react-helmet="true" rel="icon" href="/img/otomi.ico"><link data-react-helmet="true" rel="canonical" href="https://otomi.io/docs/installation/cli/"><link data-react-helmet="true" rel="alternate" href="https://otomi.io/docs/installation/cli/" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://otomi.io/docs/installation/cli/" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.ac5a89a4.css">
<link rel="preload" href="/assets/js/runtime~main.b99a3a7f.js" as="script">
<link rel="preload" href="/assets/js/main.b3779b87.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><div class="announcementBar_IbjG" style="background-color:#0d47a1;color:#ffd700" role="banner"><div class="announcementBarPlaceholder_NC_W"></div><div class="announcementBarContent_KsVm">If you like Otomi, give it a ‚≠êÔ∏è on <a target="_blank" rel="noopener noreferrer" href="https://github.com/redkubes/otomi-core">GitHub</a>!</div><button type="button" class="clean-btn close announcementBarClose_FG1z" aria-label="Close"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" target="_self" href="/"><div class="navbar__logo"><img src="/img/otomi-logo.svg" alt="Site Logo" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/img/otomi-logo.svg" alt="Site Logo" class="themedImage_W2Cr themedImage--dark_oUvU"></div></a><a class="navbar__item navbar__link" href="/about/">About</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/installation/">Docs</a><a class="navbar__item navbar__link" href="/docs/faq">FAQ</a><a class="navbar__item navbar__link" href="/community/get-involved">Community</a><a class="navbar__item navbar__link" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/redkubes/otomi-core" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="toggle_Pssr toggle_TdHA toggleDisabled_jDku"><div class="toggleTrack_SSoT" role="button" tabindex="-1"><div class="toggleTrackCheck_XobZ"><span class="toggleIcon_eZtF">üåú</span></div><div class="toggleTrackX_YkSC"><span class="toggleIcon_eZtF">üåû</span></div><div class="toggleTrackThumb_uRm4"></div></div><input type="checkbox" class="toggleScreenReader_JnkT" aria-label="Switch between dark and light mode"></div><div class="searchBox_qEbK"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_P2Lg"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_RiI4" type="button"></button><main class="docMainContainer_TCnq docMainContainerEnhanced_WDCb"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_DM6M"><div class="docItemContainer_vinB"><article><div class="tocCollapsible_jdIR theme-doc-toc-mobile tocMobile_TmEX"><button type="button" class="clean-btn tocCollapsibleButton_Fzxq">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Install with CLI</h1></header><h2 class="anchor anchorWithStickyNavbar_mojV" id="1-initialize-a-values-repo">1. Initialize a values repo<a class="hash-link" href="#1-initialize-a-values-repo" title="Direct link to heading">‚Äã</a></h2><p>Otomi needs a git repo to store its configuration. We call it a <strong><em>values</em></strong> repo.</p><p>In order to quickly get up and running it is advised to download the <a href="https://github.com/redkubes/otomi-core/blob/master/chart/otomi/values.yaml" target="_blank" rel="noopener noreferrer">chart values</a> and fill in the values.</p><p>The following commands bootstrap the values repo:</p><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx bash"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># map the chart values.yaml as initial input:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">VALUES_INPUT</span><span class="token operator" style="color:#393A34">=</span><span class="token environment constant" style="color:#36acaa">$PWD</span><span class="token plain">/values.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># point to a folder that is or will become the values repo</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">ENV_DIR</span><span class="token operator" style="color:#393A34">=</span><span class="token environment constant" style="color:#36acaa">$PWD</span><span class="token plain">/otomi-values</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># and bootstrap all the files in there</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">otomi bootstrap</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="2-customize-configuration">2. Customize configuration<a class="hash-link" href="#2-customize-configuration" title="Direct link to heading">‚Äã</a></h2><p>The essential otomi platform configurations is stored in <code>env/cluster.yaml</code>, <code>env/settings.yaml</code> and <code>env/secrets.settings.yaml</code> files. Inspect them and customize values to match your environment.</p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>The minimum required input is found in the <a href="https://github.com/redkubes/otomi-core/blob/master/chart/otomi/values.yaml" target="_blank" rel="noopener noreferrer">chart values</a>.</p></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="3-configure-credentials-from-a-kms-optional">3. Configure credentials from a KMS (optional)<a class="hash-link" href="#3-configure-credentials-from-a-kms-optional" title="Direct link to heading">‚Äã</a></h2><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>No encryption needed?</h5></div><div class="admonition-content"><p>If you don&#x27;t need encryption straight away please continue to the next step</p></div></div><p>Otomi will encrypt any <code>secrets.*.yaml</code> files with <a href="https://github.com/mozilla/sops" target="_blank" rel="noopener noreferrer">sops</a>, but only if it finds <code>sops:</code> configuration details. In order to have access to the KMS credentials to encrypt/decrypt, a <code>.secrets</code> file needs to exist and have those credentials. Please <code>copy .secrets.sample .secrets</code> and fill it in with the credentials from the <a href="/docs/installation/prerequisites">prerequisites</a>.</p><p>Then you can run <code>otomi bootstrap</code>, which will result in the encryption and decryption of the secrets files.</p><p><strong>Note to developers:</strong></p><p>To allow <code>git diff</code> to show unencrypted values, you must register the sops diffing routine once with git. To register it:</p><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx bash"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">git</span><span class="token plain"> config diff.sopsdiffer.textconv </span><span class="token string" style="color:#e3116c">&#x27;sops -d&#x27;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>This only registers the sops differ, which is responsible for invoking sops. But sops still needs the credentials to the KMS service. Again, your AWS profile is always pointed and loaded, but in case of Google KMS you will need to point GOOGLE_APPLICATION_CREDENTIALS to the <code>gcp-key.json</code> file holding your account information:</p><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx bash"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">GOOGLE_APPLICATION_CREDENTIALS</span><span class="token operator" style="color:#393A34">=</span><span class="token environment constant" style="color:#36acaa">$PWD</span><span class="token plain">/gcp-key.json</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Now try a diff:</p><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx bash"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">git</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">diff</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="4-start-otomi-console-on-your-local-machine-optional">4. Start Otomi Console on your local machine (optional)<a class="hash-link" href="#4-start-otomi-console-on-your-local-machine-optional" title="Direct link to heading">‚Äã</a></h2><p>Bootstrap again and start the console:</p><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx bash"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">otomi bootstrap</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">otomi console</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>The console allows for easy configuration of many settings but not all. Assuming the setup steps are completed, you need to now configure the Otomi values repository. This repo is the source configuration for Otomi Container Platform. It contains drone pipeline configuration for listening to updates of these values targeting the cluster the drone instance is running on.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="5-configuration">5. Configuration<a class="hash-link" href="#5-configuration" title="Direct link to heading">‚Äã</a></h2><p>Configuration can be performed much easier through the Otomi Console, so please refer to the <a href="/docs/console/">Otomi Console</a> documentation.</p><p>However, chart configuration is not (yet) exposed through the console, so please look at the values repo&#x27;s <code>env/charts/*</code> files to edit the configuration files.</p><p>Important things to note:</p><ul><li>Every configuration file can have a <code>secrets.*.yaml</code> counterpart, but these are optional.</li><li>A json schema and vscode settings are imported by the bootrap (in <code>.vscode/*</code>), so you will have automatic linting and hinting for the configuration when vscode is used (try CTRL+SPACE in the yaml).</li><li>If <code>.secrets</code> is correctly configured then automatic de-/en-cryption will also be performed when in vscode and editing a <code>secrets.*.yaml</code> file.</li></ul><p>Please follow the guidance of the yaml hinting, as it has all the descriptions and example values you need to operate on these files.</p><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>Otomi YAML hinting only works in vscode</h5></div><div class="admonition-content"><p>VSCode automatically loads the &#x27;.vscode/values-schema.yaml&#x27; schema provided. Please inspect it or wire it up manually when using another editor.</p></div></div><p>If you wish to be sure of your changes, you can always do a <code>git diff</code>. When you chose to use encryption and have correctly followed the corresponding instructions, then you should see a diff with the unencrypted values. That is, if you modified any ;)</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="6-validation">6. Validation<a class="hash-link" href="#6-validation" title="Direct link to heading">‚Äã</a></h2><p>When you are done with the configuration you can validate the results:</p><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx bash"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">otomi validate-values</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>If you have made an error in the format of the values this will be reported.</p><p>To check if all the output manifests are valid for the target cluster&#x27;s k8s version, <em>and</em> following best practices you can run another variation:</p><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx bash"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">otomi validate-templates</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="7-deployment">7. Deployment<a class="hash-link" href="#7-deployment" title="Direct link to heading">‚Äã</a></h2><h3 class="anchor anchorWithStickyNavbar_mojV" id="charted-vs-uncharted-resources">Charted vs uncharted resources<a class="hash-link" href="#charted-vs-uncharted-resources" title="Direct link to heading">‚Äã</a></h3><p>The output manifests generated by otomi are deployed in two ways:</p><ul><li>Uncharted: some base manifests are applied directly with <code>kubectl apply</code></li><li>Charted: manfests that are packaged up in helm charts.</li></ul><p>Ideally, we would like to deploy as helm chart as it has <a href="https://www.google.nl/search?q=benefits+of+helm+chart" target="_blank" rel="noopener noreferrer">many benefits</a> such as rollback. But in some cases we can&#x27;t or we don&#x27;t wish to. The reasons for that are the following:</p><ol><li>Some resources we don&#x27;t want governed by charts (as charts might get accidentally removed, erasing everything that was deployed with it).</li><li>Some existing resources have to be patched (like pull secrets in service accounts), which helmfile won&#x27;t do as it will not modify existing resources not annotated to be under control by a chart.</li><li>Some resources need to exist before the charts are deployed (such as CRDs).</li></ol><p>The manifests that are currently not charted are:</p><ul><li><code>k8s/base</code> (unparameterized, mostly rbac roles)</li><li><code>values/cloud</code> (applies cloud specific &quot;normalization&quot; patterns, such as for storageclasses)</li><li><code>values/k8s</code> (team resources, such as namespaces, service accounts, pull secrets)</li></ul><h3 class="anchor anchorWithStickyNavbar_mojV" id="working-with-uncharted-resources">Working with uncharted resources<a class="hash-link" href="#working-with-uncharted-resources" title="Direct link to heading">‚Äã</a></h3><p>Currently we don&#x27;t have any subcommand that only works on uncharted resources, but we have the following commands that target the entire bundle.</p><ul><li><code>otomi test</code>: does a dry run, showing all manifests that will be deployed, and will also show any errors in the output manifests.</li><li><code>otomi apply</code>: deploys all the manifests (uncharted first, then charted)</li></ul><p>So after doing <code>otomi test</code>, if all looks ok, go ahead and do the initial deployment of all resources:</p><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx bash"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">otomi apply</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>This command executes two stages (please see <code>binzx/apply.ts</code>). The first stage will deploy all uncharted resources with <code>kubectl apply</code>, and the second stage will deploy all the charted resources with <code>helmfile apply</code>.</p><p>Whenever you add a team, or change or add to these uncharted resources, you have to run <code>otomi apply</code> to apply them. When you let Drone do the syncing for you, it will invoke that command to synchronize the cluster.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="working-with-charted-resources">Working with charted resources<a class="hash-link" href="#working-with-charted-resources" title="Direct link to heading">‚Äã</a></h3><p>During development iterations you will probably not touch uncharted resources often, but instead you will add features in charts.</p><p>Otomi has these subcommands that only target charted resources:</p><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx bash"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">otomi </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">diff</span><span class="token operator" style="color:#393A34">|</span><span class="token plain">apply</span><span class="token operator" style="color:#393A34">|</span><span class="token function" style="color:#d73a49">sync</span><span class="token operator" style="color:#393A34">|</span><span class="token plain">template</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>You can always target a single chart like this:</p><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx bash"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">otomi </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">diff</span><span class="token operator" style="color:#393A34">|</span><span class="token plain">apply</span><span class="token operator" style="color:#393A34">|</span><span class="token function" style="color:#d73a49">sync</span><span class="token operator" style="color:#393A34">|</span><span class="token plain">template</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> -l </span><span class="token assign-left variable" style="color:#36acaa">name</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">prometheus-operator</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>(For a list of all supported flags to use those subcommands, we defer to the <a href="https://github.com/roboll/helmfile" target="_blank" rel="noopener noreferrer">helmfile documentation</a>, as those are deferred to the helmfile cli.)</p><p>Let&#x27;s do a diff of all the charts that are enabled:</p><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx bash"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">otomi </span><span class="token function" style="color:#d73a49">diff</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="need-to-know-quirks">Need to know quirks<a class="hash-link" href="#need-to-know-quirks" title="Direct link to heading">‚Äã</a></h3><p>Whenever you modify resources without using helm, its internal bookkeeping (the versioned secrets in the namespaces) will not change, and any subsequent <code>otomi apply</code> commands will not modify anything. If you notice this, and want to overwrite with the output manifests, you can use <code>otomi sync</code>, which will skip doing a diff, and instead apply all charted manifests as a new version.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="8-committing-values">8. Committing values<a class="hash-link" href="#8-committing-values" title="Direct link to heading">‚Äã</a></h2><p>To commit values and run post processing tasks:</p><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx bash"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">otomi commit</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>This will detect any version changes, generate Drone pipeline configuration, and then commit all files with a standardized message &quot;Manual commit&quot;. (We believe all values repo configuration changes are equally meaningful and don&#x27;t need explicit commit messages.) Directly doing a <code>git commit</code> is discouraged with a git hook saying so, but whenever you did not touch any versions in <code>env/clusters.yaml</code> you may bypass with <code>git commit -m &quot;Manual commit&quot; --no-verify</code> to save development time.</p><p>This will then trigger the pipeline of any <a href="https://drone.$clusterDomain/" target="_blank" rel="noopener noreferrer">configured Drone</a> (if you followed the postinstall step).</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/redkubes/redkubes.github.io/tree/master/docs/inst-cli.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_dcUD" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_foO9"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div><div class="col col--3"><div class="tableOfContents_cNA8 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#1-initialize-a-values-repo" class="table-of-contents__link toc-highlight">1. Initialize a values repo</a></li><li><a href="#2-customize-configuration" class="table-of-contents__link toc-highlight">2. Customize configuration</a></li><li><a href="#3-configure-credentials-from-a-kms-optional" class="table-of-contents__link toc-highlight">3. Configure credentials from a KMS (optional)</a></li><li><a href="#4-start-otomi-console-on-your-local-machine-optional" class="table-of-contents__link toc-highlight">4. Start Otomi Console on your local machine (optional)</a></li><li><a href="#5-configuration" class="table-of-contents__link toc-highlight">5. Configuration</a></li><li><a href="#6-validation" class="table-of-contents__link toc-highlight">6. Validation</a></li><li><a href="#7-deployment" class="table-of-contents__link toc-highlight">7. Deployment</a><ul><li><a href="#charted-vs-uncharted-resources" class="table-of-contents__link toc-highlight">Charted vs uncharted resources</a></li><li><a href="#working-with-uncharted-resources" class="table-of-contents__link toc-highlight">Working with uncharted resources</a></li><li><a href="#working-with-charted-resources" class="table-of-contents__link toc-highlight">Working with charted resources</a></li><li><a href="#need-to-know-quirks" class="table-of-contents__link toc-highlight">Need to know quirks</a></li></ul></li><li><a href="#8-committing-values" class="table-of-contents__link toc-highlight">8. Committing values</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Otomi</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/about/">Introduction</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/installation/">Installation</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/console/">Using Otomi Console</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://otomi.slack.com/join/shared_invite/zt-12h11e8aa-6po4NWhhpMXxT~nffDsYqA#/shared-invite/email" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Slack<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://gitter.im/redkubes/community" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Gitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a class="footer__link-item" href="/community/get-involved">Community page</a></li></ul></div><div class="col footer__col"><div class="footer__title">Red Kubes</div><ul class="footer__items"><li class="footer__item"><a href="https://redkubes.com" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Website<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://github.com/redkubes/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://www.linkedin.com/company/red-kubes/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>LinkedIn<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><img src="/img/otomi-logo.svg" alt="Otomi Open Source Logo" class="themedImage_W2Cr themedImage--light_TfLj footer__logo"><img src="/img/otomi-logo.svg" alt="Otomi Open Source Logo" class="themedImage_W2Cr themedImage--dark_oUvU footer__logo"></div><div class="footer__copyright">Copyright ¬© 2022 Red Kubes. Built with <a href="https://v2.docusaurus.io/">Docusaurus</a></div></div></div></footer></div>
<script src="/assets/js/runtime~main.b99a3a7f.js"></script>
<script src="/assets/js/main.b3779b87.js"></script>
</body>
</html>