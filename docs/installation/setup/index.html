<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.69">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-KKV4ZVDEKQ"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-KKV4ZVDEKQ",{})</script><title data-react-helmet="true">Setup | Otomi</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docusaurus_language" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Setup | Otomi"><meta data-react-helmet="true" name="description" content="1. Initialize a values repo"><meta data-react-helmet="true" property="og:description" content="1. Initialize a values repo"><meta data-react-helmet="true" property="og:url" content="https://otomi.io//docs/installation/setup"><link data-react-helmet="true" rel="shortcut icon" href="/img/otomi.ico"><link data-react-helmet="true" rel="canonical" href="https://otomi.io//docs/installation/setup"><link rel="stylesheet" href="/styles.d88c2165.css">
<link rel="preload" href="/styles.ef061321.js" as="script">
<link rel="preload" href="/runtime~main.6e03e7c6.js" as="script">
<link rel="preload" href="/main.752e440e.js" as="script">
<link rel="preload" href="/1.5b2c8a6e.js" as="script">
<link rel="preload" href="/42.df5c080a.js" as="script">
<link rel="preload" href="/43.2c8a4dfd.js" as="script">
<link rel="preload" href="/935f2afb.98710004.js" as="script">
<link rel="preload" href="/41.8e2bd9a7.js" as="script">
<link rel="preload" href="/c99baebb.173279e3.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_2AhQ">Skip to main content</button></nav><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" target="_self" href="/"><img src="/img/otomi-logo.svg" alt="Site Logo" class="themedImage_2E_h themedImage--light_AouX navbar__logo"><img src="/img/otomi-logo.svg" alt="Site Logo" class="themedImage_2E_h themedImage--dark_1YPN navbar__logo"></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/">About</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/">Docs</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/">Otomi Console</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/">FAQ</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/">Community</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/">Blog</a></div><div class="navbar__items navbar__items--right"><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2aTZ"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_BsTx">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_BsTx">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" target="_self" href="/"><img src="/img/otomi-logo.svg" alt="Site Logo" class="themedImage_2E_h themedImage--light_AouX navbar__logo"><img src="/img/otomi-logo.svg" alt="Site Logo" class="themedImage_2E_h themedImage--dark_1YPN navbar__logo"></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/">About</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/">Docs</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/">Otomi Console</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/">FAQ</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/">Community</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/">Blog</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_2gpo"><main class="docMainContainer_3EyW"><div class="container padding-vert--lg docItemWrapper_39qw"><div class="row"><div class="col docItemCol_2ASc"><div class="docItemContainer_3QWW"><article><header><h1 class="docTitle_1Lrw">Setup</h1></header><div class="markdown"><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="1-initialize-a-values-repo"></a>1. Initialize a values repo<a class="hash-link" href="#1-initialize-a-values-repo" title="Direct link to heading">#</a></h2><p>Otomi needs a git repo to store its configuration. We call it a <strong><em>values</em></strong> repo. You can create one like this:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-bash codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># initialize git repo</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">mkdir</span><span class="token plain"> otomi-values </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token builtin class-name">cd</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$_</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> init </span><span class="token builtin class-name">.</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># and get all the files</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">docker run --rm -e </span><span class="token assign-left variable" style="color:#36acaa">ENV_DIR</span><span class="token operator" style="color:#393A34">=</span><span class="token environment constant" style="color:#36acaa">$PWD</span><span class="token plain"> -v </span><span class="token environment constant" style="color:#36acaa">$PWD</span><span class="token builtin class-name">:</span><span class="token environment constant" style="color:#36acaa">$PWD</span><span class="token plain"> otomi/core:latest bin/bootstrap.sh</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># and source the aliases including the otomi cli</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">.</span><span class="token plain"> bin/aliases</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><p>This will install the demo value files, but also the needed artifacts, such as the Otomi CLI. Lastly, it sources aliases you can use, such as the <code>otomi</code> cli (which is an alias to the imported <code>bin/otomi</code>). We recommend to prepend <code>./bin</code> to your \$PATH to always have access to <code>otomi</code> from within an otomi repo without needing to source the aliases. NOTE: the aliases still contain useful shortcuts, so you might want to inspect and/or use them. We do:)</p><p>After this initialization of the repo, we recommend you commit and push it to your final remote destination. It is a prerequisite for step 3 below, <a href="#3-start-otomi-console-on-your-local-machine-optional">using the console locally</a>.</p><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>otomi cli is bound to the values repo</h5></div><div class="admonition-content"><p>This is to make sure that the version of the bootstrapped otomi image is configured from within this repo. So in case you get the &quot;command not found: otomi&quot; error, you have to source the aliases again from within the repo&#x27;s root folder.</p></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="2-configure-credentials-from-a-kms-optional"></a>2. Configure credentials from a KMS (optional)<a class="hash-link" href="#2-configure-credentials-from-a-kms-optional" title="Direct link to heading">#</a></h2><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>No encryption needed?</h5></div><div class="admonition-content"><p>If you don&#x27;t need encryption straight away please continue to the <a href="#3-start-otomi-console-on-your-local-machine-optional">next step</a></p></div></div><p>Otomi will encrypt any <code>secrets.*.yaml</code> files with <a href="https://github.com/mozilla/sops" target="_blank" rel="noopener noreferrer">sops</a>, but only if it finds a <code>.sops.yaml</code> configuration file. (How to work with sops is not in scope of this documentation.)</p><p>In order to en-/decrypt the secrets in the values repo, the KMS configuration needs to be provided in <code>.sops.yaml</code>. Examples are provided in <code>.sops.yaml.sample</code> for the big 3 cloud KMS providers. Copy it, and then edit it:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-bash codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">cp</span><span class="token plain"> .sops.yaml.sample .sops.yaml</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><p>Now, these KMS endpoints also need credentials to access them. Your AWS profile is always pointed and loaded (make sure you have loaded the correct one that has access), but in case of Google KMS add the following to the <code>.secrets</code> file:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-bash codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">GCLOUD_SERVICE_KEY</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;YOUR_KEY_JSON_DATA_WITHOUT_NEWLINES&quot;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><p>Then you can run <code>otomi bootstrap</code> again, which will result in the creation of <code>gcp-key.json</code>, which is needed for sops to work locally, like when doing a <code>git diff</code>.</p><p>To allow <code>git diff</code> to show unencrypted values, you must register the sops diffing routine once with git. To register it:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-bash codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">git</span><span class="token plain"> config diff.sopsdiffer.textconv </span><span class="token string" style="color:#e3116c">&quot;sops -d&quot;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><p>This only registers the sops differ, which is responsible for invoking sops. But sops still needs the credentials to the KMS service. Again, your AWS profile is always pointed and loaded, but in case of Google KMS you will need to point GOOGLE_APPLICATION_CREDENTIALS to the <code>gcp-key.json</code> file holding your account information:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-bash codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">GOOGLE_APPLICATION_CREDENTIALS</span><span class="token operator" style="color:#393A34">=</span><span class="token environment constant" style="color:#36acaa">$PWD</span><span class="token plain">/gcp-key.json</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><p>Now try a diff:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-bash codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">git</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">diff</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="3-start-otomi-console-on-your-local-machine-optional"></a>3 Start Otomi Console on your local machine (optional)<a class="hash-link" href="#3-start-otomi-console-on-your-local-machine-optional" title="Direct link to heading">#</a></h2><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>Otomi Enterprise Edition license needed</h5></div><div class="admonition-content"><p>If you have a license for Otomi EE you can run the console locally for initial configuration.</p></div></div><p>If you have not done so already, put the pullsecret you have been given in <code>secrets.settings.yaml</code> under <code>otomi.pullSecret</code>. Also make sure the git details are correctly added to <code>charts/*otomi-api.yaml</code>. Remember that some providers like GitHub need an access token when MFA/2FA is turned on, so create one (see <a href="https://github.com/settings/tokens" target="_blank" rel="noopener noreferrer">https://github.com/settings/tokens</a>) and provide that for <code>password</code>. At least the following values are expected:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-yaml codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">repoUrl</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> github.com/redkubes/otomi</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">values</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">demo.git</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">email</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> some@secret.value</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">user</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> somesecretvalue</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">password</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> somesecretvalue</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><p>Make sure these are correct and allowing access to the above initialized and pushed repository.</p><p>Then bootstrap again and start the console:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-bash codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">otomi bootstrap</span></div><div class="token-line" style="color:#393A34"><span class="token plain">otomi console</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><p>The console allows for easy configuration of many settings but not all. Please continue to the <a href="/docs/installation/configuration">Configuration</a> section to read more about this.</p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/redkubes/redkubes/tree/master/docs/inst-setup.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 40 40" style="margin-right:0.3em;vertical-align:sub"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_3SO_ thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#1-initialize-a-values-repo" class="table-of-contents__link">1. Initialize a values repo</a></li><li><a href="#2-configure-credentials-from-a-kms-optional" class="table-of-contents__link">2. Configure credentials from a KMS (optional)</a></li><li><a href="#3-start-otomi-console-on-your-local-machine-optional" class="table-of-contents__link">3 Start Otomi Console on your local machine (optional)</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Otomi</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/">Introduction</a></li><li class="footer__item"><a class="footer__link-item" href="/">Community Edition</a></li><li class="footer__item"><a href="https://redkubes.com/otomi-container-platform-product-sheet/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Product sheet</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://github.com/redkubes/redkubes/issues" target="_blank" rel="noopener noreferrer" class="footer__link-item">Feedback</a></li><li class="footer__item"><a href="https://gitter.im/redkubes/community" target="_blank" rel="noopener noreferrer" class="footer__link-item">Gitter</a></li><li class="footer__item"><a class="footer__link-item" href="/">Help</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Red Kubes</h4><ul class="footer__items"><li class="footer__item"><a href="https://redkubes.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">Website</a></li><li class="footer__item"><a href="https://github.com/redkubes/" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li><li class="footer__item"><a href="https://www.linkedin.com/company/red-kubes/" target="_blank" rel="noopener noreferrer" class="footer__link-item">LinkedIN</a></li></ul></div></div><div class="text--center"><div class="margin-bottom--sm"><img class="footer__logo" alt="Otomi Open Source Logo" src="/img/otomi-logo-small.svg"></div><div>Copyright Â© 2020 Red Kubes. Built with <a href="https://v2.docusaurus.io/">Docusaurus</a></div></div></div></footer></div>
<script src="/styles.ef061321.js"></script>
<script src="/runtime~main.6e03e7c6.js"></script>
<script src="/main.752e440e.js"></script>
<script src="/1.5b2c8a6e.js"></script>
<script src="/42.df5c080a.js"></script>
<script src="/43.2c8a4dfd.js"></script>
<script src="/935f2afb.98710004.js"></script>
<script src="/41.8e2bd9a7.js"></script>
<script src="/c99baebb.173279e3.js"></script>
</body>
</html>