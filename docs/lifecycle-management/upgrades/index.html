<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.70">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Otomi Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Otomi Blog Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-KKV4ZVDEKQ"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-KKV4ZVDEKQ",{})</script>
<link rel="search" type="application/opensearchdescription+xml" title="Otomi" href="/opensearch.xml"><title data-react-helmet="true">Upgrades | Otomi</title><meta data-react-helmet="true" property="og:image" content="https://otomi.io/img/otomi-logo.svg"><meta data-react-helmet="true" name="twitter:image" content="https://otomi.io/img/otomi-logo.svg"><meta data-react-helmet="true" name="twitter:image:alt" content="Image for Otomi"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Upgrades | Otomi"><meta data-react-helmet="true" name="description" content="Introduction"><meta data-react-helmet="true" property="og:description" content="Introduction"><meta data-react-helmet="true" property="og:url" content="https://otomi.io/docs/lifecycle-management/upgrades"><link data-react-helmet="true" rel="shortcut icon" href="/img/otomi.ico"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link data-react-helmet="true" rel="canonical" href="https://otomi.io/docs/lifecycle-management/upgrades"><link rel="stylesheet" href="/styles.91a2fb7d.css">
<link rel="preload" href="/styles.3afc5b14.js" as="script">
<link rel="preload" href="/runtime~main.cad11b2e.js" as="script">
<link rel="preload" href="/main.ab7bfbb9.js" as="script">
<link rel="preload" href="/1.d34b5c9c.js" as="script">
<link rel="preload" href="/2.d6929fd0.js" as="script">
<link rel="preload" href="/54.88da777f.js" as="script">
<link rel="preload" href="/57.3030cd8d.js" as="script">
<link rel="preload" href="/935f2afb.35fe72cd.js" as="script">
<link rel="preload" href="/17896441.fe331e03.js" as="script">
<link rel="preload" href="/ee02c409.4ee1d04c.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_11B0">Skip to main content</button></nav><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" target="_self" href="/"><img src="/img/otomi-logo.svg" alt="Site Logo" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/img/otomi-logo.svg" alt="Site Logo" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"></a><a class="navbar__item navbar__link" href="/about/">About</a><a class="navbar__item navbar__link" href="/docs/installation/">Docs</a><a class="navbar__item navbar__link" href="/docs/console/">Otomi Console</a><a class="navbar__item navbar__link" href="/docs/faq">FAQ</a><a class="navbar__item navbar__link" href="/community/support">Community</a><a class="navbar__item navbar__link" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/redkubes/otomi-core" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2N3Q"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_3NWk">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_3NWk">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><div class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></div></button></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" target="_self" href="/"><img src="/img/otomi-logo.svg" alt="Site Logo" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/img/otomi-logo.svg" alt="Site Logo" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/about/">About</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/installation/">Docs</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/console/">Otomi Console</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/faq">FAQ</a></li><li class="menu__list-item"><a class="menu__link" href="/community/support">Community</a></li><li class="menu__list-item"><a class="menu__link" href="/blog">Blog</a></li><li class="menu__list-item"><a href="https://github.com/redkubes/otomi-core" target="_blank" rel="noopener noreferrer" class="menu__link header-github-link" aria-label="GitHub repository"></a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_vMrn"><div class="docSidebarContainer_3Ak5" role="complementary"><div class="sidebar_3gvy"><div class="menu menu--responsive thin-scrollbar menu_1yIk"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_1CUI" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Installation</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/installation/">Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/installation/prerequisites">Prerequisites</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/installation/setup">Setup</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/installation/configuration">Configuration</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/installation/deployment">Deployment</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Otomi Console</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/console/">Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/console/configuring-apps">Configuring apps</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/console/configuring-clusters">Configuring clusters</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/console/configuring-teams">Configuring teams</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/console/configuring-services">Configuring services</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/console/configuring-secrets">Configuring secrets</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/console/settings">Settings</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/console/deploy-changes">Deploy changes</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Known Issues</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/known-issues/">Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/known-issues/cli">Otomi CLI</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Apps</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/known-issues/harbor">Harbor</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/known-issues/loki">Loki</a></li></ul></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Lifecycle Management</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/lifecycle-management/">Overview</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/lifecycle-management/upgrades">Upgrades</a></li></ul></li></ul></div></div></div><main class="docMainContainer_2iGs"><div class="container padding-vert--lg docItemWrapper_1bxp"><div class="row"><div class="col docItemCol_U38p"><div class="docItemContainer_a7m4"><article><header><h1 class="docTitle_Oumm">Upgrades</h1></header><div class="markdown"><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="introduction"></a>Introduction<a class="hash-link" href="#introduction" title="Direct link to heading">#</a></h2><p>Since otomi-core is a mono repo with many open source charts that are working together, it is very hard to coordinate updates to its parts. Luckily we can rely on a lot of smart operators to take care of upgrades (we strive to only adopt operators with capability level &quot;Seamless Upgrades&quot;), but some scripting is always needed in this case. We strive to make upgrades as painless as possible by creating upgrade scripts for the release versions. You can find these in <a href="https://github.com/redkubes/otomi-core/tree/master/bin/upgrades" target="_blank" rel="noopener noreferrer">otomi-core/bin/upgrades</a>.</p><p>Example: in order to migrate from <code>v0.10.*</code> to <code>v0.11.*</code> you would run <code>bin/upgrades/v0.11.sh</code>. Soon the upgrade scripts can also be used to migrate from an older version, as it will apply any in between upgrade scripts successively.</p><p>In some situations however, the automatic upgrades will throw an error, and might require removing/patching existing resources before helm can adopt or manipulate them. Notable issues:</p><ul><li>Resources not under helm chart control: since helm 3.2 these can be adopted. When trying to deploy helm resources over existing resources helm will give detailed instructions on how to adopt these.</li><li>Some resources have labels and do not allow changing them. This usually points to bad chart practices, but mandates removal before recreating these resources. This can&#x27;t always be done and is a big drawback. Remedies usually exist but might have to be investigated on the fly.</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="steps-to-upgrade-otomi-core"></a>Steps to upgrade otomi-core<a class="hash-link" href="#steps-to-upgrade-otomi-core" title="Direct link to heading">#</a></h2><p>So every time an upgrade of the stack is released it is important to follow these steps:</p><ol><li>Read the release notes on <a href="https://github.com/redkubes/otomi-core" target="_blank" rel="noopener noreferrer">otomi-core</a> for impact and special cases.</li><li>Check the corresponding upgrade script(s) and read the comments. It might involve manual steps.</li><li>Set the new version tag in <code>clusters.yaml</code> and run <code>otomi bootstrap</code> to pull in latest artifacts</li><li>Do a diff first: <code>otomi diff</code></li><li>Run the upgrade script</li><li>Check the output and fix anything that needs fixing and repeat steps 4-6</li><li>Commit the values when all is well and Drone syncing will take it from there</li></ol></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/redkubes/redkubes/tree/master/docs/lm-upgrades.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2LL7"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/lifecycle-management/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« LM Overview</div></a></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_2xL- thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#introduction" class="table-of-contents__link">Introduction</a></li><li><a href="#steps-to-upgrade-otomi-core" class="table-of-contents__link">Steps to upgrade otomi-core</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Otomi</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/about/">Introduction</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/console/">Community Edition</a></li><li class="footer__item"><a href="https://redkubes.com/otomi-container-platform-product-sheet/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Product sheet</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://github.com/redkubes/redkubes/issues" target="_blank" rel="noopener noreferrer" class="footer__link-item">Feedback</a></li><li class="footer__item"><a href="https://gitter.im/redkubes/community" target="_blank" rel="noopener noreferrer" class="footer__link-item">Gitter</a></li><li class="footer__item"><a class="footer__link-item" href="/community/support">Help</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Red Kubes</h4><ul class="footer__items"><li class="footer__item"><a href="https://redkubes.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">Website</a></li><li class="footer__item"><a href="https://github.com/redkubes/" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li><li class="footer__item"><a href="https://www.linkedin.com/company/red-kubes/" target="_blank" rel="noopener noreferrer" class="footer__link-item">LinkedIN</a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><img class="footer__logo" alt="Otomi Open Source Logo" src="/img/otomi-logo-small.svg"></div><div class="footer__copyright">Copyright Â© 2021 Red Kubes. Built with <a href="https://v2.docusaurus.io/">Docusaurus</a></div></div></div></footer></div>
<script src="/styles.3afc5b14.js"></script>
<script src="/runtime~main.cad11b2e.js"></script>
<script src="/main.ab7bfbb9.js"></script>
<script src="/1.d34b5c9c.js"></script>
<script src="/2.d6929fd0.js"></script>
<script src="/54.88da777f.js"></script>
<script src="/57.3030cd8d.js"></script>
<script src="/935f2afb.35fe72cd.js"></script>
<script src="/17896441.fe331e03.js"></script>
<script src="/ee02c409.4ee1d04c.js"></script>
</body>
</html>