<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.70">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Otomi Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Otomi Blog Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-KKV4ZVDEKQ"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-KKV4ZVDEKQ",{})</script>
<link rel="search" type="application/opensearchdescription+xml" title="Otomi" href="/opensearch.xml"><title data-react-helmet="true">Known Issues: Current Otomi CLI | Otomi</title><meta data-react-helmet="true" property="og:image" content="https://otomi.io/img/otomi-logo.svg"><meta data-react-helmet="true" name="twitter:image" content="https://otomi.io/img/otomi-logo.svg"><meta data-react-helmet="true" name="twitter:image:alt" content="Image for Otomi"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Known Issues: Current Otomi CLI | Otomi"><meta data-react-helmet="true" name="description" content="The otomi (diff|apply|sync|template) commands are delegated to helmfile, which in turn delegates the deployment work to helm. Sometimes it is not clear wether the issue is from Helm or Helmfile, so we will address them together in this section."><meta data-react-helmet="true" property="og:description" content="The otomi (diff|apply|sync|template) commands are delegated to helmfile, which in turn delegates the deployment work to helm. Sometimes it is not clear wether the issue is from Helm or Helmfile, so we will address them together in this section."><meta data-react-helmet="true" property="og:url" content="https://otomi.io/docs/sre/known-issues/cli"><link data-react-helmet="true" rel="shortcut icon" href="/img/otomi.ico"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link data-react-helmet="true" rel="canonical" href="https://otomi.io/docs/sre/known-issues/cli"><link rel="stylesheet" href="/styles.6db9d217.css">
<link rel="preload" href="/styles.8c0b1d12.js" as="script">
<link rel="preload" href="/runtime~main.4b7a8a5c.js" as="script">
<link rel="preload" href="/main.66637293.js" as="script">
<link rel="preload" href="/1.8250adb6.js" as="script">
<link rel="preload" href="/2.aab0a93e.js" as="script">
<link rel="preload" href="/101.2b167383.js" as="script">
<link rel="preload" href="/104.2507c7b1.js" as="script">
<link rel="preload" href="/935f2afb.086438c4.js" as="script">
<link rel="preload" href="/17896441.cab4857e.js" as="script">
<link rel="preload" href="/71457c7e.f329cf55.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_11B0">Skip to main content</button></nav><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" target="_self" href="/"><img src="/img/otomi-logo.svg" alt="Site Logo" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/img/otomi-logo.svg" alt="Site Logo" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"></a><a class="navbar__item navbar__link" href="/about/">About</a><a class="navbar__item navbar__link" href="/docs/installation/">Docs</a><a class="navbar__item navbar__link" href="/docs/faq">FAQ</a><a class="navbar__item navbar__link" href="/community/get-involved">Community</a><a class="navbar__item navbar__link" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/redkubes/otomi-core" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2N3Q"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_3NWk">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_3NWk">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><div class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></div></button></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" target="_self" href="/"><img src="/img/otomi-logo.svg" alt="Site Logo" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/img/otomi-logo.svg" alt="Site Logo" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/about/">About</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/installation/">Docs</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/faq">FAQ</a></li><li class="menu__list-item"><a class="menu__link" href="/community/get-involved">Community</a></li><li class="menu__list-item"><a class="menu__link" href="/blog">Blog</a></li><li class="menu__list-item"><a href="https://github.com/redkubes/otomi-core" target="_blank" rel="noopener noreferrer" class="menu__link header-github-link" aria-label="GitHub repository"></a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_vMrn"><div class="docSidebarContainer_3Ak5" role="complementary"><div class="sidebar_3gvy"><div class="menu menu--responsive thin-scrollbar menu_1yIk"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_1CUI" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Installing Otomi</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/installation/">Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/installation/prerequisites">Prerequisites</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/installation/chart">Install from chart</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/installation/cli/">Install with CLI</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/installation/post-install-actions/">Post install actions</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Otomi Console</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/console/">Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/console/teams">Teams</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/console/services">Services</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/console/jobs">Jobs</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/console/secrets">Secrets</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/console/platform-apps">Platform Apps</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Settings</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/console/settings/alerts">Alerts</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/console/settings/azure">Azure</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/console/settings/dns">DNS</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/console/settings/home">Home</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/console/settings/kms">KMS</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/console/settings/oidc">OIDC</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/console/settings/otomi">Otomi</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/console/settings/policies">Policies</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/console/settings/smtp">SMTP</a></li></ul></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/console/clusters">Clusters</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/console/team-apps">Team Apps</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/console/deploy-changes">Deploy changes</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Applications</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/apps/drone">Drone</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/apps/harbor">Harbor</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/apps/keycloak">Keycloak</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/apps/kubeapps">Kubeapps</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/apps/vault">Hashicorp Vault</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/apps/gatekeeper">Gatekeeper</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Otomi CLI</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/cli/">Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/cli/working-with">Working with Otomi CLI</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">CLI Commands</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/cli/apply">otomi apply</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/cli/bash">otomi bash</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/cli/bootstrap">otomi bootstrap</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/cli/check-policies">otomi check-policies</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/cli/commit">otomi commit</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/cli/decrypt">otomi decrypt</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/cli/destroy">otomi destroy</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/cli/diff">otomi diff</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/cli/encrypt">otomi encrypt</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/cli/lint">otomi lint</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/cli/pull">otomi pull</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/cli/rotate-keys">otomi rotate-keys</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/cli/status">otomi status</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/cli/sync">otomi sync</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/cli/template">otomi template</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/cli/test">otomi test</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/cli/validate-templates">otomi validate-templates</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/cli/validate-values">otomi validate-values</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/cli/values">otomi values</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/cli/x">otomi x</a></li></ul></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">SRE</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/sre/">Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/sre/daily">Daily Routine</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/sre/troubleshooting">Troubleshooting</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!" tabindex="0">Known Issues</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/sre/known-issues/">Overview</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/sre/known-issues/cli">Otomi CLI</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/sre/known-issues/harbor">Harbor</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/sre/known-issues/istio">Istio</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/sre/known-issues/loki">Loki</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/sre/known-issues/staging-certs">Staging Certs</a></li></ul></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/sre/upgrades">Upgrades</a></li></ul></li></ul></div></div></div><main class="docMainContainer_2iGs"><div class="container padding-vert--lg docItemWrapper_1bxp"><div class="row"><div class="col docItemCol_U38p"><div class="docItemContainer_a7m4"><article><header><h1 class="docTitle_Oumm">Known Issues: Current Otomi CLI</h1></header><div class="markdown"><p>The <code>otomi (diff|apply|sync|template)</code> commands are delegated to <code>helmfile</code>, which in turn delegates the deployment work to <code>helm</code>. Sometimes it is not clear wether the issue is from Helm or Helmfile, so we will address them together in this section.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="state-drift"></a>State drift<a class="hash-link" href="#state-drift" title="Direct link to heading">#</a></h2><p><strong>Problem</strong>: <code>otomi apply</code> does not seem to change resources.</p><p><strong>Solution</strong>: try <code>otomi sync</code></p><p><strong>Background info</strong>:</p><p>The <code>otomi apply</code> command uses helmfile&#x27;s <code>apply</code> command, which combines its <code>diff</code> and <code>sync</code> commandds. So it first does a <code>helmfile diff</code> against helm&#x27;s bookeeping (which resides in versioned secrets, e.g. <code>sh.helm.release.v1.loki.v1</code>). This is the most cost effective way and does not lead to a new release version being deployed when there are no changes. However, when you changed cluster resources without the otomi cli (so without using helm) this is not reflected in the secrets. <code>helmfile diff</code> will not see any changes in the secret, so it won&#x27;t execute the subsequent <code>helmfile sync</code>. If you wish to overwrite the desired state on the cluster, use the <code>otomi sync -l name=$releaseName</code> command directly. Usually only for a certain release, so you don&#x27;t force change all the releases, which costs a lot of time.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="deployment-errorsproblems"></a>Deployment errors/problems<a class="hash-link" href="#deployment-errorsproblems" title="Direct link to heading">#</a></h2><p>Helmfile uses Helm 3 under the hood, and it will throw errors in certain situations:</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="1-it-cant-deploy-a-resource-when-it-already-exists"></a>1. It can&#x27;t deploy a resource when it already exists<a class="hash-link" href="#1-it-cant-deploy-a-resource-when-it-already-exists" title="Direct link to heading">#</a></h3><p>When a resource already exists and was not deployed with the chart before (alien to Helm), it is possible to &#x27;adopt&#x27; the resource beforehand by labeling and annotating them correctly:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-bash codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">k -n </span><span class="token variable" style="color:#36acaa">$NS</span><span class="token plain"> annotate --overwrite </span><span class="token variable" style="color:#36acaa">$KIND</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$NAME</span><span class="token plain"> meta.helm.sh/release-name</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">$RELEASE</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">k -n </span><span class="token variable" style="color:#36acaa">$NS</span><span class="token plain"> annotate --overwrite </span><span class="token variable" style="color:#36acaa">$KIND</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$NAME</span><span class="token plain"> meta.helm.sh/release-namespace</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">$NAMESPACE</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">k -n </span><span class="token variable" style="color:#36acaa">$NS</span><span class="token plain"> label --overwrite </span><span class="token variable" style="color:#36acaa">$KIND</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$NAME</span><span class="token plain"> app.kubernetes.io/managed-by</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">Helm</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>This functionality exists in the stack in <code>bin/upgrades/adopt-by-helm.sh</code>, and is used in the upgrade scripts.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="2-releases-latest-state-is-failed"></a>2. Release&#x27;s latest state is failed<a class="hash-link" href="#2-releases-latest-state-is-failed" title="Direct link to heading">#</a></h3><p><code>Error: &quot;$releaseName&quot; has no deployed releases</code></p><p>This may happen when you try to install a chart (usually for the first time) and it fails. This results in the release&#x27;s deployment having state &#x27;failed&#x27;.</p><p><strong>Solution</strong>:</p><ul><li>When this was the first install: destroy with <code>otomi destroy -l name=$releaseName</code> and then apply with <code>otomi apply -l name=$releaseName</code> again.</li><li>When it was successfully deployed before: remove the last versioned helm secret that is causing the blockage (e.g. <code>sh.helm.release.v1.loki.v3</code>)</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="3-some-resources-couldnt-be-patched"></a>3. Some resources couldn&#x27;t be patched<a class="hash-link" href="#3-some-resources-couldnt-be-patched" title="Direct link to heading">#</a></h3><p><code>Error: UPGRADE FAILED: failed to replace object: ... field is immutable</code></p><p>This usually happens when a manifest is not allowed to be patched in place and needs to be replaced. Retry the borking release with <code>otomi apply -l name=$releaseName --extraArgs=&#x27;--force=true&#x27;</code> which does exactly that.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="4-timeout"></a>4. Timeout<a class="hash-link" href="#4-timeout" title="Direct link to heading">#</a></h3><p><strong>Problem</strong>: Sometimes the otomi cli will time out when operating on a Google cluster.</p><p><strong>Cause</strong>: This happens when the containerized kubectl binary wants to refresh an access token, but it can&#x27;t find the binary that was registered to do so in the otomi docker container.</p><p><strong>Workaround</strong>: Retry the command. Before every invocation with the containerized <code>kubectl</code> binary, otomi cli first runs <code>kubectl version</code> with the local binary to invoke a token refresh, resulting in an up-to-date config to mount.</p><p><strong>Background</strong>:</p><p>The otomi cli is a docker container with all the binaries it needs to deploy to these clusters. When running a command the local cloud configs are mounted. These configs may contain configuration for token refresh mechanisms, including the name of a binary to execute with certain parameters. This makes it possible to include the binaries in the image, and make them available via the known <code>$PATH</code>.</p><p>However, Google Cloud SDK breaks with that approach, by tightly coupling a hard path to the local gcloud binary. Sample user section from <code>$KUBECONFIG</code>:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-yaml codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> gke_otomi</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">cloud_europe</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">west4_otomi</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">gke</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">demo</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">user</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">auth-provider</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">config</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">access-token</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> xxxxxxxxx</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">cmd-args</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> config config</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">helper </span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">format=json</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">cmd-path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /usr/local/Caskroom/google</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">cloud</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">sdk/latest/google</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">cloud</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">sdk/bin/gcloud</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">expiry</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;2020-10-29T02:15:37Z&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">expiry-key</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;{.credential.token_expiry}&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">token-key</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;{.credential.access_token}&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> gcp</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>This will not work with containerization unfortunately. We also can&#x27;t predict the path on the users host computer to this binary, so we have to hope for Google to fix this some day. They are not inclined to do so it seems:</p><p><a href="https://issuetracker.google.com/issues/171493249" target="_blank" rel="noopener noreferrer">https://issuetracker.google.com/issues/171493249</a></p><p>Maybe they will start to see the importance of this after getting more feedback ;)</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="5-it-cant-deploy-when-another-operation-is-in-progress"></a>5. It can&#x27;t deploy when another operation is in progress<a class="hash-link" href="#5-it-cant-deploy-when-another-operation-is-in-progress" title="Direct link to heading">#</a></h3><p><strong>Problem</strong>: The <code>otomi apply</code> or <code>otomi sync</code> command fails with the following error:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">Error: UPGRADE FAILED: another operation (install/upgrade/rollback) is in progress</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p><strong>Cause</strong>: A given helm release is in <code>pending-upgrade</code> state, e.g.:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">NAME      NAMESPACE    REVISION    UPDATED                 STATUS     CHART      APP VERSION</span></div><div class="token-line" style="color:#393A34"><span class="token plain">keycloak    keycloak    3        2021-03-22 13:50:22.5069506 +0000 UTC  pending-upgrade keycloak-8.2.2 10.0.0</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p><strong>Solution</strong>: Find helm release that is in the <code>pending-upgrade</code> state:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">helm list -a -A | grep -i pending</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>If there is a helm release in the <code>pending</code> state AND it has more than one revision, then rollback to the previous revision:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">helm -n &lt;namespace&gt; rollback &lt;release-name&gt; &lt;previous revision number&gt;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Otherwise, if there is a helm release in the state <code>pending</code> AND it has only one revision, then remove that release:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">helm uninstall -n &lt;namespace&gt; rollback &lt;release-name&gt;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/redkubes/redkubes.github.io/tree/master/docs/ki-cli.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2LL7"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/sre/known-issues/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Known Issues</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/sre/known-issues/harbor"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Known Issues: Harbor Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_2xL- thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#state-drift" class="table-of-contents__link">State drift</a></li><li><a href="#deployment-errorsproblems" class="table-of-contents__link">Deployment errors/problems</a><ul><li><a href="#1-it-cant-deploy-a-resource-when-it-already-exists" class="table-of-contents__link">1. It can&#39;t deploy a resource when it already exists</a></li><li><a href="#2-releases-latest-state-is-failed" class="table-of-contents__link">2. Release&#39;s latest state is failed</a></li><li><a href="#3-some-resources-couldnt-be-patched" class="table-of-contents__link">3. Some resources couldn&#39;t be patched</a></li><li><a href="#4-timeout" class="table-of-contents__link">4. Timeout</a></li><li><a href="#5-it-cant-deploy-when-another-operation-is-in-progress" class="table-of-contents__link">5. It can&#39;t deploy when another operation is in progress</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Otomi</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/about/">Introduction</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/installation/">Installation</a></li><li class="footer__item"><a class="footer__link-item" target="_blank" rel="noopener noreferrer" href="/docs/console/">Using Otomi Console</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://join.slack.com/t/otomi/shared_invite/zt-vourf7og-de4CmvthgfJlsuDQHsK8yQ" target="_blank" rel="noopener noreferrer" class="footer__link-item">Slack</a></li><li class="footer__item"><a href="https://gitter.im/redkubes/community" target="_blank" rel="noopener noreferrer" class="footer__link-item">Gitter</a></li><li class="footer__item"><a href="https://redkubes.com/community/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Community page</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Red Kubes</h4><ul class="footer__items"><li class="footer__item"><a href="https://redkubes.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">Website</a></li><li class="footer__item"><a href="https://github.com/redkubes/" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li><li class="footer__item"><a href="https://www.linkedin.com/company/red-kubes/" target="_blank" rel="noopener noreferrer" class="footer__link-item">LinkedIn</a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><img class="footer__logo" alt="Otomi Open Source Logo" src="/img/otomi-logo.svg"></div><div class="footer__copyright">Copyright Â© 2021 Red Kubes. Built with <a href="https://v2.docusaurus.io/">Docusaurus</a></div></div></div></footer></div>
<script src="/styles.8c0b1d12.js"></script>
<script src="/runtime~main.4b7a8a5c.js"></script>
<script src="/main.66637293.js"></script>
<script src="/1.8250adb6.js"></script>
<script src="/2.aab0a93e.js"></script>
<script src="/101.2b167383.js"></script>
<script src="/104.2507c7b1.js"></script>
<script src="/935f2afb.086438c4.js"></script>
<script src="/17896441.cab4857e.js"></script>
<script src="/71457c7e.f329cf55.js"></script>
</body>
</html>