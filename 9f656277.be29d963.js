(window.webpackJsonp=window.webpackJsonp||[]).push([[62],{133:function(e,t,a){"use strict";a.r(t),a.d(t,"frontMatter",(function(){return c})),a.d(t,"metadata",(function(){return i})),a.d(t,"toc",(function(){return o})),a.d(t,"default",(function(){return s}));var n=a(3),r=a(7),l=(a(0),a(175)),c={slug:"installation/prerequisites",title:"Prerequisites"},i={unversionedId:"inst-prerequisites",id:"inst-prerequisites",isDocsHomePage:!1,title:"Prerequisites",description:"Client binaries",source:"@site/docs/inst-prerequisites.md",slug:"/installation/prerequisites",permalink:"/docs/installation/prerequisites",editUrl:"https://github.com/redkubes/redkubes.github.io/tree/master/docs/inst-prerequisites.md",version:"current",sidebar:"mainSidebar",previous:{title:"Installation Overview",permalink:"/docs/installation/"},next:{title:"Install from chart",permalink:"/docs/installation/chart"}},o=[{value:"Client binaries",id:"client-binaries",children:[]},{value:"Cloud services",id:"cloud-services",children:[{value:"Kubernetes cluster with a DNS zone",id:"kubernetes-cluster-with-a-dns-zone",children:[]},{value:"Identity Provider (IDP)",id:"identity-provider-idp",children:[]},{value:"KMS credentials to manage keys for encryption (optional)",id:"kms-credentials-to-manage-keys-for-encryption-optional",children:[]}]}],b={toc:o};function s(e){var t=e.components,a=Object(r.a)(e,["components"]);return Object(l.b)("wrapper",Object(n.a)({},b,a,{components:t,mdxType:"MDXLayout"}),Object(l.b)("h2",{id:"client-binaries"},"Client binaries"),Object(l.b)("p",null,"Please make sure the following client binaries exist:"),Object(l.b)("ul",null,Object(l.b)("li",{parentName:"ul"},Object(l.b)("a",Object(n.a)({parentName:"li"},{href:"https://kubernetes.io/docs/tasks/tools/#kubectl"}),"kubectl")," to access the cluster."),Object(l.b)("li",{parentName:"ul"},Object(l.b)("a",Object(n.a)({parentName:"li"},{href:"https://www.docker.com/"}),"docker")," must be installed and running, as Otomi runs in a container."),Object(l.b)("li",{parentName:"ul"},Object(l.b)("a",Object(n.a)({parentName:"li"},{href:"https://helm.sh/docs/intro/install/"}),"helm")," (optional) for helm chart installation of Otomi."),Object(l.b)("li",{parentName:"ul"},Object(l.b)("a",Object(n.a)({parentName:"li"},{href:"/docs/cli/"}),"otomi")," (optional) for helm chart installation of Otomi.")),Object(l.b)("h2",{id:"cloud-services"},"Cloud services"),Object(l.b)("p",null,"Finally make sure to have configured the following cloud services:"),Object(l.b)("h3",{id:"kubernetes-cluster-with-a-dns-zone"},"Kubernetes cluster with a DNS zone"),Object(l.b)("p",null,"Kubernetes versions ",Object(l.b)("inlineCode",{parentName:"p"},"1.18")," up to ",Object(l.b)("inlineCode",{parentName:"p"},"1.20")," are supported."),Object(l.b)("p",null,"Find below the specific configurations for most common cloud-providers: Aws, Azure, Google."),Object(l.b)("h4",{id:"aws"},"AWS"),Object(l.b)("p",null,"Setting up a cluster on AWS' EKS is documented here: ",Object(l.b)("a",Object(n.a)({parentName:"p"},{href:"https://docs.aws.amazon.com/eks/latest/userguide/create-cluster.html"}),"https://docs.aws.amazon.com/eks/latest/userguide/create-cluster.html")),Object(l.b)("p",null,"Get access to the cluster with kubectl:"),Object(l.b)("pre",null,Object(l.b)("code",Object(n.a)({parentName:"pre"},{className:"language-bash"}),"aws eks update-kubeconfig --name $CLUSTER_NAME\n")),Object(l.b)("p",null,"Setting up external DNS: ",Object(l.b)("a",Object(n.a)({parentName:"p"},{href:"https://github.com/kubernetes-sigs/external-dns/blob/master/docs/tutorials/aws.md"}),"https://github.com/kubernetes-sigs/external-dns/blob/master/docs/tutorials/aws.md")),Object(l.b)("h4",{id:"azure-aks"},"Azure (AKS)"),Object(l.b)("p",null,"Setting up an azure cluster through the portal is documented here: ",Object(l.b)("a",Object(n.a)({parentName:"p"},{href:"https://docs.microsoft.com/en-us/azure/aks/kubernetes-walkthrough-portal"}),"https://docs.microsoft.com/en-us/azure/aks/kubernetes-walkthrough-portal")),Object(l.b)("p",null,"Get access to the cluster with kubectl:"),Object(l.b)("pre",null,Object(l.b)("code",Object(n.a)({parentName:"pre"},{className:"language-bash"}),"az aks get-credentials --resource-group <resource-group> --name <cluster-name> --admin\n")),Object(l.b)("p",null,"Setting up external DNS: ",Object(l.b)("a",Object(n.a)({parentName:"p"},{href:"https://github.com/kubernetes-sigs/external-dns/blob/master/docs/tutorials/azure.md"}),"https://github.com/kubernetes-sigs/external-dns/blob/master/docs/tutorials/azure.md")),Object(l.b)("h4",{id:"google-gke"},"Google (GKE)"),Object(l.b)("p",null,"Setting up an azure cluster through the portal is documented here: ",Object(l.b)("a",Object(n.a)({parentName:"p"},{href:"https://cloud.google.com/kubernetes-engine/docs/how-to"}),"https://cloud.google.com/kubernetes-engine/docs/how-to")),Object(l.b)("p",null,"Get access to the cluster with kubectl:"),Object(l.b)("pre",null,Object(l.b)("code",Object(n.a)({parentName:"pre"},{className:"language-bash"}),"gcloud container clusters get-credentials <cluster-name> --region <region> --project <project>\n")),Object(l.b)("p",null,"Setting up external DNS: ",Object(l.b)("a",Object(n.a)({parentName:"p"},{href:"https://github.com/kubernetes-sigs/external-dns/blob/master/docs/tutorials/gke.md"}),"https://github.com/kubernetes-sigs/external-dns/blob/master/docs/tutorials/gke.md")),Object(l.b)("h3",{id:"identity-provider-idp"},"Identity Provider (IDP)"),Object(l.b)("div",{className:"admonition admonition-note alert alert--secondary"},Object(l.b)("div",Object(n.a)({parentName:"div"},{className:"admonition-heading"}),Object(l.b)("h5",{parentName:"div"},Object(l.b)("span",Object(n.a)({parentName:"h5"},{className:"admonition-icon"}),Object(l.b)("svg",Object(n.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(l.b)("path",Object(n.a)({parentName:"svg"},{fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"})))),"ATTENTION: The new Otomi Chart install now only supports an external IDP!")),Object(l.b)("div",Object(n.a)({parentName:"div"},{className:"admonition-content"}),Object(l.b)("p",{parentName:"div"},"We will soon come with an update to also support the provided KeyCloak as IDP."))),Object(l.b)("p",null,"Below you can find detailed instructions on how to set up Azure AD as an external IDP. We will soon add more instructions for other IDPs, such as Amazon Incognito, Google Identity, and Okta."),Object(l.b)("h4",{id:"azure-ad"},"Azure AD"),Object(l.b)("p",null,"The authentication of brokered identities through Azure AD requires a service principal with certain Azure AD API permissions. An app registration needs to be created with the following API permissions:"),Object(l.b)("table",null,Object(l.b)("thead",{parentName:"table"},Object(l.b)("tr",{parentName:"thead"},Object(l.b)("th",Object(n.a)({parentName:"tr"},{align:null}),"API / Permission name"),Object(l.b)("th",Object(n.a)({parentName:"tr"},{align:null}),"Type"),Object(l.b)("th",Object(n.a)({parentName:"tr"},{align:null}),"Description"))),Object(l.b)("tbody",{parentName:"table"},Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"Microsoft Graph / email"),Object(l.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"Delegated"),Object(l.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"View users' email address")),Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"Microsoft Graph / openid"),Object(l.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"Delegated"),Object(l.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"Sign users in")),Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"Microsoft Graph / profile"),Object(l.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"Delegated"),Object(l.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"View users' basic profile")),Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"Microsoft Graph / User.Read"),Object(l.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"Delegated"),Object(l.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"Sign in and read user profile")))),Object(l.b)("p",null,"And the following token configurations:"),Object(l.b)("table",null,Object(l.b)("thead",{parentName:"table"},Object(l.b)("tr",{parentName:"thead"},Object(l.b)("th",Object(n.a)({parentName:"tr"},{align:null}),"Claim"),Object(l.b)("th",Object(n.a)({parentName:"tr"},{align:null}),"Description"),Object(l.b)("th",Object(n.a)({parentName:"tr"},{align:null}),"Token type"),Object(l.b)("th",Object(n.a)({parentName:"tr"},{align:null}),"Optional settings"))),Object(l.b)("tbody",{parentName:"table"},Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"family_name"),Object(l.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"Provides the last name, surename, or family name"),Object(l.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"ID"),Object(l.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"-")),Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"given_name"),Object(l.b)("td",Object(n.a)({parentName:"tr"},{align:null}),'Provides the first or "give" name of the user'),Object(l.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"ID"),Object(l.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"-")),Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"groups"),Object(l.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"Optional formatting for group claims"),Object(l.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"ID, Access, SAML"),Object(l.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"Default")),Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"upn"),Object(l.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"An identifier for the user that can be used ..."),Object(l.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"ID"),Object(l.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"Default")))),Object(l.b)("p",null,"Note that the group type should be set to 'security groups'."),Object(l.b)("p",null,'At the \'Authentication\' tab you should be able to set the following callback URL\xa7s and enable that both "Access tokens" and "ID tokens" are issued and public client flows are allowed:'),Object(l.b)("ul",null,Object(l.b)("li",{parentName:"ul"},Object(l.b)("inlineCode",{parentName:"li"},"https://keycloak.<dns-zone-name>/realms/master/broker/otomi-idp/endpoint")),Object(l.b)("li",{parentName:"ul"},Object(l.b)("inlineCode",{parentName:"li"},"https://keycloak.<dns-zone-name>"))),Object(l.b)("div",{className:"admonition admonition-note alert alert--secondary"},Object(l.b)("div",Object(n.a)({parentName:"div"},{className:"admonition-heading"}),Object(l.b)("h5",{parentName:"div"},Object(l.b)("span",Object(n.a)({parentName:"h5"},{className:"admonition-icon"}),Object(l.b)("svg",Object(n.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(l.b)("path",Object(n.a)({parentName:"svg"},{fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"})))),"note")),Object(l.b)("div",Object(n.a)({parentName:"div"},{className:"admonition-content"}),Object(l.b)("p",{parentName:"div"},Object(l.b)("inlineCode",{parentName:"p"},"otomi-idp")," is the default KeyCloak alias (shown as login title). To use another alias, add the following to the chart values:"),Object(l.b)("pre",{parentName:"div"},Object(l.b)("code",Object(n.a)({parentName:"pre"},{className:"language-yaml"}),"charts:\n  keycloak:\n    idp:\n      alias: <your-alias>\n")))),Object(l.b)("h3",{id:"kms-credentials-to-manage-keys-for-encryption-optional"},"KMS credentials to manage keys for encryption (optional)"),Object(l.b)("p",null,"If you would like the secrets in the ",Object(l.b)("inlineCode",{parentName:"p"},"values")," repository to be encrypted, you will have to setup an account with your Key Management Service (KMS) provider. It is needed by ",Object(l.b)("a",Object(n.a)({parentName:"p"},{href:"https://github.com/mozilla/sops"}),"sops"),", the tool used for encryption."),Object(l.b)("p",null,"Find quickstart documentation below on how to setup KMS access per supported provider:"),Object(l.b)("ul",null,Object(l.b)("li",{parentName:"ul"},Object(l.b)("a",Object(n.a)({parentName:"li"},{href:"https://aws.amazon.com/kms/getting-started/"}),"AWS KMS")),Object(l.b)("li",{parentName:"ul"},Object(l.b)("a",Object(n.a)({parentName:"li"},{href:"https://azure.microsoft.com/en-us/services/key-vault/#getting-started"}),"Azure Vault")),Object(l.b)("li",{parentName:"ul"},Object(l.b)("a",Object(n.a)({parentName:"li"},{href:"https://cloud.google.com/kms/docs/quickstart"}),"Google KMS"))),Object(l.b)("p",null,"Follow the instructions of the provider of your choosing and jot down the credentials obtained for the next steps."))}s.isMDXComponent=!0},175:function(e,t,a){"use strict";a.d(t,"a",(function(){return u})),a.d(t,"b",(function(){return m}));var n=a(0),r=a.n(n);function l(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function c(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?c(Object(a),!0).forEach((function(t){l(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):c(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function o(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},l=Object.keys(e);for(n=0;n<l.length;n++)a=l[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(n=0;n<l.length;n++)a=l[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var b=r.a.createContext({}),s=function(e){var t=r.a.useContext(b),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},u=function(e){var t=s(e.components);return r.a.createElement(b.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return r.a.createElement(r.a.Fragment,{},t)}},d=r.a.forwardRef((function(e,t){var a=e.components,n=e.mdxType,l=e.originalType,c=e.parentName,b=o(e,["components","mdxType","originalType","parentName"]),u=s(a),d=n,m=u["".concat(c,".").concat(d)]||u[d]||p[d]||l;return a?r.a.createElement(m,i(i({ref:t},b),{},{components:a})):r.a.createElement(m,i({ref:t},b))}));function m(e,t){var a=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var l=a.length,c=new Array(l);c[0]=d;var i={};for(var o in t)hasOwnProperty.call(t,o)&&(i[o]=t[o]);i.originalType=e,i.mdxType="string"==typeof e?e:n,c[1]=i;for(var b=2;b<l;b++)c[b]=a[b];return r.a.createElement.apply(null,c)}return r.a.createElement.apply(null,a)}d.displayName="MDXCreateElement"}}]);