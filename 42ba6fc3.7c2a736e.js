(window.webpackJsonp=window.webpackJsonp||[]).push([[32],{102:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return o})),n.d(t,"metadata",(function(){return l})),n.d(t,"toc",(function(){return c})),n.d(t,"default",(function(){return p}));var a=n(3),i=n(7),r=(n(0),n(175)),o={slug:"apps/keycloak",title:"Working with Keycloak",sidebar_label:"Keycloak"},l={unversionedId:"app-keycloak",id:"app-keycloak",isDocsHomePage:!1,title:"Working with Keycloak",description:"The SSO login page for Otomi is served by Keycloak. It is used as an identity broker or provider for all Otomi integrated applications. Keycloak is configured with mappers that normalize incoming identities from an IDP to have predictable claims format to be used by Otomi applications.",source:"@site/docs/app-keycloak.md",slug:"/apps/keycloak",permalink:"/docs/apps/keycloak",editUrl:"https://github.com/redkubes/redkubes.github.io/tree/master/docs/app-keycloak.md",version:"current",sidebar_label:"Keycloak",sidebar:"mainSidebar",previous:{title:"Working with Harbor",permalink:"/docs/apps/harbor"},next:{title:"Working with Kubeapps",permalink:"/docs/apps/kubeapps"}},c=[{value:"Create users",id:"create-users",children:[]}],s={toc:c};function p(e){var t=e.components,n=Object(i.a)(e,["components"]);return Object(r.b)("wrapper",Object(a.a)({},s,n,{components:t,mdxType:"MDXLayout"}),Object(r.b)("p",null,"The SSO login page for Otomi is served by Keycloak. It is used as an identity broker ",Object(r.b)("em",{parentName:"p"},"or")," provider for all Otomi integrated applications. Keycloak is configured with mappers that normalize incoming identities from an IDP to have predictable claims format to be used by Otomi applications."),Object(r.b)("p",null,"Keycloak is automatically configured with 3 roles:"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"otomi-admin"),": super admin role for all platform configuration and core applications"),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"team-admin"),": team admin role to manage teams and users"),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"team-<team-name>"),": team role for team members, which also includes the name of the team given access to")),Object(r.b)("p",null,"When this authorization configuration is useful to their own built applications, teams can directly use Keycloak's provided ",Object(r.b)("inlineCode",{parentName:"p"},"groups")," and ",Object(r.b)("inlineCode",{parentName:"p"},"roles"),' claims. There is no need for a client or token validation, as that has been done by the platform. They can do so by turning on the  "Authenticate with Single Sign On" checkbox. This then limits access the application to only allow the members of the team. '),Object(r.b)("p",null,'When there are different requirements to use Keycloak for business applications, Keycloak\'s designated "otomi" realm may ',Object(r.b)("em",{parentName:"p"},"not")," be used, and an additional realm needs to be created. We refer to the ",Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"https://www.keycloak.org/docs/latest/server_admin/index.html"}),"keycloak docs")," for any custom configuration targeting business applications. "),Object(r.b)("h2",{id:"create-users"},"Create users"),Object(r.b)("p",null,"When you did not provide ",Object(r.b)("inlineCode",{parentName:"p"},"oidc")," in your values to configure an external identity provider, then you need to manually add new users and add them to groups."),Object(r.b)("p",null,"After installation, sign in to the Keycloak administration console with the default ",Object(r.b)("inlineCode",{parentName:"p"},"admin")," user account, create additional users and add them to groups. You may follow these instructions:"),Object(r.b)("ol",null,Object(r.b)("li",{parentName:"ol"},"Go to Keycloak admin console using the following url: ",Object(r.b)("inlineCode",{parentName:"li"},"keycloak.<your domainSuffix>")),Object(r.b)("li",{parentName:"ol"},"Click on ",Object(r.b)("inlineCode",{parentName:"li"},"Administration Console")),Object(r.b)("li",{parentName:"ol"},"Login with username: ",Object(r.b)("inlineCode",{parentName:"li"},"admin")," and the password ",Object(r.b)("inlineCode",{parentName:"li"},"<otomi.adminPassword>")," provided in your values."),Object(r.b)("li",{parentName:"ol"},"Select the ",Object(r.b)("inlineCode",{parentName:"li"},"Otomi")," realm"),Object(r.b)("li",{parentName:"ol"},"Click on ",Object(r.b)("inlineCode",{parentName:"li"},"Users")," then ",Object(r.b)("inlineCode",{parentName:"li"},"Add user")," "),Object(r.b)("li",{parentName:"ol"},"Fill in a user name in the Username field and click on ",Object(r.b)("inlineCode",{parentName:"li"},"Save")),Object(r.b)("li",{parentName:"ol"},"Click on the ",Object(r.b)("inlineCode",{parentName:"li"},"Credentials")," tab and then fill in a password for this user in the ",Object(r.b)("inlineCode",{parentName:"li"},"Password")," and ",Object(r.b)("inlineCode",{parentName:"li"},"Password Confirmation")," fields"),Object(r.b)("li",{parentName:"ol"},"Click on ",Object(r.b)("inlineCode",{parentName:"li"},"Set Password")," "),Object(r.b)("li",{parentName:"ol"},"Go to the ",Object(r.b)("inlineCode",{parentName:"li"},"Groups")," tab "),Object(r.b)("li",{parentName:"ol"},"Select the desired group and then select ",Object(r.b)("inlineCode",{parentName:"li"},"Join"))))}p.isMDXComponent=!0},175:function(e,t,n){"use strict";n.d(t,"a",(function(){return b})),n.d(t,"b",(function(){return u}));var a=n(0),i=n.n(a);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var s=i.a.createContext({}),p=function(e){var t=i.a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},b=function(e){var t=p(e.components);return i.a.createElement(s.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return i.a.createElement(i.a.Fragment,{},t)}},m=i.a.forwardRef((function(e,t){var n=e.components,a=e.mdxType,r=e.originalType,o=e.parentName,s=c(e,["components","mdxType","originalType","parentName"]),b=p(n),m=a,u=b["".concat(o,".").concat(m)]||b[m]||d[m]||r;return n?i.a.createElement(u,l(l({ref:t},s),{},{components:n})):i.a.createElement(u,l({ref:t},s))}));function u(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=n.length,o=new Array(r);o[0]=m;var l={};for(var c in t)hasOwnProperty.call(t,c)&&(l[c]=t[c]);l.originalType=e,l.mdxType="string"==typeof e?e:a,o[1]=l;for(var s=2;s<r;s++)o[s]=n[s];return i.a.createElement.apply(null,o)}return i.a.createElement.apply(null,n)}m.displayName="MDXCreateElement"}}]);