"use strict";(self.webpackChunkredkubes_github_io=self.webpackChunkredkubes_github_io||[]).push([[1242],{3905:(e,t,r)=>{r.d(t,{Zo:()=>u,kt:()=>b});var n=r(7294);function a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){a(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function l(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}var s=n.createContext({}),p=function(e){var t=n.useContext(s),r=t;return e&&(r="function"==typeof e?e(t):i(i({},t),e)),r},u=function(e){var t=p(e.components);return n.createElement(s.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},d=n.forwardRef((function(e,t){var r=e.components,a=e.mdxType,o=e.originalType,s=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),d=p(r),b=a,m=d["".concat(s,".").concat(b)]||d[b]||c[b]||o;return r?n.createElement(m,i(i({ref:t},u),{},{components:r})):n.createElement(m,i({ref:t},u))}));function b(e,t){var r=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=r.length,i=new Array(o);i[0]=d;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:a,i[1]=l;for(var p=2;p<o;p++)i[p]=r[p];return n.createElement.apply(null,i)}return n.createElement.apply(null,r)}d.displayName="MDXCreateElement"},4709:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>s,contentTitle:()=>i,default:()=>c,frontMatter:()=>o,metadata:()=>l,toc:()=>p});var n=r(7462),a=(r(7294),r(3905));const o={slug:"lab-4",title:"Create a CI (build) pipeline",sidebar_label:"lab 4"},i=void 0,l={unversionedId:"for-devs/get-started/lab-4",id:"for-devs/get-started/lab-4",title:"Create a CI (build) pipeline",description:"Kubernetes is a container orchestrator, so we need to create container images that we can deploy. Next to providing a Git service. Otomi also has a complete CI solution called Drone integrated. You can use Drone to create and run CI pipelines to build images and push them to your private image registry (Harbor).",source:"@site/docs/for-devs/get-started/lab-4.md",sourceDirName:"for-devs/get-started",slug:"/for-devs/get-started/lab-4",permalink:"/docs/for-devs/get-started/lab-4",draft:!1,editUrl:"https://github.com/redkubes/redkubes.github.io/tree/main/docs/for-devs/get-started/lab-4.md",tags:[],version:"current",frontMatter:{slug:"lab-4",title:"Create a CI (build) pipeline",sidebar_label:"lab 4"},sidebar:"mainSidebar",previous:{title:"Lab 3",permalink:"/docs/for-devs/get-started/lab-3"},next:{title:"Lab 5",permalink:"/docs/for-devs/get-started/lab-5"}},s={},p=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Creating a build pipeline in Drone",id:"creating-a-build-pipeline-in-drone",level:2}],u={toc:p};function c(e){let{components:t,...o}=e;return(0,a.kt)("wrapper",(0,n.Z)({},u,o,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"Kubernetes is a container orchestrator, so we need to create container images that we can deploy. Next to providing a Git service. Otomi also has a complete CI solution called Drone integrated. You can use Drone to create and run CI pipelines to build images and push them to your private image registry (Harbor)."),(0,a.kt)("h2",{id:"prerequisites"},"Prerequisites"),(0,a.kt)("p",null,"Before you can use Drone to run CI pipelines, you will need to have:"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"A Git repository"),(0,a.kt)("li",{parentName:"ol"},"Credentials to push images to the registry (your private registry on the platform)")),(0,a.kt)("h2",{id:"creating-a-build-pipeline-in-drone"},"Creating a build pipeline in Drone"),(0,a.kt)("p",null,"In the apps section in Otomi console, you'll see an app called Drone. Click on it."),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"kubecfg",src:r(3617).Z,width:"2944",height:"1728"})),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Go to the Drone dashboard, and click on \u2018SYNC\u2019. You will now see your repo pop up in the REPOSITORIES list.")),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"kubecfg",src:r(5455).Z,width:"2198",height:"980"})),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Click on the new repo and then click \u2018ACTIVATE\u2019.")),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"kubecfg",src:r(3452).Z,width:"2196",height:"1300"})),(0,a.kt)("p",null,"Now we\u2019ll need to add the credentials of the robot account as secrets toDrone:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Click on your repository."),(0,a.kt)("li",{parentName:"ul"},"Under Settings, Click on secrets"),(0,a.kt)("li",{parentName:"ul"},"Add the following 2 secrets:")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"REGISTRY_USERNAME = <harbor-robot-account-name.\nREGISTRY_PASSWORD = <the-token-of-the-robot-account>\n")),(0,a.kt)("p",null,"Now you'll need to add a Drone pipeline definition to our repo."),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Add a ",(0,a.kt)("inlineCode",{parentName:"li"},".drone.yml")," file to your repo. This is an example you can use:")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"kind: pipeline\ntype: kubernetes\nname: default\nsteps:\n  - name: build-push\n    image: plugins/docker\n    settings:\n      registry: harbor.<yourdomain>\n      repo: harbor.<your-ip>.nip.io/team-demo/hello\n      insecure: true\n      username:\n        from_secret: REGISTRY_USERNAME\n      password:\n        from_secret: REGISTRY_PASSWORD\n      tags:\n        - ${DRONE_BRANCH}\n")),(0,a.kt)("p",null,"Make sure to adjust the registry and repo name in the .drone.yml file"),(0,a.kt)("p",null,"In Drone, you will see the pipeline has automatically started building and then pushing the new image to Harbor."),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"kubecfg",src:r(165).Z,width:"1248",height:"804"})),(0,a.kt)("p",null,"If you use Harbor as a private registry, check to see if the repo has been created. You can now also use Trivy in Harbor to scan your image(s) for vulnerabilities."))}c.isMDXComponent=!0},3452:(e,t,r)=>{r.d(t,{Z:()=>n});const n=r.p+"assets/images/drone-activate-repo-33218e943848cdf3a4fdc9ed9b166a29.png"},165:(e,t,r)=>{r.d(t,{Z:()=>n});const n=r.p+"assets/images/drone-pipeline-85d054e8007b3d3dde79395387900660.png"},5455:(e,t,r)=>{r.d(t,{Z:()=>n});const n=r.p+"assets/images/repo-sync-cf209a43badf49d44c1e666a0bd3b6bc.png"},3617:(e,t,r)=>{r.d(t,{Z:()=>n});const n=r.p+"assets/images/team-app-drone-0d7fc083e50ae1146ba7b062f1b22580.png"}}]);