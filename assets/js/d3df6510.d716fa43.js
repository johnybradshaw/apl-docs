"use strict";(self.webpackChunkredkubes_github_io=self.webpackChunkredkubes_github_io||[]).push([[9522],{3905:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>m});var a=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var s=a.createContext({}),p=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},d=function(e){var t=p(e.components);return a.createElement(s.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,i=e.originalType,s=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),u=p(n),m=o,h=u["".concat(s,".").concat(m)]||u[m]||c[m]||i;return n?a.createElement(h,r(r({ref:t},d),{},{components:n})):a.createElement(h,r({ref:t},d))}));function m(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var i=n.length,r=new Array(i);r[0]=u;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:o,r[1]=l;for(var p=2;p<i;p++)r[p]=n[p];return a.createElement.apply(null,r)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},7739:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>r,default:()=>c,frontMatter:()=>i,metadata:()=>l,toc:()=>p});var a=n(7462),o=(n(7294),n(3905));const i={slug:"installation/activation/",title:"Activation steps"},r=void 0,l={unversionedId:"activation",id:"activation",title:"Activation steps",description:"After Otomi is installed, Drone needs to be activated. Follow the instructions below:",source:"@site/docs/activation.md",sourceDirName:".",slug:"/installation/activation/",permalink:"/docs/installation/activation/",draft:!1,editUrl:"https://github.com/redkubes/redkubes.github.io/tree/main/docs/activation.md",tags:[],version:"current",frontMatter:{slug:"installation/activation/",title:"Activation steps"},sidebar:"mainSidebar",previous:{title:"Install from chart",permalink:"/docs/installation/chart"},next:{title:"Switch to DNS",permalink:"/docs/installation/switch-to-dns"}},s={},p=[{value:"Step 1: Get the log output of the installer job",id:"step-1-get-the-log-output-of-the-installer-job",level:3},{value:"Step 2 (optional): Add the auto generated CA to your keychain",id:"step-2-optional-add-the-auto-generated-ca-to-your-keychain",level:3},{value:"Step 3: Activate Drone",id:"step-3-activate-drone",level:3},{value:"Step 4: Create a new admin user",id:"step-4-create-a-new-admin-user",level:3},{value:"(Optional) Add the URL of the Kubernetes API",id:"optional-add-the-url-of-the-kubernetes-api",level:3}],d={toc:p};function c(e){let{components:t,...n}=e;return(0,o.kt)("wrapper",(0,a.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"After Otomi is installed, Drone needs to be activated. Follow the instructions below:"),(0,o.kt)("h3",{id:"step-1-get-the-log-output-of-the-installer-job"},"Step 1: Get the log output of the installer job"),(0,o.kt)("p",null,"When the installer job (in the default namespace) has finished, copy the URL and the generated password from the bottom of the logs, sign in to the console with the provided URL, username and password."),(0,o.kt)("p",null,"Use the following command to get the logs of the installer job:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"kubectl logs jobs/otomi -n default -f\n")),(0,o.kt)("h3",{id:"step-2-optional-add-the-auto-generated-ca-to-your-keychain"},"Step 2 (optional): Add the auto generated CA to your keychain"),(0,o.kt)("p",null,"Otomi by default automatically generates a CA. The generated CA is of course not trusted on your local machine. Here are some options to prevent you from clicking away lots of security warning in your browser:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},'In the left menu of the console, click on "Download CA"'),(0,o.kt)("li",{parentName:"ol"},"Double click the downloaded CA.crt or add the CA to your keychain on Mac using the following command:")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"sudo security add-trusted-cert -d -r trustRoot -k /Library/Keychains/System.keychain ~/Downloads/ca.crt\n")),(0,o.kt)("p",null,"On Windows, use PowerShell (running as Administrator) with the Certutil:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-powershell"},"certutil.exe -addstore root <downloaded cert path>\n")),(0,o.kt)("p",null,"Or:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-powershell"},'Import-Certificate -FilePath "<downloaded cert path>" -CertStoreLocation Cert:\\LocalMachine\\Root\n# Restart the browser\n')),(0,o.kt)("p",null,"But you could also run Chrome in insecure mode:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"alias chrome-insecure='/Applications/Google\\ Chrome.app/Contents/MacOS/Google\\ Chrome --ignore-certificate-errors --ignore-urlfetcher-cert-requests &> /dev/null'\n")),(0,o.kt)("ol",{start:3},(0,o.kt)("li",{parentName:"ol"},"Optional: Restart Docker (to support pushing images to Harbor)")),(0,o.kt)("h3",{id:"step-3-activate-drone"},"Step 3: Activate Drone"),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://www.drone.io/"},"Drone")," is an integral part in the deployment of Otomi cluster configuration."),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"In the side menu of Otomi Console under ",(0,o.kt)("inlineCode",{parentName:"li"},"platform")," click on the ",(0,o.kt)("strong",{parentName:"li"},"Drone")," app"),(0,o.kt)("li",{parentName:"ol"},"Click on the ",(0,o.kt)("inlineCode",{parentName:"li"},"play")," button in the top right. A new tab will open for Drone"),(0,o.kt)("li",{parentName:"ol"},"Sign in locally with as ",(0,o.kt)("inlineCode",{parentName:"li"},"otomi-admin")," and the password provided in the logs of the installer job."),(0,o.kt)("li",{parentName:"ol"},"Click on ",(0,o.kt)("inlineCode",{parentName:"li"},"Authorize Application")),(0,o.kt)("li",{parentName:"ol"},"Click on `Submit on the Complete your Drone Registration page. You don't need to fill in your Email, Full Name or Company Name if you don't want to"),(0,o.kt)("li",{parentName:"ol"},"Click on the ",(0,o.kt)("inlineCode",{parentName:"li"},"otomi/values")," repository"),(0,o.kt)("li",{parentName:"ol"},"Click on ",(0,o.kt)("inlineCode",{parentName:"li"},"+ Activate Repository"))),(0,o.kt)("h3",{id:"step-4-create-a-new-admin-user"},"Step 4: Create a new admin user"),(0,o.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"ATTENTION")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"We strongly advise to not use the default ",(0,o.kt)("inlineCode",{parentName:"p"},"otomi-admin")," account after activation and to not change the password. Store it somewhere safe and only use it in case absolutely required."))),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"/docs/apps/keycloak#step-2-create-a-user-in-keycloak"},"Create a new user account in Keycloak")," and add the new user to the ",(0,o.kt)("inlineCode",{parentName:"p"},"otomi-admin")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"team-admin"),"."),(0,o.kt)("h3",{id:"optional-add-the-url-of-the-kubernetes-api"},"(Optional) Add the URL of the Kubernetes API"),(0,o.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"NOTE")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"Adding the URL of the K8s cluster API is required by teams to be able to download the KUBECONFIG"))),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Under ",(0,o.kt)("inlineCode",{parentName:"li"},"Platform")," in Otomi Console, click on ",(0,o.kt)("inlineCode",{parentName:"li"},"Settings")),(0,o.kt)("li",{parentName:"ul"},"Click on ",(0,o.kt)("inlineCode",{parentName:"li"},"Cluster")),(0,o.kt)("li",{parentName:"ul"},"Add the full URL of the API server"),(0,o.kt)("li",{parentName:"ul"},"Click on ",(0,o.kt)("inlineCode",{parentName:"li"},"Submit")),(0,o.kt)("li",{parentName:"ul"},"Click on ",(0,o.kt)("inlineCode",{parentName:"li"},"Deploy Changes"))))}c.isMDXComponent=!0}}]);