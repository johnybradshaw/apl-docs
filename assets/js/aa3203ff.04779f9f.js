"use strict";(self.webpackChunkredkubes_github_io=self.webpackChunkredkubes_github_io||[]).push([[2144],{3905:(e,t,i)=>{i.d(t,{Zo:()=>s,kt:()=>m});var n=i(7294);function a(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function l(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function r(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?l(Object(i),!0).forEach((function(t){a(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):l(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function o(e,t){if(null==e)return{};var i,n,a=function(e,t){if(null==e)return{};var i,n,a={},l=Object.keys(e);for(n=0;n<l.length;n++)i=l[n],t.indexOf(i)>=0||(a[i]=e[i]);return a}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(n=0;n<l.length;n++)i=l[n],t.indexOf(i)>=0||Object.prototype.propertyIsEnumerable.call(e,i)&&(a[i]=e[i])}return a}var p=n.createContext({}),d=function(e){var t=n.useContext(p),i=t;return e&&(i="function"==typeof e?e(t):r(r({},t),e)),i},s=function(e){var t=d(e.components);return n.createElement(p.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},c=n.forwardRef((function(e,t){var i=e.components,a=e.mdxType,l=e.originalType,p=e.parentName,s=o(e,["components","mdxType","originalType","parentName"]),c=d(i),m=a,k=c["".concat(p,".").concat(m)]||c[m]||u[m]||l;return i?n.createElement(k,r(r({ref:t},s),{},{components:i})):n.createElement(k,r({ref:t},s))}));function m(e,t){var i=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var l=i.length,r=new Array(l);r[0]=c;var o={};for(var p in t)hasOwnProperty.call(t,p)&&(o[p]=t[p]);o.originalType=e,o.mdxType="string"==typeof e?e:a,r[1]=o;for(var d=2;d<l;d++)r[d]=i[d];return n.createElement.apply(null,r)}return n.createElement.apply(null,i)}c.displayName="MDXCreateElement"},4394:(e,t,i)=>{i.r(t),i.d(t,{assets:()=>p,contentTitle:()=>r,default:()=>u,frontMatter:()=>l,metadata:()=>o,toc:()=>d});var n=i(7462),a=(i(7294),i(3905));const l={slug:"builds",title:"Team Builds",sidebar_label:"Builds"},r=void 0,o={unversionedId:"for-devs/console/builds",id:"for-devs/console/builds",title:"Team Builds",description:"A Build in Otomi is a self-service feature for building OCI compliant images based on application source code.",source:"@site/docs/for-devs/console/builds.md",sourceDirName:"for-devs/console",slug:"/for-devs/console/builds",permalink:"/docs/for-devs/console/builds",draft:!1,editUrl:"https://github.com/redkubes/redkubes.github.io/tree/main/docs/for-devs/console/builds.md",tags:[],version:"current",frontMatter:{slug:"builds",title:"Team Builds",sidebar_label:"Builds"},sidebar:"mainSidebar",previous:{title:"Projects",permalink:"/docs/for-devs/console/projects"},next:{title:"Workloads",permalink:"/docs/for-devs/console/workloads"}},p={},d=[{value:"Builds (all)",id:"builds-all",level:2},{value:"Create a build",id:"create-a-build",level:2},{value:"Docker",id:"docker",level:3},{value:"Buildpacks",id:"buildpacks",level:3},{value:"Build status details",id:"build-status-details",level:3},{value:"Configure a webhook for the Git repo in Gitea",id:"configure-a-webhook-for-the-git-repo-in-gitea",level:3},{value:"Expose the trigger listener publicly",id:"expose-the-trigger-listener-publicly",level:3},{value:"Restart a build",id:"restart-a-build",level:3}],s={toc:d};function u(e){let{components:t,...l}=e;return(0,a.kt)("wrapper",(0,n.Z)({},s,l,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"A Build in Otomi is a self-service feature for building OCI compliant images based on application source code."),(0,a.kt)("admonition",{type:"info"},(0,a.kt)("p",{parentName:"admonition"},"Ask your platform administrator to activate Harbor to use this feature.")),(0,a.kt)("h2",{id:"builds-all"},"Builds (all)"),(0,a.kt)("p",null,"All Builds of the team are listed here."),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"Team builds",src:i(8254).Z,width:"2256",height:"1498"})),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"Property"),(0,a.kt)("th",{parentName:"tr",align:null},"Description"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Name"),(0,a.kt)("td",{parentName:"tr",align:null},"The name of the build")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Type"),(0,a.kt)("td",{parentName:"tr",align:null},"Type of the build. ",(0,a.kt)("inlineCode",{parentName:"td"},"buildpacks")," or ",(0,a.kt)("inlineCode",{parentName:"td"},"docker"))),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Webhook url"),(0,a.kt)("td",{parentName:"tr",align:null},"The ",(0,a.kt)("inlineCode",{parentName:"td"},"copy to clipboard")," webhook URL if a trigger is configured for the build")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Tekton"),(0,a.kt)("td",{parentName:"tr",align:null},"Link to the `PipelineRun`` of the build in the Tekton dashboard")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Repository"),(0,a.kt)("td",{parentName:"tr",align:null},"The ",(0,a.kt)("inlineCode",{parentName:"td"},"copy to clipboard")," repository name of the image")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Tag"),(0,a.kt)("td",{parentName:"tr",align:null},"The tag of the image")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Status"),(0,a.kt)("td",{parentName:"tr",align:null},"The status of the Build. If the Build has failed. click on the Tekton link to see more details")))),(0,a.kt)("h2",{id:"create-a-build"},"Create a build"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"Enter a name for the build")),(0,a.kt)("p",null,"The name of the build will be used for the registry name of the image (",(0,a.kt)("inlineCode",{parentName:"p"},"harbor.<domainSuffix>/team-name/build-name"),")"),(0,a.kt)("ol",{start:2},(0,a.kt)("li",{parentName:"ol"},"(optional) Adjust the tag")),(0,a.kt)("p",null,"The tag will be used to tag the image  (",(0,a.kt)("inlineCode",{parentName:"p"},"harbor.<domainSuffix>/team-name/build-name:tag"),")"),(0,a.kt)("p",null,"Now choose the type of the build:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Use ",(0,a.kt)("inlineCode",{parentName:"li"},"Docker")," to build an image using the ",(0,a.kt)("inlineCode",{parentName:"li"},"./Dockerfile")," in your code repository"),(0,a.kt)("li",{parentName:"ul"},"Use ",(0,a.kt)("inlineCode",{parentName:"li"},"Buildpacks")," to build an image from application source using Buildpacks")),(0,a.kt)("h3",{id:"docker"},"Docker"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"Add the URL of the repository that contains the application source code."),(0,a.kt)("li",{parentName:"ol"},"(optional) Change the path of the ",(0,a.kt)("inlineCode",{parentName:"li"},"Dockerfile"),". Default is ",(0,a.kt)("inlineCode",{parentName:"li"},"./Dockerfile"),". To use a Dockerfile is a specific folder, use ",(0,a.kt)("inlineCode",{parentName:"li"},"./folder/Dockerfile"),"."),(0,a.kt)("li",{parentName:"ol"},"(optional) Change the revision. This can be a commit, a tag, or a branch."),(0,a.kt)("li",{parentName:"ol"},"(Optional) Select ",(0,a.kt)("inlineCode",{parentName:"li"},"External Repo")," if the repository used for the Build is not a public or a private Git repo in the local Gitea. When selected, fill in the secret name that contains the required SSH credentials. Read more ",(0,a.kt)("a",{parentName:"li",href:"https://tekton.dev/docs/how-to-guides/clone-repository/#git-authentication"},"here")," about how to setup SSH authentication with your Git provider."),(0,a.kt)("li",{parentName:"ol"},"(optional) Select to create an event listener to trigger the build based on a Gitea webhook.")),(0,a.kt)("h3",{id:"buildpacks"},"Buildpacks"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"Add the URL of the Git repository that contains the application source code"),(0,a.kt)("li",{parentName:"ol"},"(optional) Add the path. This is a subpath within the repo where the source to build is located"),(0,a.kt)("li",{parentName:"ol"},"(optional) Change the revision. This can be a commit, a tag, or a branch"),(0,a.kt)("li",{parentName:"ol"},"(optional) Add Environment variables to set during build-time"),(0,a.kt)("li",{parentName:"ol"},"(Optional) Select ",(0,a.kt)("inlineCode",{parentName:"li"},"External Repo")," if the repository used for the Build is not a public or a private Git repo in the local Gitea. When selected, fill in the secret name that contains the required SSH credentials. Read more ",(0,a.kt)("a",{parentName:"li",href:"https://tekton.dev/docs/how-to-guides/clone-repository/#git-authentication"},"here")," about how to setup SSH authentication with your Git provider."),(0,a.kt)("li",{parentName:"ol"},"(optional) Select to create an event listener to trigger the build based on a Gitea webhook.")),(0,a.kt)("h3",{id:"build-status-details"},"Build status details"),(0,a.kt)("p",null,"To see the more status details of the build, click on the ",(0,a.kt)("inlineCode",{parentName:"p"},"PipelineRun")," link of the build in the list of builds. If a trigger is configured, the link will show all PipelineRuns."),(0,a.kt)("h3",{id:"configure-a-webhook-for-the-git-repo-in-gitea"},"Configure a webhook for the Git repo in Gitea"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"In Otomi Console, click on ",(0,a.kt)("inlineCode",{parentName:"li"},"apps")," the left menu and then open ",(0,a.kt)("inlineCode",{parentName:"li"},"Gitea")),(0,a.kt)("li",{parentName:"ol"},"In the top menu of Gitea, click on ",(0,a.kt)("inlineCode",{parentName:"li"},"Explore")," and then on the ",(0,a.kt)("inlineCode",{parentName:"li"},"green")," repo"),(0,a.kt)("li",{parentName:"ol"},"Go to ",(0,a.kt)("inlineCode",{parentName:"li"},"Settings")," (top right) and then to ",(0,a.kt)("inlineCode",{parentName:"li"},"Webhooks")),(0,a.kt)("li",{parentName:"ol"},"Click ",(0,a.kt)("inlineCode",{parentName:"li"},"Add Webhook")," and select ",(0,a.kt)("inlineCode",{parentName:"li"},"Gitea")),(0,a.kt)("li",{parentName:"ol"},"In the ",(0,a.kt)("inlineCode",{parentName:"li"},"Target URL"),", paste the webhook URL from your clipboard."),(0,a.kt)("li",{parentName:"ol"},"Click ",(0,a.kt)("inlineCode",{parentName:"li"},"Add Webhook"))),(0,a.kt)("h3",{id:"expose-the-trigger-listener-publicly"},"Expose the trigger listener publicly"),(0,a.kt)("p",null,"When using an external (private) Git repository, the trigger event listener that is created by Otomi can also be exposed publicly. To expose the event listener publicly:"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"Go to Services"),(0,a.kt)("li",{parentName:"ol"},"Click create new service"),(0,a.kt)("li",{parentName:"ol"},"Select the ",(0,a.kt)("inlineCode",{parentName:"li"},"el-gitea-webhook-<build-name>")," internal service"),(0,a.kt)("li",{parentName:"ol"},"Under ",(0,a.kt)("inlineCode",{parentName:"li"},"Exposure"),", select ",(0,a.kt)("inlineCode",{parentName:"li"},"External")),(0,a.kt)("li",{parentName:"ol"},"Click ",(0,a.kt)("inlineCode",{parentName:"li"},"Submit")," and the ",(0,a.kt)("inlineCode",{parentName:"li"},"Deploy Changes"))),(0,a.kt)("h3",{id:"restart-a-build"},"Restart a build"),(0,a.kt)("p",null,"To restart a build:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Start a shell in the console"),(0,a.kt)("li",{parentName:"ul"},"run the following command:")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"tkn pipelineruns list\ntkn pipelinerun logs <pipelinerun-name> -f\n")),(0,a.kt)("p",null,"Build can be restarted by changing the ",(0,a.kt)("inlineCode",{parentName:"p"},"tag")," of the build or by restarting the pipeline manually:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Start/open a shell in the console"),(0,a.kt)("li",{parentName:"ul"},"run the following command:")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"tkn pipelines list\ntkn pipeline start <pipeline-name> --use-pipelinerun <pipelinerun-name>\n")))}u.isMDXComponent=!0},8254:(e,t,i)=>{i.d(t,{Z:()=>n});const n=i.p+"assets/images/team-builds-e662547a2ca3a3ce914168b5f65c9955.png"}}]);