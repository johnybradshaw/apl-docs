"use strict";(self.webpackChunkredkubes_github_io=self.webpackChunkredkubes_github_io||[]).push([[1241],{3905:(e,t,a)=>{a.d(t,{Zo:()=>u,kt:()=>m});var r=a(7294);function n(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function l(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function s(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?l(Object(a),!0).forEach((function(t){n(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):l(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function o(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},l=Object.keys(e);for(r=0;r<l.length;r++)a=l[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(r=0;r<l.length;r++)a=l[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var i=r.createContext({}),c=function(e){var t=r.useContext(i),a=t;return e&&(a="function"==typeof e?e(t):s(s({},t),e)),a},u=function(e){var t=c(e.components);return r.createElement(i.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var a=e.components,n=e.mdxType,l=e.originalType,i=e.parentName,u=o(e,["components","mdxType","originalType","parentName"]),d=c(a),m=n,f=d["".concat(i,".").concat(m)]||d[m]||p[m]||l;return a?r.createElement(f,s(s({ref:t},u),{},{components:a})):r.createElement(f,s({ref:t},u))}));function m(e,t){var a=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var l=a.length,s=new Array(l);s[0]=d;var o={};for(var i in t)hasOwnProperty.call(t,i)&&(o[i]=t[i]);o.originalType=e,o.mdxType="string"==typeof e?e:n,s[1]=o;for(var c=2;c<l;c++)s[c]=a[c];return r.createElement.apply(null,s)}return r.createElement.apply(null,a)}d.displayName="MDXCreateElement"},634:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>i,contentTitle:()=>s,default:()=>p,frontMatter:()=>l,metadata:()=>o,toc:()=>c});var r=a(7462),n=(a(7294),a(3905));const l={slug:"ingress-classes",title:"Manage Ingress Controllers"},s=void 0,o={unversionedId:"for-ops/how-to/ingress-classes",id:"for-ops/how-to/ingress-classes",title:"Manage Ingress Controllers",description:"When Otomi is installed, exposure (ingress) for all services (included exposure for platform services) is handeled by the default platform ingress class using a public (cloud) load balancer. Otomi offers the option to use multiple ingress classes. Each class get a dedicated ingress controller. In case of security requirements, where platform services are not allowed to be exposed publicly, the default platform class can be configured to use a private load balancer instead of a public one. Additional (public) ingress classes can be created to expose team (application) services.",source:"@site/docs/for-ops/how-to/ingress-classes.md",sourceDirName:"for-ops/how-to",slug:"/for-ops/how-to/ingress-classes",permalink:"/docs/for-ops/how-to/ingress-classes",draft:!1,editUrl:"https://github.com/redkubes/redkubes.github.io/tree/main/docs/for-ops/how-to/ingress-classes.md",tags:[],version:"current",frontMatter:{slug:"ingress-classes",title:"Manage Ingress Controllers"},sidebar:"mainSidebar",previous:{title:"Manage Developer Catalog",permalink:"/docs/for-ops/how-to/dev-catalog"},next:{title:"Use Team Admin",permalink:"/docs/for-ops/how-to/use-team-admin"}},i={},c=[{value:"prerequisites",id:"prerequisites",level:2},{value:"related documentation",id:"related-documentation",level:2},{value:"Steps",id:"steps",level:2}],u={toc:c};function p(e){let{components:t,...a}=e;return(0,n.kt)("wrapper",(0,r.Z)({},u,a,{components:t,mdxType:"MDXLayout"}),(0,n.kt)("p",null,"When Otomi is installed, exposure (ingress) for all services (included exposure for platform services) is handeled by the default platform ingress class using a public (cloud) load balancer. Otomi offers the option to use multiple ingress classes. Each class get a dedicated ingress controller. In case of security requirements, where platform services are not allowed to be exposed publicly, the default platform class can be configured to use a private load balancer instead of a public one. Additional (public) ingress classes can be created to expose team (application) services."),(0,n.kt)("h2",{id:"prerequisites"},"prerequisites"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"Access to the internal subnet (using a VPN or a Jumphost)"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"cluster.provider=azure"))),(0,n.kt)("h2",{id:"related-documentation"},"related documentation"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"https://docs.microsoft.com/en-us/azure/aks/internal-lb"},"Azure AKS, create internal load balancer"))),(0,n.kt)("h2",{id:"steps"},"Steps"),(0,n.kt)("p",null,"Steps to change to use a private load balancer for exposing platform services:"),(0,n.kt)("p",null,"If there are no team services created that use the default platform class, then you can skip step 2."),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},"Create an additional public ingress class")),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"Go to Ingress Classes under Settings in the web UI"),(0,n.kt)("li",{parentName:"ul"},"Under ",(0,n.kt)("inlineCode",{parentName:"li"},"additional classes")," click on ",(0,n.kt)("inlineCode",{parentName:"li"},"add item")),(0,n.kt)("li",{parentName:"ul"},"Provide a name for the additional ingress class (for example ",(0,n.kt)("inlineCode",{parentName:"li"},"teams"),")"),(0,n.kt)("li",{parentName:"ul"},"Use the public load balancer type"),(0,n.kt)("li",{parentName:"ul"},"(optional) If you would like to create a new load balancer in another resource group, fill in the name of that resource group"),(0,n.kt)("li",{parentName:"ul"},"(optional) If you would like to use a static (public) IP for the load balancer, then fill in the IP address. More information about using static IP addresses can be found ",(0,n.kt)("a",{parentName:"li",href:"https://docs.microsoft.com/en-us/azure/aks/static-ip"},"here")),(0,n.kt)("li",{parentName:"ul"},"Click submit and then deploy changes")),(0,n.kt)("ol",{start:2},(0,n.kt)("li",{parentName:"ol"},"Move all existing team services to use the new ingress class:")),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"Go to ",(0,n.kt)("inlineCode",{parentName:"li"},"services"),", click on the service you would like to move to the new ingress class"),(0,n.kt)("li",{parentName:"ul"},"Under ",(0,n.kt)("inlineCode",{parentName:"li"},"Exposure Ingress"),", fill in the name of the new ingress class in the ",(0,n.kt)("inlineCode",{parentName:"li"},"ingress class name")," field."),(0,n.kt)("li",{parentName:"ul"},"Click submit and then deploy changes")),(0,n.kt)("ol",{start:3},(0,n.kt)("li",{parentName:"ol"},"Change the platform class from public to private:")),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"Go to Ingress Classes under Settings in the web UI"),(0,n.kt)("li",{parentName:"ul"},"Under ",(0,n.kt)("inlineCode",{parentName:"li"},"Platform class"),", select ",(0,n.kt)("inlineCode",{parentName:"li"},"private")),(0,n.kt)("li",{parentName:"ul"},"(optional) If you would like to use a static IP for the load balancer, then fill in the IP address")),(0,n.kt)("p",null,"By default the internal load balancer is is created in the node resource group and connected to the same virtual network as the AKS cluster. If you would like to use a different resource group and subnet, fill in the Resource Group name and the subnet."),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"Click submit and then deploy changes")),(0,n.kt)("p",null,"When the platform ingress class has been configured to use an internal load balancer, Otomi will add the following annotations to the K8s load balancer service of the platform ingress controller:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-yaml"},'service.beta.kubernetes.io/azure-load-balancer-resource-group: {{ . }}\nservice.beta.kubernetes.io/azure-load-balancer-internal: "true"\nservice.beta.kubernetes.io/azure-load-balancer-internal-subnet: "{{ . }}"\n')))}p.isMDXComponent=!0}}]);