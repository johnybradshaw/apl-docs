"use strict";(self.webpackChunkredkubes_github_io=self.webpackChunkredkubes_github_io||[]).push([[2084],{3454:(e,s,t)=>{t.r(s),t.d(s,{assets:()=>o,contentTitle:()=>a,default:()=>h,frontMatter:()=>l,metadata:()=>i,toc:()=>c});var n=t(5893),r=t(1151);const l={slug:"lab-31",title:"Create custom rules",sidebar_label:"Create custom rules"},a=void 0,i={id:"get-started/labs/lab-31",title:"Create custom rules",description:"Now we are exporting metrics, these metrics can also be used to generate alerts. To generate alerts, we first need to create a Prometheus Rule:",source:"@site/docs/get-started/labs/lab-31.md",sourceDirName:"get-started/labs",slug:"/get-started/labs/lab-31",permalink:"/docs/get-started/labs/lab-31",draft:!1,unlisted:!1,editUrl:"https://github.com/redkubes/redkubes.github.io/tree/main/docs/get-started/labs/lab-31.md",tags:[],version:"current",frontMatter:{slug:"lab-31",title:"Create custom rules",sidebar_label:"Create custom rules"},sidebar:"mainSidebar",previous:{title:"Create custom dashboards",permalink:"/docs/get-started/labs/lab-30"},next:{title:"Monitor services",permalink:"/docs/get-started/labs/lab-23"}},o={},c=[{value:"See rules in Prometheus",id:"see-rules-in-prometheus",level:2},{value:"See alerts in Alertmanager",id:"see-alerts-in-alertmanager",level:2}];function d(e){const s={code:"code",h2:"h2",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",...(0,r.a)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(s.p,{children:["Now we are exporting metrics, these metrics can also be used to generate alerts. To generate alerts, we first need to create a Prometheus ",(0,n.jsx)(s.code,{children:"Rule"}),":"]}),"\n",(0,n.jsxs)(s.ol,{children:["\n",(0,n.jsxs)(s.li,{children:["Go to ",(0,n.jsx)(s.code,{children:"apps"})," and open ",(0,n.jsx)(s.code,{children:"Gitea"})]}),"\n",(0,n.jsxs)(s.li,{children:["In the list of repositories there is a repository called ",(0,n.jsx)(s.code,{children:"otomi/team-<team-name>-argocd"}),". Go to this repository."]}),"\n",(0,n.jsxs)(s.li,{children:["Click ",(0,n.jsx)(s.code,{children:"Add File"})," and then ",(0,n.jsx)(s.code,{children:"New File"})]}),"\n",(0,n.jsxs)(s.li,{children:["Name the file ",(0,n.jsx)(s.code,{children:"my-custom-rules.yaml"})]}),"\n",(0,n.jsx)(s.li,{children:"Add the following manifest to the file:"}),"\n"]}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-yaml",children:"apiVersion: monitoring.coreos.com/v1\nkind: PrometheusRule\nmetadata:\n  labels:\n    prometheus: team-labs # change labs to the name of your team\n  name: labs-custom-rules\nspec:\n  groups:\n  - name: custom.rules\n    rules:\n    - alert: 50GreetingsReached\n      annotations:\n        description: We reached 50 greetings!\n        summary: The number of greetings has reached more than 50.\n      expr: application_greetings_total > 50\n      for: 1m\n      labels:\n        severity: warning\n"})}),"\n",(0,n.jsxs)(s.ol,{start:"6",children:["\n",(0,n.jsx)(s.li,{children:"Commit changes in Gitea"}),"\n"]}),"\n",(0,n.jsx)(s.h2,{id:"see-rules-in-prometheus",children:"See rules in Prometheus"}),"\n",(0,n.jsx)(s.p,{children:"Now let's check to see if Prometheus has picked-up the rule:"}),"\n",(0,n.jsxs)(s.ol,{children:["\n",(0,n.jsxs)(s.li,{children:["Go to ",(0,n.jsx)(s.code,{children:"Apps"})," and open ",(0,n.jsx)(s.code,{children:"Prometheus"})]}),"\n",(0,n.jsxs)(s.li,{children:["In the menu click on ",(0,n.jsx)(s.code,{children:"Status"})," and then ",(0,n.jsx)(s.code,{children:"Rules"}),". You should now see the rule:"]}),"\n"]}),"\n",(0,n.jsx)(s.p,{children:(0,n.jsx)(s.img,{alt:"rules",src:t(4402).Z+"",width:"3386",height:"908"})}),"\n",(0,n.jsxs)(s.ol,{start:"3",children:["\n",(0,n.jsxs)(s.li,{children:["In the menu in Prometheus, click ",(0,n.jsx)(s.code,{children:"Alerts"})]}),"\n",(0,n.jsx)(s.li,{children:"You should see an alert has been fired:"}),"\n"]}),"\n",(0,n.jsx)(s.p,{children:(0,n.jsx)(s.img,{alt:"rules",src:t(1834).Z+"",width:"3382",height:"1154"})}),"\n",(0,n.jsx)(s.h2,{id:"see-alerts-in-alertmanager",children:"See alerts in Alertmanager"}),"\n",(0,n.jsxs)(s.ol,{children:["\n",(0,n.jsxs)(s.li,{children:["Go to ",(0,n.jsx)(s.code,{children:"Apps"})," and open ",(0,n.jsx)(s.code,{children:"Alertmanager"})]}),"\n",(0,n.jsx)(s.li,{children:"You will see Alertmanager has received the alerts from Prometheus:"}),"\n"]}),"\n",(0,n.jsx)(s.p,{children:(0,n.jsx)(s.img,{alt:"rules",src:t(8538).Z+"",width:"3374",height:"1808"})}),"\n",(0,n.jsx)(s.p,{children:"If a receiver has been configured for the Team, like Slack or email, then you would also have received a message with the alert."})]})}function h(e={}){const{wrapper:s}={...(0,r.a)(),...e.components};return s?(0,n.jsx)(s,{...e,children:(0,n.jsx)(d,{...e})}):d(e)}},4402:(e,s,t)=>{t.d(s,{Z:()=>n});const n=t.p+"assets/images/rules-1-06cfa80a8fa5f1e19f1441789559cfef.png"},1834:(e,s,t)=>{t.d(s,{Z:()=>n});const n=t.p+"assets/images/rules-2-7077d55b7ba5a8e7b95a3a67d20efa35.png"},8538:(e,s,t)=>{t.d(s,{Z:()=>n});const n=t.p+"assets/images/rules-3-081be46d7c9a643be531f1174b298cc0.png"},1151:(e,s,t)=>{t.d(s,{Z:()=>i,a:()=>a});var n=t(7294);const r={},l=n.createContext(r);function a(e){const s=n.useContext(l);return n.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function i(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),n.createElement(l.Provider,{value:s},e.children)}}}]);