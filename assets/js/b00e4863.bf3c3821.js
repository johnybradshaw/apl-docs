"use strict";(self.webpackChunkredkubes_github_io=self.webpackChunkredkubes_github_io||[]).push([[8643],{773:(e,i,t)=>{t.r(i),t.d(i,{assets:()=>d,contentTitle:()=>r,default:()=>h,frontMatter:()=>l,metadata:()=>a,toc:()=>o});var n=t(5893),s=t(1151);const l={slug:"lab-6",title:"Build images from application source",sidebar_label:"Build images"},r=void 0,a={id:"get-started/labs/lab-6",title:"Build images from application source",description:"Harbor needs to be activated for this lab.",source:"@site/docs/get-started/labs/lab-6.md",sourceDirName:"get-started/labs",slug:"/get-started/labs/lab-6",permalink:"/docs/get-started/labs/lab-6",draft:!1,unlisted:!1,editUrl:"https://github.com/redkubes/redkubes.github.io/tree/main/docs/get-started/labs/lab-6.md",tags:[],version:"current",frontMatter:{slug:"lab-6",title:"Build images from application source",sidebar_label:"Build images"},sidebar:"mainSidebar",previous:{title:"Create GIT repos",permalink:"/docs/get-started/labs/lab-3"},next:{title:"Trigger builds",permalink:"/docs/get-started/labs/lab-26"}},d={},o=[{value:"Build the blue image",id:"build-the-blue-image",level:2},{value:"Re-run the build (optional)",id:"re-run-the-build-optional",level:2}];function c(e){const i={a:"a",admonition:"admonition",code:"code",h2:"h2",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",...(0,s.a)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(i.admonition,{type:"info",children:(0,n.jsx)(i.p,{children:"Harbor needs to be activated for this lab."})}),"\n",(0,n.jsxs)(i.p,{children:["When your team is using Harbor for private image registries, you can build images from source using pre-configured Tekton pipelines using the ",(0,n.jsx)(i.a,{href:"https://buildpacks.io/docs/buildpack-author-guide/package-a-buildpack/",children:"paketo"})," task or the ",(0,n.jsx)(i.a,{href:"https://github.com/GoogleContainerTools/kaniko",children:"Kaniko"})," task to build images from application source."]}),"\n",(0,n.jsx)(i.h2,{id:"build-the-blue-image",children:"Build the blue image"}),"\n",(0,n.jsxs)(i.ol,{children:["\n",(0,n.jsxs)(i.li,{children:["In the left menu, click on ",(0,n.jsx)(i.code,{children:"Builds"})]}),"\n",(0,n.jsxs)(i.li,{children:["Click on ",(0,n.jsx)(i.code,{children:"Create Build"})]}),"\n",(0,n.jsxs)(i.li,{children:["Fill in the name ",(0,n.jsx)(i.code,{children:"blue"})," for your build and a tag (default tag is latest)"]}),"\n",(0,n.jsxs)(i.li,{children:["Choose ",(0,n.jsx)(i.code,{children:"Docker"})," and fill in the repo URL for the ",(0,n.jsx)(i.code,{children:"blue"})," repo created in the previous lab"]}),"\n",(0,n.jsxs)(i.li,{children:["Click ",(0,n.jsx)(i.code,{children:"Submit"})]}),"\n"]}),"\n",(0,n.jsxs)(i.p,{children:["Otomi will now create a Tekton Pipeline and PipelineRun resource to build the image. This will take around 15-20 seconds. Then the PipelineRun will start building the image. During this time the status will show ",(0,n.jsx)(i.code,{children:"in progress"}),":"]}),"\n",(0,n.jsx)(i.p,{children:(0,n.jsx)(i.img,{alt:"build status",src:t(2073).Z+"",width:"2262",height:"614"})}),"\n",(0,n.jsxs)(i.p,{children:["When the build is finished, the status will show ",(0,n.jsx)(i.code,{children:"healthy"}),":"]}),"\n",(0,n.jsx)(i.p,{children:(0,n.jsx)(i.img,{alt:"build status",src:t(2105).Z+"",width:"2252",height:"650"})}),"\n",(0,n.jsxs)(i.p,{children:["To see the full PipelineRun of the build, go to the list of Builds and click on ",(0,n.jsx)(i.code,{children:"PipelineRun"})," of the ",(0,n.jsx)(i.code,{children:"blue"})," build. This will open the Tekton Dashboard and show the status of the PipelineRun of the build:"]}),"\n",(0,n.jsx)(i.p,{children:(0,n.jsx)(i.img,{alt:"build status",src:t(7935).Z+"",width:"2386",height:"1774"})}),"\n",(0,n.jsx)(i.p,{children:"When the build is ready you can see the image in Harbor:"}),"\n",(0,n.jsxs)(i.ol,{children:["\n",(0,n.jsx)(i.li,{children:"Open Harbor"}),"\n",(0,n.jsx)(i.li,{children:"Click on the project of your team. Here you will see all the registries of the team, including the registry of the new build image"}),"\n"]}),"\n",(0,n.jsx)(i.p,{children:(0,n.jsx)(i.img,{alt:"build status",src:t(8280).Z+"",width:"2904",height:"1026"})}),"\n",(0,n.jsx)(i.h2,{id:"re-run-the-build-optional",children:"Re-run the build (optional)"}),"\n",(0,n.jsxs)(i.p,{children:["For this step you need to have the Tekton cli installed. If you don't have the Tekton cli installed, you can install it from this page: ",(0,n.jsx)(i.a,{href:"https://tekton.dev/docs/cli/",children:"https://tekton.dev/docs/cli/"})]}),"\n",(0,n.jsx)(i.p,{children:"To run the build again using Otomi Console, follow these steps:"}),"\n",(0,n.jsxs)(i.ol,{children:["\n",(0,n.jsxs)(i.li,{children:["Change the tag of the build for example to ",(0,n.jsx)(i.code,{children:"v1.0.0"})]}),"\n",(0,n.jsx)(i.li,{children:"Submit changes"}),"\n"]}),"\n",(0,n.jsx)(i.p,{children:"To re-build the image using the same tag, restart the build pipeline using the Tekton cli in the Shell:"}),"\n",(0,n.jsxs)(i.ol,{children:["\n",(0,n.jsxs)(i.li,{children:["\n",(0,n.jsx)(i.p,{children:"Start a shell in Otomi Console"}),"\n"]}),"\n",(0,n.jsxs)(i.li,{children:["\n",(0,n.jsx)(i.p,{children:"Get the name of the pipeline"}),"\n"]}),"\n"]}),"\n",(0,n.jsx)(i.pre,{children:(0,n.jsx)(i.code,{className:"language-bash",children:"kubectl get pipelines\nNAME                         AGE\ndocker-build-blue            41h\n"})}),"\n",(0,n.jsxs)(i.ol,{start:"3",children:["\n",(0,n.jsx)(i.li,{children:"Get the name of the pipelinerun:"}),"\n"]}),"\n",(0,n.jsx)(i.pre,{children:(0,n.jsx)(i.code,{className:"language-bash",children:"kubectl get pipelineruns\nNAME                       SUCCEEDED   REASON      STARTTIME   COMPLETIONTIME\ndocker-build-blue-latest   True        Succeeded   41h         41h\n"})}),"\n",(0,n.jsxs)(i.ol,{start:"4",children:["\n",(0,n.jsx)(i.li,{children:"Start the pipeline using the pipelinerun:"}),"\n"]}),"\n",(0,n.jsx)(i.pre,{children:(0,n.jsx)(i.code,{className:"language-bash",children:"tkn pipeline start docker-build-blue --use-pipelinerun docker-build-blue-latest\nPipelineRun started: docker-build-blue-latest-j5mmt\n"})}),"\n",(0,n.jsxs)(i.ol,{start:"5",children:["\n",(0,n.jsx)(i.li,{children:"In order to track the PipelineRun progress run:"}),"\n"]}),"\n",(0,n.jsx)(i.pre,{children:(0,n.jsx)(i.code,{className:"language-bash",children:"tkn pipelinerun logs docker-build-blue-latest-j5mmt -f\n"})}),"\n",(0,n.jsxs)(i.p,{children:["But it's easier to just open the Tekton dashboard and Click on ",(0,n.jsx)(i.code,{children:"PipelineRuns"}),"."]})]})}function h(e={}){const{wrapper:i}={...(0,s.a)(),...e.components};return i?(0,n.jsx)(i,{...e,children:(0,n.jsx)(c,{...e})}):c(e)}},2105:(e,i,t)=>{t.d(i,{Z:()=>n});const n=t.p+"assets/images/build-status-1-dd623d6fe39f6fb039e25385d4eb394b.png"},7935:(e,i,t)=>{t.d(i,{Z:()=>n});const n=t.p+"assets/images/build-status-2-f72162487d60c10360ddeadccc2d8074.png"},8280:(e,i,t)=>{t.d(i,{Z:()=>n});const n=t.p+"assets/images/build-status-3-2c2ff329951664d48d94f6b767e52c2d.png"},2073:(e,i,t)=>{t.d(i,{Z:()=>n});const n=t.p+"assets/images/build-status-7a9f84ab84b09b3774043f58a00b4c02.png"},1151:(e,i,t)=>{t.d(i,{Z:()=>a,a:()=>r});var n=t(7294);const s={},l=n.createContext(s);function r(e){const i=n.useContext(l);return n.useMemo((function(){return"function"==typeof e?e(i):{...i,...e}}),[i,e])}function a(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),n.createElement(l.Provider,{value:i},e.children)}}}]);