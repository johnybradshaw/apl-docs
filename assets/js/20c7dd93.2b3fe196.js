"use strict";(self.webpackChunkredkubes_github_io=self.webpackChunkredkubes_github_io||[]).push([[4882],{7613:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>a,contentTitle:()=>s,default:()=>h,frontMatter:()=>r,metadata:()=>l,toc:()=>d});var i=t(5893),o=t(1151);const r={slug:"tutorial-4",title:"Build, tag and push an image to Harbor",sidebar_label:"Push an image to harbor"},s=void 0,l={id:"tutorials/tutorial-4",title:"Build, tag and push an image to Harbor",description:"When Otomi is installed without using Let's Encrypt production certificates, make sure you download the CA.crt, add it to your Keychain and restarted Docker.",source:"@site/docs/tutorials/tutorial-4.md",sourceDirName:"tutorials",slug:"/tutorials/tutorial-4",permalink:"/docs/tutorials/tutorial-4",draft:!1,unlisted:!1,editUrl:"https://github.com/redkubes/redkubes.github.io/tree/main/docs/tutorials/tutorial-4.md",tags:[],version:"current",frontMatter:{slug:"tutorial-4",title:"Build, tag and push an image to Harbor",sidebar_label:"Push an image to harbor"}},a={},d=[{value:"Instructions",id:"instructions",level:2}];function c(e){const n={admonition:"admonition",code:"code",h2:"h2",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,o.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.admonition,{type:"note",children:(0,i.jsx)(n.p,{children:"When Otomi is installed without using Let's Encrypt production certificates, make sure you download the CA.crt, add it to your Keychain and restarted Docker."})}),"\n",(0,i.jsx)(n.p,{children:"In this tutorial, you are going to:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Activate Harbor"}),"\n",(0,i.jsx)(n.li,{children:"Build an image and push it to Harbor in Otomi"}),"\n",(0,i.jsx)(n.li,{children:"Create a Kubernetes Deployment and Service"}),"\n",(0,i.jsx)(n.li,{children:"Publicly expose the Hello World app using Otomi"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["When you created a Team in Otomi, Otomi will automatically create a project for the team in Harbor. In this tutorial we'll assume you have created a team called ",(0,i.jsx)(n.code,{children:"demo"}),"."]}),"\n",(0,i.jsx)(n.h2,{id:"instructions",children:"Instructions"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Activate Harbor"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["Go to ",(0,i.jsx)(n.code,{children:"Apps"})," under the ",(0,i.jsx)(n.code,{children:"Platform"})," section in the side menu and Drag and Drop ",(0,i.jsx)(n.code,{children:"Harbor"})," from the ",(0,i.jsx)(n.code,{children:"Disabled apps"})," to the ",(0,i.jsx)(n.code,{children:"Enabled apps"}),"."]}),"\n",(0,i.jsxs)(n.ol,{start:"2",children:["\n",(0,i.jsx)(n.li,{children:"Create a robot account in Harbor"}),"\n"]}),"\n",(0,i.jsx)(n.admonition,{type:"note",children:(0,i.jsxs)(n.p,{children:["Robot accounts for teams can only be created by users with the ",(0,i.jsx)(n.code,{children:"otomi-admin"})," role"]})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Go to ",(0,i.jsx)(n.code,{children:"https://harbor.<your-ip>.nip.io"})]}),"\n",(0,i.jsx)(n.li,{children:"Click 'Login with OIDC Provider'"}),"\n",(0,i.jsx)(n.li,{children:"Fill in your user name and click save"}),"\n",(0,i.jsxs)(n.li,{children:["Under ",(0,i.jsx)(n.code,{children:"Administration"}),", click ",(0,i.jsx)(n.code,{children:"Robot Accounts"})]}),"\n",(0,i.jsxs)(n.li,{children:["Click on ",(0,i.jsx)(n.code,{children:"+ New Robot account"})]}),"\n",(0,i.jsxs)(n.li,{children:["Provide a name for the new robot account: ",(0,i.jsx)(n.code,{children:"team-demo-push"})]}),"\n",(0,i.jsx)(n.li,{children:"Set an Expiration time"}),"\n",(0,i.jsxs)(n.li,{children:["Select ",(0,i.jsx)(n.code,{children:"team-demo"})," and optionally change the permissions"]}),"\n",(0,i.jsxs)(n.li,{children:["Click ",(0,i.jsx)(n.code,{children:"Add"})]}),"\n",(0,i.jsx)(n.li,{children:"Copy the generated token"}),"\n"]}),"\n",(0,i.jsxs)(n.ol,{start:"3",children:["\n",(0,i.jsx)(n.li,{children:"Download the demo application used in this tutorial"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Clone the repo used for this tutorial:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"git clone https://github.com/redkubes/nodejs-helloworld.git\n"})}),"\n",(0,i.jsxs)(n.ol,{start:"4",children:["\n",(0,i.jsx)(n.li,{children:"Login to Harbor"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["Login with username ",(0,i.jsx)(n.code,{children:"otomi-team-demo-push"})," & password: ",(0,i.jsx)(n.code,{children:"token"})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"docker login -u 'otomi-team-demo-push' -p '$token' harbor.<your-ip>.nip.io\n"})}),"\n",(0,i.jsxs)(n.ol,{start:"5",children:["\n",(0,i.jsx)(n.li,{children:"Build, tag and push the image"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Build and tag the image:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"docker build -t harbor.<your-ip>.nip.io/team-demo/hello-world:latest .\n"})}),"\n",(0,i.jsx)(n.p,{children:"Push the image to Harbor:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"docker push harbor.<your-ip>.nip.iom/team-demo/hello-world:latest\n"})}),"\n",(0,i.jsx)(n.p,{children:"Now go to the team-demo project and verify that the hello-world repository has been created."})]})}function h(e={}){const{wrapper:n}={...(0,o.a)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},1151:(e,n,t)=>{t.d(n,{Z:()=>l,a:()=>s});var i=t(7294);const o={},r=i.createContext(o);function s(e){const n=i.useContext(r);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:s(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);