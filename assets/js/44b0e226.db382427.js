"use strict";(self.webpackChunkredkubes_github_io=self.webpackChunkredkubes_github_io||[]).push([[7304],{3905:function(e,t,n){n.d(t,{Zo:function(){return u},kt:function(){return m}});var o=n(7294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function r(e,t){if(null==e)return{};var n,o,i=function(e,t){if(null==e)return{};var n,o,i={},a=Object.keys(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var s=o.createContext({}),p=function(e){var t=o.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},u=function(e){var t=p(e.components);return o.createElement(s.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},d=o.forwardRef((function(e,t){var n=e.components,i=e.mdxType,a=e.originalType,s=e.parentName,u=r(e,["components","mdxType","originalType","parentName"]),d=p(n),m=i,h=d["".concat(s,".").concat(m)]||d[m]||c[m]||a;return n?o.createElement(h,l(l({ref:t},u),{},{components:n})):o.createElement(h,l({ref:t},u))}));function m(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var a=n.length,l=new Array(a);l[0]=d;var r={};for(var s in t)hasOwnProperty.call(t,s)&&(r[s]=t[s]);r.originalType=e,r.mdxType="string"==typeof e?e:i,l[1]=r;for(var p=2;p<a;p++)l[p]=n[p];return o.createElement.apply(null,l)}return o.createElement.apply(null,n)}d.displayName="MDXCreateElement"},2621:function(e,t,n){n.r(t),n.d(t,{assets:function(){return u},contentTitle:function(){return s},default:function(){return m},frontMatter:function(){return r},metadata:function(){return p},toc:function(){return c}});var o=n(7462),i=n(3366),a=(n(7294),n(3905)),l=["components"],r={slug:"installation/post-install/",title:"Post installation steps"},s=void 0,p={unversionedId:"post-install",id:"post-install",title:"Post installation steps",description:"After Otomi is installed, a couple of post install configuration steps are required. Follow the instructions below:",source:"@site/docs/post-install.md",sourceDirName:".",slug:"/installation/post-install/",permalink:"/docs/installation/post-install/",editUrl:"https://github.com/redkubes/redkubes.github.io/tree/master/docs/post-install.md",tags:[],version:"current",frontMatter:{slug:"installation/post-install/",title:"Post installation steps"}},u={},c=[{value:"When Otomi is installed with minimal values",id:"when-otomi-is-installed-with-minimal-values",level:2},{value:"Step 1: Get the log output of the installer job",id:"step-1-get-the-log-output-of-the-installer-job",level:3},{value:"Step 2: Create a user in Keycloak",id:"step-2-create-a-user-in-keycloak",level:3},{value:"Step 3: Sign in to the console",id:"step-3-sign-in-to-the-console",level:3},{value:"Step 4: Add the auto generated CA to your keychain",id:"step-4-add-the-auto-generated-ca-to-your-keychain",level:3},{value:"Step 5: Activate Drone",id:"step-5-activate-drone",level:3},{value:"When Otomi is installed with optional configuration",id:"when-otomi-is-installed-with-optional-configuration",level:2},{value:"Sign in to the console",id:"sign-in-to-the-console",level:3}],d={toc:c};function m(e){var t=e.components,n=(0,i.Z)(e,l);return(0,a.kt)("wrapper",(0,o.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"After Otomi is installed, a couple of post install configuration steps are required. Follow the instructions below:"),(0,a.kt)("h2",{id:"when-otomi-is-installed-with-minimal-values"},"When Otomi is installed with minimal values"),(0,a.kt)("p",null,"Follow these instructions when Otomi is installed without DNS (",(0,a.kt)("inlineCode",{parentName:"p"},"otomi.hasExternalDNS=false"),") and without a 3rd party IDP (",(0,a.kt)("inlineCode",{parentName:"p"},"otomi.hasExternalIDP=false"),")."),(0,a.kt)("h3",{id:"step-1-get-the-log-output-of-the-installer-job"},"Step 1: Get the log output of the installer job"),(0,a.kt)("p",null,"When Otomi is installed with minimal values, passwords and public URLs (based on nip.io) are automatically generated and Keycloak is configured as an Identity Provider (IDP), in which one has to define Otomi users. The public URL of Otomi Console, the public URL of Keycloak and the admin credentials can be retrieved from the installer log. The installer job runs in the default namespace. In case the installer failed in the first run, the installer will automatically restart. Make sure to get the logs of the installer job with status ",(0,a.kt)("inlineCode",{parentName:"p"},"Completed"),"."),(0,a.kt)("p",null,"Use the following command to get the logs of the installer job:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"kubectl logs jobs/otomi -n default -f\n")),(0,a.kt)("h3",{id:"step-2-create-a-user-in-keycloak"},"Step 2: Create a user in Keycloak"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"Navigate to Keycloak app (using the URL provided in the installer log)"),(0,a.kt)("li",{parentName:"ol"},'Click on "Administration Console"'),(0,a.kt)("li",{parentName:"ol"},"Login with admin credentials (using ",(0,a.kt)("inlineCode",{parentName:"li"},"admin")," user and password provided in the installer log or the ",(0,a.kt)("inlineCode",{parentName:"li"},"otomi.adminPassword")," provided in the initial values)"),(0,a.kt)("li",{parentName:"ol"},'Select the "Otomi" realm'),(0,a.kt)("li",{parentName:"ol"},'Click on "Users" then "Add user"'),(0,a.kt)("li",{parentName:"ol"},'Fill in a user name in the "Username" field'),(0,a.kt)("li",{parentName:"ol"},'Fill in your email address in the "Email" field'),(0,a.kt)("li",{parentName:"ol"},'Select the "otomi-admin" group'),(0,a.kt)("li",{parentName:"ol"},'Click on "Save"'),(0,a.kt)("li",{parentName:"ol"},'Choose the "Credentials" tab and then fill in a password for this user'),(0,a.kt)("li",{parentName:"ol"},'Click on "Set Password"')),(0,a.kt)("h3",{id:"step-3-sign-in-to-the-console"},"Step 3: Sign in to the console"),(0,a.kt)("p",null,"Open the Otomi console (using the URL provided in the installer logs), and sign in with the new user."),(0,a.kt)("p",null,"Click ",(0,a.kt)("a",{parentName:"p",href:"/docs/console"},"here")," to learn more about using Otomi Console."),(0,a.kt)("h3",{id:"step-4-add-the-auto-generated-ca-to-your-keychain"},"Step 4: Add the auto generated CA to your keychain"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},'In the left pane of the console, click on "Download CA"'),(0,a.kt)("li",{parentName:"ol"},"Double click the downloaded CA.crt or add the CA to your keychain using the following command:")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"sudo security add-trusted-cert -d -r trustRoot -k /Library/Keychains/System.keychain ~/Downloads/ca.crt\n")),(0,a.kt)("ol",{start:3},(0,a.kt)("li",{parentName:"ol"},"Optional: Restart Docker (to support pushing images to Harbor)")),(0,a.kt)("h3",{id:"step-5-activate-drone"},"Step 5: Activate Drone"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"Click on the ",(0,a.kt)("strong",{parentName:"li"},"Drone")," app (under Platform/Otomi Apps) in the console"),(0,a.kt)("li",{parentName:"ol"},"Click on ",(0,a.kt)("inlineCode",{parentName:"li"},"Continue")," on the Welcome to Drone page"),(0,a.kt)("li",{parentName:"ol"},"Sign in")),(0,a.kt)("p",null,'Sign in using the Gitea admin credentials (username: "otomi-admin", and password: ',(0,a.kt)("inlineCode",{parentName:"p"},"$otomi.adminPassword")," or the auto-generated password provided in the logs of the installer job)."),(0,a.kt)("ol",{start:4},(0,a.kt)("li",{parentName:"ol"},"Click on ",(0,a.kt)("inlineCode",{parentName:"li"},"Authorize Application")),(0,a.kt)("li",{parentName:"ol"},"Click on `Submit on the Complete your Drone Registration page. You don't need to fill in your Email, Full Name or Company Name"),(0,a.kt)("li",{parentName:"ol"},"Click on the ",(0,a.kt)("inlineCode",{parentName:"li"},"otomi/values")," repository"),(0,a.kt)("li",{parentName:"ol"},"Click on ",(0,a.kt)("inlineCode",{parentName:"li"},"+ Activate Repository")),(0,a.kt)("li",{parentName:"ol"},"Click on ",(0,a.kt)("inlineCode",{parentName:"li"},"Save Changes"))),(0,a.kt)("p",null,"Now the final step is to create a team. See the ",(0,a.kt)("a",{parentName:"p",href:"/docs/console/teams"},"Teams")," page for more information."),(0,a.kt)("h2",{id:"when-otomi-is-installed-with-optional-configuration"},"When Otomi is installed with optional configuration"),(0,a.kt)("h3",{id:"sign-in-to-the-console"},"Sign in to the console"),(0,a.kt)("p",null,"If Otomi is configured with ",(0,a.kt)("inlineCode",{parentName:"p"},"hasExternalIDP=true")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"oidc"),' settings have been provided for an external IDP, click on the right button ("redkubes-azure" in the example below).'),(0,a.kt)("p",null,'When OIDC is configured, an external IDP user needs to be a member of the "otomi-admin" group. Now follow the same steps as described above to activate Drone.'))}m.isMDXComponent=!0}}]);