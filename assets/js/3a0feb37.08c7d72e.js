"use strict";(self.webpackChunkredkubes_github_io=self.webpackChunkredkubes_github_io||[]).push([[4825],{1084:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>d,contentTitle:()=>o,default:()=>a,frontMatter:()=>l,metadata:()=>r,toc:()=>c});var s=i(5893),t=i(1151);const l={slug:"switch-to-dns",title:"Switch to use DNS"},o=void 0,r={id:"for-ops/how-to/switch-to-dns",title:"Switch to use DNS",description:"When Otomi is installed with minimal values, a custom CA is generated and Otomi uses nip.io for host names. It is possible to switch from nip.io to using a DNS zone after installing Otomi initially without DNS. To switch from nip.io to a DNS zone, follow the instructions as described below.",source:"@site/docs/for-ops/how-to/switch-to-dns.md",sourceDirName:"for-ops/how-to",slug:"/for-ops/how-to/switch-to-dns",permalink:"/docs/for-ops/how-to/switch-to-dns",draft:!1,unlisted:!1,editUrl:"https://github.com/redkubes/redkubes.github.io/tree/main/docs/for-ops/how-to/switch-to-dns.md",tags:[],version:"current",frontMatter:{slug:"switch-to-dns",title:"Switch to use DNS"}},d={},c=[{value:"Step 1: Enable external DNS flag",id:"step-1-enable-external-dns-flag",level:2},{value:"Step 2: Provide DNS values",id:"step-2-provide-dns-values",level:2},{value:"Step 3: Set cluster domain suffix",id:"step-3-set-cluster-domain-suffix",level:2},{value:"Step 4 (optional): Use Let&#39;s Encrypt",id:"step-4-optional-use-lets-encrypt",level:2},{value:"Step 5: Deploy Changes",id:"step-5-deploy-changes",level:2},{value:"Step 6: Adjust the webhook in Gitea",id:"step-6-adjust-the-webhook-in-gitea",level:2},{value:"Step 7: Restart and Authorize Drone",id:"step-7-restart-and-authorize-drone",level:2}];function h(e){const n={code:"code",h2:"h2",li:"li",p:"p",pre:"pre",ul:"ul",...(0,t.a)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.p,{children:"When Otomi is installed with minimal values, a custom CA is generated and Otomi uses nip.io for host names. It is possible to switch from nip.io to using a DNS zone after installing Otomi initially without DNS. To switch from nip.io to a DNS zone, follow the instructions as described below."}),"\n",(0,s.jsx)(n.h2,{id:"step-1-enable-external-dns-flag",children:"Step 1: Enable external DNS flag"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Sing in to Otomi Console with user ",(0,s.jsx)(n.code,{children:"otomi-admin"})]}),"\n",(0,s.jsxs)(n.li,{children:["In the left menu, click on ",(0,s.jsx)(n.code,{children:"Setting"})," under ",(0,s.jsx)(n.code,{children:"Platform"})]}),"\n",(0,s.jsxs)(n.li,{children:["Click on ",(0,s.jsx)(n.code,{children:"Otomi"})]}),"\n",(0,s.jsx)(n.li,{children:"Enable the External DNS option"}),"\n",(0,s.jsxs)(n.li,{children:["Click on ",(0,s.jsx)(n.code,{children:"Submit"})]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"step-2-provide-dns-values",children:"Step 2: Provide DNS values"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Go back to the ",(0,s.jsx)(n.code,{children:"Settings"})," and click ",(0,s.jsx)(n.code,{children:"DNS"})]}),"\n",(0,s.jsx)(n.li,{children:"Provide the Domain filter and optionally the Zone id filters"}),"\n",(0,s.jsx)(n.li,{children:"Select your Provider"}),"\n",(0,s.jsx)(n.li,{children:"Provide the required values"}),"\n",(0,s.jsxs)(n.li,{children:["Click on ",(0,s.jsx)(n.code,{children:"Submit"})]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"step-3-set-cluster-domain-suffix",children:"Step 3: Set cluster domain suffix"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Go back to the ",(0,s.jsx)(n.code,{children:"Settings"})," and click ",(0,s.jsx)(n.code,{children:"Cluster"})]}),"\n",(0,s.jsx)(n.li,{children:"Provide the cluster Domain Suffix"}),"\n",(0,s.jsxs)(n.li,{children:["Click on ",(0,s.jsx)(n.code,{children:"Submit"})]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"step-4-optional-use-lets-encrypt",children:"Step 4 (optional): Use Let's Encrypt"}),"\n",(0,s.jsx)(n.p,{children:"Let's Encrypt requires a DNS zone. So if you would like to start using Let's Encrypt as a CA, now you can."}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Click on ",(0,s.jsx)(n.code,{children:"Apps"})," under platform"]}),"\n",(0,s.jsxs)(n.li,{children:["Click on the ",(0,s.jsx)(n.code,{children:"cert-manager"})," app"]}),"\n",(0,s.jsxs)(n.li,{children:["Click on the ",(0,s.jsx)(n.code,{children:"values"})," tab"]}),"\n",(0,s.jsx)(n.li,{children:"Fill in an email address with a valid domain name (required!)"}),"\n",(0,s.jsxs)(n.li,{children:["Under ",(0,s.jsx)(n.code,{children:"Issuer"}),", click on ",(0,s.jsx)(n.code,{children:"Lets Encrypt"})]}),"\n",(0,s.jsxs)(n.li,{children:["Select ",(0,s.jsx)(n.code,{children:"Production"})]}),"\n",(0,s.jsxs)(n.li,{children:["Click on ",(0,s.jsx)(n.code,{children:"Submit"})]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"step-5-deploy-changes",children:"Step 5: Deploy Changes"}),"\n",(0,s.jsxs)(n.p,{children:["In the left menu, click on ",(0,s.jsx)(n.code,{children:"Deploy Changes"})]}),"\n",(0,s.jsx)(n.p,{children:"Wait for the Drone runner to finish:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"kubectl get pod -n drone-pipelines -w\n"})}),"\n",(0,s.jsx)(n.h2,{id:"step-6-adjust-the-webhook-in-gitea",children:"Step 6: Adjust the webhook in Gitea"}),"\n",(0,s.jsx)(n.p,{children:"Open Gitea and follow these steps:"}),"\n",(0,s.jsxs)(n.p,{children:["First sign in to the Otomi Console using the new domain name: ",(0,s.jsx)(n.code,{children:"https://otomi.<your-domain-name>"})]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Click on ",(0,s.jsx)(n.code,{children:"Apps"})," under Platform"]}),"\n",(0,s.jsxs)(n.li,{children:["Click on the ",(0,s.jsx)(n.code,{children:"Gitea"})," app"]}),"\n",(0,s.jsx)(n.li,{children:"Sign in"}),"\n",(0,s.jsxs)(n.li,{children:["Click on the ",(0,s.jsx)(n.code,{children:"otomi/values"})," repository"]}),"\n",(0,s.jsxs)(n.li,{children:["Click ",(0,s.jsx)(n.code,{children:"Settings"})]}),"\n",(0,s.jsxs)(n.li,{children:["Click ",(0,s.jsx)(n.code,{children:"Webhooks"})]}),"\n",(0,s.jsxs)(n.li,{children:["Click on the existing webhook (",(0,s.jsx)(n.code,{children:"https://drone.<ip-address>.nip.io/"}),")"]}),"\n",(0,s.jsx)(n.li,{children:"Change the domain name in the target URL to your new domain name"}),"\n",(0,s.jsxs)(n.li,{children:["Click ",(0,s.jsx)(n.code,{children:"Update Webhook"})]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"step-7-restart-and-authorize-drone",children:"Step 7: Restart and Authorize Drone"}),"\n",(0,s.jsx)(n.p,{children:"After the webhook is adjusted, restart Drone:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"kubectl delete pod -n drone -l app=drone\n"})}),"\n",(0,s.jsx)(n.p,{children:"When the pods have restarted and are in a running state:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Click on ",(0,s.jsx)(n.code,{children:"Apps"})," under Platform"]}),"\n",(0,s.jsxs)(n.li,{children:["Click on the ",(0,s.jsx)(n.code,{children:"Drone"})," app"]}),"\n",(0,s.jsxs)(n.li,{children:["Click on ",(0,s.jsx)(n.code,{children:"Sign In"})," on the 404 page"]}),"\n",(0,s.jsxs)(n.li,{children:["Click ",(0,s.jsx)(n.code,{children:"Continue"})]}),"\n",(0,s.jsxs)(n.li,{children:["Click on ",(0,s.jsx)(n.code,{children:"Authorize Application"})]}),"\n",(0,s.jsx)(n.li,{children:"Complete the Drone registration"}),"\n",(0,s.jsxs)(n.li,{children:["Click ",(0,s.jsx)(n.code,{children:"Submit"})]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["Now you still see the pipeline running of the DNS change is still running. You can manually cancel the pipeline by clicking on the pipeline and then click ",(0,s.jsx)(n.code,{children:"cancel"})," in the top right."]}),"\n",(0,s.jsx)(n.p,{children:"You're ready to go!"})]})}function a(e={}){const{wrapper:n}={...(0,t.a)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(h,{...e})}):h(e)}},1151:(e,n,i)=>{i.d(n,{Z:()=>r,a:()=>o});var s=i(7294);const t={},l=s.createContext(t);function o(e){const n=s.useContext(l);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),s.createElement(l.Provider,{value:n},e.children)}}}]);