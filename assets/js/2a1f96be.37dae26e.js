"use strict";(self.webpackChunkredkubes_github_io=self.webpackChunkredkubes_github_io||[]).push([[192],{2397:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>h,frontMatter:()=>s,metadata:()=>o,toc:()=>a});var i=t(5893),r=t(1151);const s={slug:"tutorial-8",title:"Using secrets",sidebar_label:"Using secrets"},l=void 0,o={id:"tutorials/tutorial-8",title:"Using secrets",description:"In his tutorial, you are going to:",source:"@site/docs/tutorials/tutorial-8.md",sourceDirName:"tutorials",slug:"/tutorials/tutorial-8",permalink:"/docs/tutorials/tutorial-8",draft:!1,unlisted:!1,editUrl:"https://github.com/redkubes/redkubes.github.io/tree/main/docs/tutorials/tutorial-8.md",tags:[],version:"current",frontMatter:{slug:"tutorial-8",title:"Using secrets",sidebar_label:"Using secrets"}},c={},a=[{value:"Create a secret in Hashicorp Vault",id:"create-a-secret-in-hashicorp-vault",level:2},{value:"Create a secret in Otomi",id:"create-a-secret-in-otomi",level:2},{value:"Use a secret in your workload",id:"use-a-secret-in-your-workload",level:2}];function d(e){const n={code:"code",h2:"h2",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.p,{children:"In his tutorial, you are going to:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Create a secret in Hashicorp Vault"}),"\n",(0,i.jsx)(n.li,{children:"Create a Secret in Otomi"}),"\n",(0,i.jsx)(n.li,{children:"Use a secret in your workload"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"create-a-secret-in-hashicorp-vault",children:"Create a secret in Hashicorp Vault"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["In the left panel under the Team demo, click ",(0,i.jsx)(n.code,{children:"Otomi Apps"})," then click on ",(0,i.jsx)(n.code,{children:"Vault"})]}),"\n",(0,i.jsxs)(n.li,{children:["Sign in with Method ",(0,i.jsx)(n.code,{children:"OIDC"}),", skip role and click on ",(0,i.jsx)(n.code,{children:"Sign in with OIDC Provider"})]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["You are now automatically redirected to the team space ",(0,i.jsx)(n.code,{children:"teams/team-demo/"}),"created in Vault."]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Click on ",(0,i.jsx)(n.code,{children:"Create secret"})]}),"\n",(0,i.jsxs)(n.li,{children:["Provide a name for the secret. We'll use the name hello. The name of the secret will be: ",(0,i.jsx)(n.code,{children:"teams/team-demo/hello"})]}),"\n",(0,i.jsxs)(n.li,{children:["In the key field, fill in ",(0,i.jsx)(n.code,{children:"TARGET"})]}),"\n",(0,i.jsxs)(n.li,{children:["In the value field, fill in ",(0,i.jsx)(n.code,{children:"party people"})]}),"\n",(0,i.jsxs)(n.li,{children:["Click on ",(0,i.jsx)(n.code,{children:"save"})]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:'The secret is now created in vault. In the next tutorial, you are going to "inject" the secret in the Otomi service configuration.'}),"\n",(0,i.jsx)(n.h2,{id:"create-a-secret-in-otomi",children:"Create a secret in Otomi"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["In the left panel under the Team demo, click ",(0,i.jsx)(n.code,{children:"Secrets"})]}),"\n",(0,i.jsxs)(n.li,{children:["Click on ",(0,i.jsx)(n.code,{children:"Create secret"})]}),"\n",(0,i.jsxs)(n.li,{children:["Provide a name for the secret. The name should match the name of the secret in Vault. Use the name ",(0,i.jsx)(n.code,{children:"hello"})]}),"\n",(0,i.jsxs)(n.li,{children:["Select ",(0,i.jsx)(n.code,{children:"Generic"})," (default)"]}),"\n",(0,i.jsxs)(n.li,{children:["Under ",(0,i.jsx)(n.code,{children:"Entries"})," fill in ",(0,i.jsx)(n.code,{children:"TARGET"})," (the key of the secret in Vault)"]}),"\n",(0,i.jsxs)(n.li,{children:["Click ",(0,i.jsx)(n.code,{children:"Submit"})]}),"\n",(0,i.jsxs)(n.li,{children:["Click on ",(0,i.jsx)(n.code,{children:"Deploy Changes"})," in the left pane of the console"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["Note: under the hood an open source tool called ",(0,i.jsx)(n.code,{children:"external-secrets"})," is at work that will transform a Vault secret into a regular Kubernetes secret."]}),"\n",(0,i.jsx)(n.p,{children:"The secret in Vault is now mapped and can be used by the team in any workload. Otomi Console makes this easy by offering a secrets selector during creation of services."}),"\n",(0,i.jsx)(n.h2,{id:"use-a-secret-in-your-workload",children:"Use a secret in your workload"}),"\n",(0,i.jsxs)(n.p,{children:["Add the following snippet to the ",(0,i.jsx)(n.code,{children:"hello-ksvc.yaml"})," file created in the previous tutorial to the ",(0,i.jsx)(n.code,{children:"spec:"})," section of the Knative service:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"    spec:\n      containers:\n        - image: harbor.<your-ip>.nip.io/team-demo/hello-world:demo\n          securityContext:\n            runAsUser: 1001\n          env:\n          - name: TARGET\n            valueFrom:\n              secretKeyRef:\n                name: hello\n                key: TARGET\n"})}),"\n",(0,i.jsx)(n.p,{children:"And apply the manifest to Kubernetes:"}),"\n",(0,i.jsx)(n.p,{children:"bash kubectl apply -f hello-svc.yaml"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"\nGo to https://hello.team-demo.<your-ip>.nip.io/\n\nAs you can see, the text on the page now shows the value `party people` of the secret you created in Vault.\n\nYou can do the same for the Knative service `hello-ksvc`.\n"})})]})}function h(e={}){const{wrapper:n}={...(0,r.a)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},1151:(e,n,t)=>{t.d(n,{Z:()=>o,a:()=>l});var i=t(7294);const r={},s=i.createContext(r);function l(e){const n=i.useContext(s);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),i.createElement(s.Provider,{value:n},e.children)}}}]);